<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Yang's Daily Planner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@400;500;600;700&display=swap"
        rel="stylesheet" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        :root {
            --primary: #6c5ce7;
            --primary-light: #a29bfe;
            --secondary: #00cec9;
            --accent-pink: #fd79a8;
            --accent-orange: #fdcb6e;
            --accent-green: #00b894;
            --accent-blue: #74b9ff;
            --accent-red: #e17055;
            --bg-main: #f8f9fe;
            --bg-card: #ffffff;
            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --text-muted: #b2bec3;
            --shadow-sm: 0 2px 8px rgba(108, 92, 231, 0.08);
            --shadow-md: 0 4px 20px rgba(108, 92, 231, 0.12);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px
        }

        body {
            font-family: "Quicksand", sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            /* Prevent horizontal scroll */
        }

        .app-container {
            display: flex;
            min-height: 100vh;
            width: 100%;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--primary) 0%, #5b4cd4 100%);
            padding: 24px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 40px;
            padding: 8px
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px
        }

        .logo-text {
            color: white;
            font-family: "Nunito", sans-serif;
            font-weight: 800;
            font-size: 22px
        }

        .logo-sub {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            font-weight: 500
        }

        .nav-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 18px;
            border-radius: var(--radius-md);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 15px
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1)
        }

        .nav-icon {
            font-size: 20px;
            width: 24px;
            text-align: center
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            margin-top: auto
        }

        .avatar {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-orange));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            font-weight: 700
        }

        .user-info {
            color: white
        }

        .user-name {
            font-weight: 700;
            font-size: 15px
        }

        .user-role {
            font-size: 12px;
            opacity: 0.7
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 32px;
            max-width: calc(100vw - 280px)
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 16px
        }

        .page-title {
            font-family: "Nunito", sans-serif;
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary)
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 4px
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: var(--radius-md);
            font-family: "Quicksand", sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #5b4cd4 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.4)
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 92, 231, 0.5)
        }

        .btn-secondary {
            background: white;
            color: var(--text-primary);
            border: 2px solid #e8e8f0
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary)
        }

        .btn-danger {
            background: var(--accent-red);
            color: white
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 13px
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .btn-icon.delete:hover {
            background: rgba(225, 112, 85, 0.1);
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease
        }

        .card:hover {
            box-shadow: var(--shadow-md)
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px
        }

        .card-title {
            font-family: "Nunito", sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary)
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 32px
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden
        }

        .stat-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px
        }

        .stat-card.study::before {
            background: var(--primary)
        }

        .stat-card.entertainment::before {
            background: var(--accent-pink)
        }

        .stat-card.exercise::before {
            background: var(--accent-green)
        }

        .stat-card.social::before {
            background: var(--accent-orange)
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px
        }

        .stat-card.study .stat-icon {
            background: rgba(108, 92, 231, 0.1)
        }

        .stat-card.entertainment .stat-icon {
            background: rgba(253, 121, 168, 0.1)
        }

        .stat-card.exercise .stat-icon {
            background: rgba(0, 184, 148, 0.1)
        }

        .stat-card.social .stat-icon {
            background: rgba(253, 203, 110, 0.1)
        }

        .stat-value {
            font-family: "Nunito", sans-serif;
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 4px
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary)
        }

        .activity-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px
        }

        .activity-table th {
            text-align: left;
            padding: 12px 16px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px
        }

        .activity-table td {
            padding: 16px;
            background: #fafbff;
            font-size: 14px
        }

        .activity-table tr td:first-child {
            border-radius: var(--radius-md) 0 0 var(--radius-md)
        }

        .activity-table tr td:last-child {
            border-radius: 0 var(--radius-md) var(--radius-md) 0
        }

        .category-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600
        }

        .category-study {
            background: rgba(108, 92, 231, 0.1);
            color: var(--primary)
        }

        .category-entertainment {
            background: rgba(253, 121, 168, 0.1);
            color: var(--accent-pink)
        }

        .category-exercise {
            background: rgba(0, 184, 148, 0.1);
            color: var(--accent-green)
        }

        .category-social {
            background: rgba(253, 203, 110, 0.1);
            color: #e17055
        }

        .category-sleep {
            background: rgba(116, 185, 255, 0.1);
            color: var(--accent-blue)
        }

        .category-other {
            background: rgba(99, 110, 114, 0.1);
            color: var(--text-secondary)
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap
        }

        .status-planning {
            background: rgba(116, 185, 255, 0.15);
            color: #0984e3
        }

        .status-processing {
            background: rgba(253, 203, 110, 0.15);
            color: #e17055
        }

        .status-finished {
            background: rgba(0, 184, 148, 0.15);
            color: var(--accent-green)
        }

        /* Mobile Responsive Styles */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            z-index: 1000;
            justify-content: space-around;
            align-items: center;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-secondary);
            font-size: 10px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
        }

        .mobile-nav-item.active {
            color: var(--primary);
        }

        .mobile-nav-icon {
            font-size: 20px;
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                padding: 12px !important;
                padding-bottom: 90px !important;
                /* Space for bottom nav */
                overflow-x: hidden;
            }

            .app-container {
                flex-direction: column;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .page-header {
                margin-bottom: 20px;
                padding: 0 4px;
                /* Slight alignment adjust */
            }

            .page-title {
                font-size: 24px;
            }

            /* Activity List Card View */
            .activity-table {
                display: block;
            }

            .activity-table thead {
                display: none;
            }

            .activity-table tbody {
                display: block;
            }

            /* Aggressive Mobile Card Optimization */
            .activity-table tr {
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                background: white;
                border: 1px solid #eee;
                border-radius: var(--radius-md);
                margin-bottom: 8px;
                padding: 10px;
                box-shadow: var(--shadow-sm);
                gap: 4px;
                position: relative;
            }

            .activity-table td {
                display: block;
                padding: 0;
                border: none;
                width: auto;
            }

            /* Enable specific cell styling and reordering */
            /* 1. Select */
            .activity-table td[data-label="Select"] {
                order: 1;
                margin-right: 8px;
            }

            /* 2. Time */
            .activity-table td[data-label="Time"] {
                order: 2;
                font-size: 13px;
                font-weight: 600;
                color: var(--text-secondary);
            }

            /* 3. Duration */
            .activity-table td[data-label="Duration"] {
                order: 3;
                font-size: 12px;
                opacity: 0.7;
                margin-left: 6px;
            }

            /* 4. Date */
            .activity-table td[data-label="Date"] {
                order: 4;
                margin-left: auto;
                font-size: 12px;
                color: #aaa;
            }

            /* Break Row */
            .activity-table td[data-label="Date"]::after {
                content: "";
                display: block;
                width: 100%;
            }

            /* 5. Activity Name (Main Row) */
            .activity-table td[data-label="Activity"] {
                order: 10;
                width: 100%;
                font-size: 16px;
                font-weight: 700;
                color: var(--text-primary);
                margin: 4px 0 8px 0;
                line-height: 1.3;
            }

            /* 6. Category */
            .activity-table td[data-label="Category"] {
                order: 20;
            }

            /* 7. Status */
            .activity-table td[data-label="Status"] {
                order: 21;
                margin-left: 8px;
            }

            /* 8. Actions */
            .activity-table td[data-label="Actions"] {
                order: 30;
                margin-left: auto;
                /* Push to right */
            }

            /* Hide Labels & Notes */
            .activity-table td::before {
                display: none !important;
            }

            .activity-table td[data-label="Notes"] {
                display: none;
            }

            /* Adjust badges */
            .activity-table .category-badge,
            .activity-table .status-badge {
                padding: 4px 8px;
                font-size: 11px;
            }

            .calendar-page-grid {
                grid-template-columns: 1fr !important;
                /* Stack vertically on mobile */
                gap: 24px;
            }


            .mobile-nav {
                display: flex;
            }

            .modal {
                width: 90vw;
                max-width: 90vw;
                padding: 20px;
                max-height: 90vh;
                overflow-y: auto;
            }
        }

        .status-partialfinished {
            background: rgba(108, 92, 231, 0.15);
            color: var(--primary)
        }

        .status-abandoned {
            background: rgba(178, 190, 195, 0.15);
            color: var(--text-secondary)
        }

        .action-btns {
            display: flex;
            gap: 8px
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 14px
        }

        .action-btn.edit {
            background: rgba(108, 92, 231, 0.1);
            color: var(--primary)
        }

        .action-btn.delete {
            background: rgba(255, 118, 117, 0.1);
            color: var(--accent-red)
        }

        /* Calendar Layout */
        .calendar-page-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .action-btn:hover {
            transform: scale(1.1)
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(45, 52, 54, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.2s ease
        }

        @keyframes fadeIn {
            from {
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        .modal {
            background: white;
            border-radius: var(--radius-xl);
            padding: 32px;
            width: 100%;
            max-width: 560px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 40px rgba(108, 92, 231, 0.16);
            animation: slideUp 0.3s ease
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        .modal-title {
            font-family: "Nunito", sans-serif;
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 24px;
            color: var(--text-primary)
        }

        .form-group {
            margin-bottom: 20px
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e8e8f0;
            border-radius: var(--radius-md);
            font-family: "Quicksand", sans-serif;
            font-size: 14px;
            transition: all 0.2s ease;
            outline: none
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(108, 92, 231, 0.1)
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 28px;
            padding-top: 20px;
            border-top: 1px solid #e8e8f0
        }

        .calendar-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm)
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 16px
        }

        .calendar-nav-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            border: 2px solid #e8e8f0;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease
        }

        .calendar-nav-btn:hover {
            border-color: var(--primary);
            color: var(--primary)
        }

        .calendar-title {
            font-family: "Nunito", sans-serif;
            font-size: 20px;
            font-weight: 700
        }

        .calendar-view-toggle {
            display: flex;
            background: #f5f5fa;
            border-radius: var(--radius-sm);
            padding: 4px
        }

        .view-toggle-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-family: "Quicksand", sans-serif;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary)
        }

        .view-toggle-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow-sm)
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px
        }

        .calendar-weekday {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            padding: 8px;
            text-transform: uppercase
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: var(--radius-md);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #fafbff;
            position: relative;
            min-height: 60px
        }

        .calendar-day:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md)
        }

        .calendar-day.other-month {
            opacity: 0.3
        }

        .calendar-day.today {
            border: 2px solid var(--primary)
        }

        .calendar-day.selected {
            background: var(--primary);
            color: white
        }

        .calendar-day .day-number {
            font-weight: 600;
            font-size: 14px
        }

        .calendar-day .health-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 4px
        }

        .health-excellent {
            background: var(--accent-green)
        }

        .health-good {
            background: var(--accent-blue)
        }

        .health-fair {
            background: var(--accent-orange)
        }

        .health-poor {
            background: var(--accent-red)
        }

        .health-none {
            background: var(--text-muted)
        }

        .year-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px
        }

        .month-card {
            background: #fafbff;
            border-radius: var(--radius-md);
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease
        }

        .month-card:hover {
            background: white;
            box-shadow: var(--shadow-md)
        }

        .month-name {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 12px;
            color: var(--text-primary)
        }

        .mini-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px
        }

        .mini-day {
            aspect-ratio: 1;
            border-radius: 4px;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px
        }

        .chart-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm)
        }

        .pie-chart-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            padding: 20px;
            flex-wrap: wrap
        }

        .pie-chart {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            position: relative
        }

        .pie-chart-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center
        }

        .pie-chart-total {
            font-family: "Nunito", sans-serif;
            font-size: 24px;
            font-weight: 800;
            color: var(--text-primary)
        }

        .pie-chart-label {
            font-size: 11px;
            color: var(--text-secondary)
        }

        .pie-legend {
            display: flex;
            flex-direction: column;
            gap: 10px
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 4px
        }

        .legend-value {
            color: var(--text-secondary);
            margin-left: auto;
            font-weight: 600
        }

        .bar-chart-container {
            padding: 20px 10px
        }

        .bar-chart-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px
        }

        .bar-label {
            width: 100px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary)
        }

        .bar-track {
            flex: 1;
            height: 24px;
            background: #f5f5fa;
            border-radius: 12px;
            overflow: hidden
        }

        .bar-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            padding-left: 10px
        }

        .bar-value {
            font-size: 12px;
            font-weight: 600;
            color: white
        }

        .suggestions-card {
            background: linear-gradient(135deg, var(--primary) 0%, #5b4cd4 100%);
            border-radius: var(--radius-lg);
            padding: 28px;
            color: white;
            margin-top: 24px
        }

        .suggestions-title {
            font-family: "Nunito", sans-serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px
        }

        .suggestion-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1)
        }

        .suggestion-item:last-child {
            border-bottom: none
        }

        .suggestion-icon {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0
        }

        .suggestion-text {
            font-size: 14px;
            line-height: 1.5;
            opacity: 0.9
        }

        .settings-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm)
        }

        .settings-title {
            font-family: "Nunito", sans-serif;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary)
        }

        .settings-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px
        }

        .settings-item {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #fafbff;
            border-radius: var(--radius-md);
            font-size: 14px
        }

        .settings-item-color {
            width: 12px;
            height: 12px;
            border-radius: 50%
        }

        .settings-item button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 16px;
            padding: 0 4px
        }

        .settings-item button:hover {
            color: var(--accent-red)
        }

        .add-item-form {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap
        }

        .add-item-form input {
            flex: 1;
            min-width: 120px;
            padding: 10px 16px;
            border: 2px solid #e8e8f0;
            border-radius: var(--radius-md);
            font-family: "Quicksand", sans-serif;
            outline: none
        }

        .add-item-form input:focus {
            border-color: var(--primary)
        }

        .period-selector {
            display: flex;
            background: #f5f5fa;
            border-radius: var(--radius-sm);
            padding: 4px;
            margin-bottom: 24px;
            width: fit-content
        }

        .period-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-family: "Quicksand", sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary)
        }

        .period-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow-sm)
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary)
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5
        }

        .empty-title {
            font-family: "Nunito", sans-serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary)
        }

        .health-score-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px
        }

        .health-score-circle {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .health-score-inner {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center
        }

        .health-score-value {
            font-family: "Nunito", sans-serif;
            font-size: 48px;
            font-weight: 800;
            line-height: 1
        }

        .health-score-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px
        }

        .cal-activity {
            padding: 8px 10px;
            background: #FAFBFF;
            border-radius: var(--radius-sm);
            margin-bottom: 4px;
            cursor: pointer;
            transition: all 0.15s ease;
            border-left: 3px solid transparent
        }

        .cal-activity:hover {
            background: #F0F1FF;
            transform: translateX(2px)
        }

        .cal-activity-header {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: nowrap
        }

        .cal-activity-icon {
            font-size: 14px;
            flex-shrink: 0
        }

        .cal-activity-title {
            font-weight: 600;
            font-size: 13px;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0
        }

        .cal-activity-time {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 2px
        }

        .cal-detail {
            background: white;
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 8px;
            box-shadow: var(--shadow-md);
            animation: slideUp 0.2s ease
        }

        .cal-detail-title {
            font-family: "Nunito", sans-serif;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px
        }

        .cal-detail-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            margin-bottom: 8px
        }

        .cal-detail-label {
            color: var(--text-secondary);
            min-width: 60px
        }

        .cal-detail-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            padding-top: 12px;
            border-top: 1px solid #e8e8f0;
            margin-top: 8px
        }

        .date-picker-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap
        }

        .date-picker-row input[type="date"] {
            padding: 10px 16px;
            border: 2px solid #e8e8f0;
            border-radius: var(--radius-md);
            font-family: "Quicksand", sans-serif;
            font-size: 14px;
            outline: none;
            cursor: pointer
        }

        .date-picker-row input[type="date"]:focus {
            border-color: var(--primary)
        }

        .duration-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(0, 206, 201, 0.15);
            color: #00b894
        }

        @media (max-width:1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr)
            }

            .charts-grid {
                grid-template-columns: 1fr
            }
        }

        @media (max-width:768px) {
            .sidebar {
                width: 80px;
                padding: 16px
            }

            .logo-text,
            .logo-sub,
            .nav-item span,
            .user-info {
                display: none
            }

            .main-content {
                margin-left: 80px;
                max-width: calc(100vw - 80px)
            }

            .dashboard-grid {
                grid-template-columns: 1fr
            }

            .year-grid {
                grid-template-columns: repeat(2, 1fr)
            }
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const APP_VERSION = "v1.4.5";
        const GITHUB_OWNER = "flyzhenghao";
        const GITHUB_REPO = "yang-daily-planner";
        const GITHUB_FILE_PATH = "data.json";
        const GITHUB_BRANCH = "main";

        const defaultCategories = [
            { id: 1, name: "Study", color: "#6C5CE7", icon: "ðŸ“š" },
            { id: 2, name: "Entertainment", color: "#FD79A8", icon: "ðŸŽ®" },
            { id: 3, name: "Social", color: "#FDCB6E", icon: "ðŸ‘¥" },
            { id: 4, name: "Exercise", color: "#00B894", icon: "ðŸƒ" },
            { id: 5, name: "Sleep", color: "#74B9FF", icon: "ðŸ˜´" },
            { id: 6, name: "Other", color: "#636E72", icon: "ðŸ“Œ" },
        ];
        const defaultStatuses = [
            { id: 1, name: "Planning", color: "#74B9FF" },
            { id: 2, name: "Processing", color: "#FDCB6E" },
            { id: 3, name: "Finished", color: "#00B894" },
            { id: 4, name: "Partial Finished", color: "#6C5CE7" },
            { id: 5, name: "Abandoned", color: "#B2BEC3" },
        ];

        // Helper: Get local date string (YYYY-MM-DD) without timezone issues
        const getLocalDateStr = (date = new Date()) => {
            const d = new Date(date);
            return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        };

        // Helper: Calculate duration in minutes between two time strings
        const calcDuration = (timeFrom, timeTo) => {
            if (!timeFrom || !timeTo) return 0;
            const [h1, m1] = timeFrom.split(":").map(Number);
            const [h2, m2] = timeTo.split(":").map(Number);
            let mins = (h2 * 60 + m2) - (h1 * 60 + m1);
            if (mins < 0) mins += 24 * 60; // Handle overnight
            return mins;
        };

        // Helper: convert HH:MM to minutes since midnight
        const timeStrToMins = (time) => {
            if (!time) return null;
            const [h, m] = time.split(":").map(Number);
            return h * 60 + m;
        };
        // Helper: Format duration for display
        const formatDuration = (mins) => {
            if (mins <= 0) return "-";
            const h = Math.floor(mins / 60);
            const m = mins % 60;
            if (h > 0 && m > 0) return `${h}h ${m}m`;
            if (h > 0) return `${h}h`;
            return `${m}m`;
        };

        const formatDate = (date) => new Date(date).toLocaleDateString("en-NZ", { year: "numeric", month: "short", day: "numeric" });
        const generateId = () => Date.now() + Math.random().toString(36).substr(2, 9);
        const getLS = (key, def) => { try { const s = localStorage.getItem(key); return s ? JSON.parse(s) : def; } catch { return def; } };
        const setLS = (key, val) => { try { localStorage.setItem(key, JSON.stringify(val)); } catch (e) { console.error(e); } };

        async function loadDataFromGitHub() {
            try {
                const response = await fetch(`data.json?t=${Date.now()}`, { cache: "no-cache" });
                if (response.ok) {
                    const data = await response.json();
                    // Compare remote lastUpdated with local last updated timestamp to avoid
                    // overwriting newer local changes with an older remote copy.
                    const remoteUpdated = data.lastUpdated ? Date.parse(data.lastUpdated) : 0;
                    const localUpdated = getLS("yang_last_updated", 0) || 0;
                    if (localUpdated && localUpdated > remoteUpdated) {
                        // Local changes are newer â€” prefer local storage
                        return { activities: getLS("yang_activities", []), categories: getLS("yang_categories", defaultCategories), statuses: getLS("yang_statuses", defaultStatuses) };
                    }
                    if (data.activities) setLS("yang_activities", data.activities);
                    if (data.categories) setLS("yang_categories", data.categories);
                    if (data.statuses) setLS("yang_statuses", data.statuses);
                    setLS("yang_last_updated", remoteUpdated || Date.now());
                    return data;
                }
            } catch (error) { console.log("Using localStorage fallback"); }
            return { activities: getLS("yang_activities", []), categories: getLS("yang_categories", defaultCategories), statuses: getLS("yang_statuses", defaultStatuses) };
        }

        async function saveDataToGitHub(activities, categories, statuses) {
            const token = localStorage.getItem("yang_github_token");
            if (!token) {
                console.warn("âš ï¸ GitHub token not configured");
                return false;
            }
            try {
                const dataObj = { version: APP_VERSION, lastUpdated: new Date().toISOString(), activities, categories, statuses };
                const content = JSON.stringify(dataObj, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));

                // Get current file info
                const getResponse = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_FILE_PATH}?ref=${GITHUB_BRANCH}&t=${Date.now()}`, {
                    headers: {
                        Authorization: `token ${token}`,
                        Accept: "application/vnd.github.v3+json"
                    },
                    cache: "no-cache"
                });

                if (!getResponse.ok) {
                    const errorText = await getResponse.text();
                    console.error("Failed to get file info:", getResponse.status, errorText);
                    throw new Error(`Failed to get file info: ${getResponse.status} - ${errorText}`);
                }

                const fileData = await getResponse.json();

                // Update file
                const updateResponse = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_FILE_PATH}`, {
                    method: "PUT",
                    headers: {
                        Authorization: `token ${token}`,
                        Accept: "application/vnd.github.v3+json",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        message: `Update data - ${new Date().toISOString()}`,
                        content: encodedContent,
                        sha: fileData.sha,
                        branch: GITHUB_BRANCH
                    })
                });

                if (!updateResponse.ok) {
                    const errorData = await updateResponse.json().catch(() => ({ message: "Unknown error" }));
                    console.error("Failed to update file:", updateResponse.status, errorData);
                    throw new Error(`Failed to save: ${errorData.message || "Unknown error"}`);
                }

                console.log("âœ… Successfully saved to GitHub");
                return true;
            } catch (error) {
                console.error("Error saving to GitHub:", error);
                return false;
            }
        }

        function PieChart({ data, totalLabel }) {
            const total = data.reduce((s, i) => s + i.value, 0);
            if (total === 0) return <div className="empty-state" style={{ padding: "40px 20px" }}><div className="empty-icon">ðŸ“Š</div><p>No data</p></div>;
            let parts = [], angle = 0;
            data.forEach((i) => { const a = (i.value / total) * 360; parts.push(`${i.color} ${angle}deg ${angle + a}deg`); angle += a; });
            return (
                <div className="pie-chart-container">
                    <div className="pie-chart" style={{ background: `conic-gradient(${parts.join(", ")})` }}>
                        <div className="pie-chart-inner"><div className="pie-chart-total">{Math.round(total / 60)}h</div><div className="pie-chart-label">{totalLabel || "Total"}</div></div>
                    </div>
                    <div className="pie-legend">{data.map((i, idx) => <div key={idx} className="legend-item"><div className="legend-color" style={{ background: i.color }}></div><span>{i.icon} {i.name}</span><span className="legend-value">{Math.round(i.value)}m</span></div>)}</div>
                </div>
            );
        }

        function BarChart({ data }) {
            const max = Math.max(...data.map((d) => d.value), 1);
            if (data.length === 0) return <div className="empty-state" style={{ padding: "40px 20px" }}><div className="empty-icon">ðŸ“Š</div><p>No data</p></div>;
            return <div className="bar-chart-container">{data.map((i, idx) => <div key={idx} className="bar-chart-item"><div className="bar-label">{i.name}</div><div className="bar-track"><div className="bar-fill" style={{ width: `${Math.max((i.value / max) * 100, i.value > 0 ? 10 : 0)}%`, background: i.color }}>{i.value > 0 && <span className="bar-value">{i.value}</span>}</div></div></div>)}</div>;
        }

        function App() {
            const [page, setPage] = useState("dashboard");
            const [activities, setActivities] = useState([]);
            const [categories, setCategories] = useState(defaultCategories);
            const [statuses, setStatuses] = useState(defaultStatuses);
            const [showModal, setShowModal] = useState(false);
            const [showTokenModal, setShowTokenModal] = useState(false);
            const [editingActivity, setEditingActivity] = useState(null);
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [calendarView, setCalendarView] = useState("month");
            const [period, setPeriod] = useState("daily");
            const [isLoading, setIsLoading] = useState(true);
            const [isSaving, setIsSaving] = useState(false);
            const [isInitialLoadRef] = useState(React.useRef(true));
            const [confirmConfig, setConfirmConfig] = useState(null);

            useEffect(() => { loadDataFromGitHub().then((data) => { if (data.activities) setActivities(data.activities); if (data.categories) setCategories(data.categories); if (data.statuses) setStatuses(data.statuses); setIsLoading(false); isInitialLoadRef.current = false; }); }, []);
            useEffect(() => { if (!isLoading) { setLS("yang_activities", activities); setLS("yang_last_updated", Date.now()); } }, [activities, isLoading]);
            useEffect(() => { if (!isLoading) setLS("yang_categories", categories); }, [categories, isLoading]);
            useEffect(() => { if (!isLoading) setLS("yang_statuses", statuses); }, [statuses, isLoading]);

            const handleSaveToGitHub = async () => {
                setIsSaving(true);
                const success = await saveDataToGitHub(activities, categories, statuses);
                setIsSaving(false);
                if (success) {
                    alert("âœ… Data saved to GitHub successfully!");
                } else {
                    const token = localStorage.getItem("yang_github_token");
                    if (!token) {
                        alert("âš ï¸ GitHub token not configured. Please set it in Settings.");
                    } else {
                        alert("âŒ Failed to save to GitHub. Please check the console for details.");
                    }
                }
            };

            // Auto-save disabled: per user request, do not automatically save changes to GitHub on add/update/delete.
            const addActivity = (a) => setActivities([...activities, { ...a, id: generateId() }]);
            const updateActivity = (a) => setActivities(activities.map((x) => (x.id === a.id ? a : x)));

            const deleteActivity = (id) => {
                setConfirmConfig({
                    title: "Delete Activity",
                    message: "Are you sure you want to delete this activity?",
                    onConfirm: () => {
                        setActivities(prev => prev.filter((a) => a.id !== id));
                        setConfirmConfig(null);
                    }
                });
            };

            const bulkDeleteActivities = (ids, onSuccess) => {
                if (!ids || ids.length === 0) return;
                setConfirmConfig({
                    title: "Bulk Delete",
                    message: `Are you sure you want to delete ${ids.length} activities?`,
                    onConfirm: () => {
                        setActivities(prev => prev.filter((a) => !ids.includes(a.id)));
                        if (onSuccess) onSuccess();
                        setConfirmConfig(null);
                    }
                });
            };

            const bulkUpdateActivities = (ids, updates) => { setActivities(prev => prev.map((a) => ids.includes(a.id) ? { ...a, ...updates } : a)); };
            const openEdit = (a) => { setEditingActivity(a); setShowModal(true); };
            const closeModal = () => { setShowModal(false); setEditingActivity(null); };

            const navItems = [{ id: "dashboard", icon: "ðŸ“Š", label: "Dashboard" }, { id: "activities", icon: "ðŸ“", label: "Activities" }, { id: "calendar", icon: "ðŸ“…", label: "Calendar" }, { id: "statistics", icon: "ðŸ“ˆ", label: "Statistics" }, { id: "settings", icon: "âš™ï¸", label: "Settings" }];

            return (
                <div className="app-container">
                    <aside className="sidebar">
                        <div className="logo"><div className="logo-icon">ðŸŒŸ</div><div><div className="logo-text">Yang's Planner</div><div className="logo-sub">Daily Management</div></div></div>
                        <nav className="nav-menu">{navItems.map((i) => <div key={i.id} className={`nav-item ${page === i.id ? "active" : ""}`} onClick={() => setPage(i.id)}><span className="nav-icon">{i.icon}</span><span>{i.label}</span></div>)}</nav>
                        <div style={{ padding: "16px 0", borderTop: "1px solid rgba(255,255,255,0.1)" }}>
                            <button className="btn btn-primary" onClick={handleSaveToGitHub} disabled={isSaving} style={{ width: "100%", fontSize: "13px", padding: "10px" }}>{isSaving ? "â³ Saving..." : "ðŸ’¾ Save to GitHub"}</button>
                            <button className="btn btn-secondary" onClick={() => setShowTokenModal(true)} style={{ width: "100%", fontSize: "13px", padding: "8px", marginTop: "8px" }}>ðŸ”‘ GitHub Token</button>
                            <div style={{ fontSize: "10px", color: "rgba(255,255,255,0.5)", textAlign: "center", marginTop: "8px" }}>{APP_VERSION}</div>
                        </div>
                        <div className="user-profile"><div className="avatar">Y</div><div className="user-info"><div className="user-name">Yang</div><div className="user-role">Year 9 Student</div></div></div>
                    </aside>
                    <main className="main-content">
                        {page === "dashboard" && <Dashboard activities={activities} categories={categories} statuses={statuses} onAdd={() => setShowModal(true)} setPage={setPage} />}
                        {page === "activities" && <Activities activities={activities} categories={categories} statuses={statuses} onAdd={() => setShowModal(true)} onEdit={openEdit} onDelete={deleteActivity} onBulkDelete={bulkDeleteActivities} onBulkUpdate={bulkUpdateActivities} />}
                        {page === "calendar" && <Calendar activities={activities} categories={categories} statuses={statuses} selectedDate={selectedDate} setSelectedDate={setSelectedDate} view={calendarView} setView={setCalendarView} onAdd={() => setShowModal(true)} onEdit={openEdit} onDelete={deleteActivity} />}
                        {page === "statistics" && <Statistics activities={activities} categories={categories} statuses={statuses} period={period} setPeriod={setPeriod} />}
                        {page === "settings" && <Settings categories={categories} setCategories={setCategories} statuses={statuses} setStatuses={setStatuses} />}
                    </main>
                    {showModal && <Modal activity={editingActivity} categories={categories} statuses={statuses} onSave={(a, keepOpen) => { editingActivity ? updateActivity(a) : addActivity(a); if (!keepOpen) closeModal(); }} onClose={closeModal} />}
                    {showTokenModal && <TokenModal onClose={() => setShowTokenModal(false)} />}
                    {confirmConfig && <ConfirmModal title={confirmConfig.title} message={confirmConfig.message} onConfirm={confirmConfig.onConfirm} onCancel={() => setConfirmConfig(null)} />}

                    {/* Mobile Navigation */}
                    <div className="mobile-nav">
                        {navItems.map(item => (
                            <div key={item.id} className={`mobile-nav-item ${page === item.id ? "active" : ""}`} onClick={() => setPage(item.id)}>
                                <div className="mobile-nav-icon">{item.icon}</div>
                                <span>{item.label}</span>
                            </div>
                        ))}
                    </div>
                    {/* Mobile Version Display */}
                    <div style={{ position: "fixed", bottom: "75px", right: "12px", fontSize: "10px", color: "var(--text-muted)", opacity: 0.5, pointerEvents: "none", display: window.innerWidth <= 768 ? "block" : "none" }}>{APP_VERSION}</div>
                </div>
            );
        }

        function Dashboard({ activities, categories, statuses, onAdd, setPage }) {
            const [viewDate, setViewDate] = useState(getLocalDateStr());
            const [viewMode, setViewMode] = useState("daily"); // daily, weekly, monthly, yearly

            // Get date range based on view mode
            const getDateRange = useMemo(() => {
                const baseDate = new Date(viewDate + "T00:00:00");
                if (viewMode === "daily") {
                    return { start: viewDate, end: viewDate, label: formatDate(viewDate) };
                }
                if (viewMode === "weekly") {
                    const day = baseDate.getDay();
                    const startD = new Date(baseDate);
                    startD.setDate(baseDate.getDate() - day);
                    const endD = new Date(startD);
                    endD.setDate(startD.getDate() + 6);
                    return {
                        start: getLocalDateStr(startD),
                        end: getLocalDateStr(endD),
                        label: `${formatDate(startD)} - ${formatDate(endD)}`
                    };
                }
                if (viewMode === "monthly") {
                    const startD = new Date(baseDate.getFullYear(), baseDate.getMonth(), 1);
                    const endD = new Date(baseDate.getFullYear(), baseDate.getMonth() + 1, 0);
                    return {
                        start: getLocalDateStr(startD),
                        end: getLocalDateStr(endD),
                        label: `${startD.toLocaleDateString("en-NZ", { month: "long", year: "numeric" })}`
                    };
                }
                // yearly
                const startD = new Date(baseDate.getFullYear(), 0, 1);
                const endD = new Date(baseDate.getFullYear(), 11, 31);
                return {
                    start: getLocalDateStr(startD),
                    end: getLocalDateStr(endD),
                    label: `Year ${baseDate.getFullYear()}`
                };
            }, [viewDate, viewMode]);

            // Filter activities for the selected date range
            const filteredActs = useMemo(() => {
                return activities.filter(a => a.date >= getDateRange.start && a.date <= getDateRange.end).sort((a, b) => {
                    const dateCompare = b.date.localeCompare(a.date);
                    if (dateCompare !== 0) return dateCompare;
                    return (b.timeFrom || "00:00").localeCompare(a.timeFrom || "00:00");
                });
            }, [activities, getDateRange]);

            // Calculate stats for filtered activities
            const stats = useMemo(() => {
                const cs = categories.map((c) => {
                    const ca = filteredActs.filter((a) => a.category === c.name);
                    const mins = ca.reduce((s, a) => s + calcDuration(a.timeFrom, a.timeTo), 0);
                    return { ...c, minutes: mins, hours: (mins / 60).toFixed(1) };
                });
                const tot = cs.reduce((s, c) => s + c.minutes, 0);
                return cs.map((c) => ({ ...c, percentage: tot > 0 ? Math.round((c.minutes / tot) * 100) : 0 }));
            }, [filteredActs, categories]);

            // Health score calculation
            const healthScore = useMemo(() => {
                const st = stats.find((s) => s.name === "Study")?.minutes || 0;
                const ex = stats.find((s) => s.name === "Exercise")?.minutes || 0;
                const sl = stats.find((s) => s.name === "Sleep")?.minutes || 0;
                const en = stats.find((s) => s.name === "Entertainment")?.minutes || 0;

                // Adjust targets based on view mode
                const mult = viewMode === "daily" ? 1 : viewMode === "weekly" ? 7 : viewMode === "monthly" ? 30 : 365;
                const studyTarget = 180 * mult;
                const exerciseTarget = 45 * mult;
                const sleepTarget = 480 * mult;
                const entertainmentMax = 120 * mult;

                let score = 50;
                if (st >= studyTarget * 0.8 && st <= studyTarget * 1.5) score += 15;
                else if (st >= studyTarget * 0.5) score += 10;
                else if (st > studyTarget * 1.5) score += 5;
                if (ex >= exerciseTarget * 0.7 && ex <= exerciseTarget * 1.5) score += 15;
                else if (ex > 0) score += 8;
                if (sl >= sleepTarget * 0.9 && sl <= sleepTarget * 1.1) score += 15;
                else if (sl >= sleepTarget * 0.8) score += 10;
                else if (sl > 0) score += 5;
                if (en > 0 && en <= entertainmentMax) score += 5;
                else if (en > entertainmentMax) score -= 5;
                return Math.min(100, Math.max(0, score));
            }, [stats, viewMode]);

            const getColor = (s) => s >= 80 ? "#00B894" : s >= 60 ? "#74B9FF" : s >= 40 ? "#FDCB6E" : "#E17055";
            const pieData = stats.filter((s) => s.minutes > 0).map((s) => ({ name: s.name, value: s.minutes, color: s.color, icon: s.icon }));

            const getGreeting = () => {
                const hour = new Date().getHours();
                if (hour < 12) return "Morning";
                if (hour < 18) return "Afternoon";
                return "Evening";
            };

            return (
                <div>
                    <div className="page-header">
                        <div>
                            <h1 className="page-title">Good {getGreeting()}, Yang! ðŸ‘‹</h1>
                            <p className="page-subtitle">{getDateRange.label}</p>
                        </div>
                        <button className="btn btn-primary" onClick={onAdd}>âž• Add Activity</button>
                    </div>

                    {/* Date & View Mode Selector */}
                    <div className="date-picker-row">
                        <input
                            type="date"
                            value={viewDate}
                            onChange={(e) => setViewDate(e.target.value)}
                        />
                        <button className="btn btn-secondary btn-sm" onClick={() => setViewDate(getLocalDateStr())}>Today</button>
                        <div className="period-selector" style={{ marginBottom: 0 }}>
                            {["daily", "weekly", "monthly", "yearly"].map((m) => (
                                <button
                                    key={m}
                                    className={`period-btn ${viewMode === m ? "active" : ""}`}
                                    onClick={() => setViewMode(m)}
                                >
                                    {m.charAt(0).toUpperCase() + m.slice(1)}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Stats Grid */}
                    <div className="dashboard-grid">
                        {stats.slice(0, 4).map((s) => (
                            <div key={s.id} className={`stat-card ${s.name.toLowerCase()}`}>
                                <div className="stat-icon">{s.icon}</div>
                                <div className="stat-value">{s.hours}h</div>
                                <div className="stat-label">{s.name} ({s.percentage}%)</div>
                            </div>
                        ))}
                    </div>

                    {/* Charts */}
                    <div className="charts-grid">
                        <div className="chart-card">
                            <div className="card-header"><h3 className="card-title">Time Distribution</h3></div>
                            <PieChart data={pieData} totalLabel={viewMode} />
                        </div>
                        <div className="chart-card">
                            <div className="card-header"><h3 className="card-title">Health Score</h3></div>
                            <div className="health-score-container">
                                <div className="health-score-circle" style={{ background: `conic-gradient(${getColor(healthScore)} ${healthScore * 3.6}deg, #F5F5FA ${healthScore * 3.6}deg)` }}>
                                    <div className="health-score-inner">
                                        <div className="health-score-value" style={{ color: getColor(healthScore) }}>{healthScore}</div>
                                        <div className="health-score-label">Health Score</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Activity List */}
                    <div className="card">
                        <div className="card-header">
                            <h3 className="card-title">
                                {viewMode === "daily" ? "Daily" : viewMode === "weekly" ? "This Week" : viewMode === "monthly" ? "This Month" : "This Year"} ({filteredActs.length})
                            </h3>
                            <button className="btn btn-secondary btn-sm" onClick={() => setPage("activities")}>View All â†’</button>
                        </div>
                        {filteredActs.length > 0 ? (
                            <table className="activity-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Time</th>
                                        <th>Activity</th>
                                        <th>Category</th>
                                        <th>Status</th>
                                        <th>Duration</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredActs.slice(0, 8).map((a) => {
                                        const c = categories.find((x) => x.name === a.category);
                                        const dur = calcDuration(a.timeFrom, a.timeTo);
                                        return (
                                            <tr key={a.id}>
                                                <td>{formatDate(a.date)}</td>
                                                <td>{a.timeFrom}-{a.timeTo}</td>
                                                <td>{a.item}</td>
                                                <td><span className={`category-badge category-${a.category?.toLowerCase()}`}>{c?.icon} {a.category}</span></td>
                                                <td><span className={`status-badge status-${a.status?.toLowerCase().replace(/\s+/g, "")}`}>{a.status}</span></td>
                                                <td><span className="duration-badge">â±ï¸ {formatDuration(dur)}</span></td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        ) : (
                            <div className="empty-state">
                                <div className="empty-icon">ðŸ“</div>
                                <h3 className="empty-title">No activities for this period</h3>
                                <p>Add your first activity!</p>
                            </div>
                        )}
                    </div>

                    {/* Suggestions */}
                    <div className="suggestions-card">
                        <h3 className="suggestions-title">ðŸ’¡ Smart Suggestions</h3>
                        <Suggestions stats={stats} healthScore={healthScore} viewMode={viewMode} />
                    </div>
                </div>
            );
        }

        function Suggestions({ stats, healthScore, viewMode }) {
            const tips = useMemo(() => {
                const t = [];
                const st = stats.find((s) => s.name === "Study")?.minutes || 0;
                const ex = stats.find((s) => s.name === "Exercise")?.minutes || 0;
                const sl = stats.find((s) => s.name === "Sleep")?.minutes || 0;
                const en = stats.find((s) => s.name === "Entertainment")?.minutes || 0;

                const mult = viewMode === "daily" ? 1 : viewMode === "weekly" ? 7 : viewMode === "monthly" ? 30 : 365;
                const studyTarget = 180 * mult;
                const exerciseTarget = 45 * mult;

                if (st < studyTarget * 0.5) t.push({ icon: "ðŸ“š", text: `Study time is low (${(st / 60).toFixed(1)}h). Aim for ${(studyTarget / 60).toFixed(0)}h ${viewMode}.` });
                else if (st > studyTarget * 2) t.push({ icon: "âš ï¸", text: "Studying a lot! Remember to take breaks." });
                if (ex < exerciseTarget * 0.5) t.push({ icon: "ðŸƒ", text: `Exercise more! Target: ${(exerciseTarget / 60).toFixed(1)}h ${viewMode}.` });
                if (sl > 0 && sl < 480 * mult * 0.8) t.push({ icon: "ðŸ˜´", text: "Teens need 8-10 hours sleep. Try to sleep earlier!" });
                if (en > 180 * mult) t.push({ icon: "ðŸŽ®", text: "Screen time is high. Balance with other activities." });
                if (healthScore >= 80) t.push({ icon: "ðŸŒŸ", text: "Excellent! You're maintaining a healthy balance!" });
                if (t.length === 0) t.push({ icon: "âœ¨", text: "Start logging activities for personalized tips!" });
                return t;
            }, [stats, healthScore, viewMode]);
            return <div>{tips.map((t, i) => <div key={i} className="suggestion-item"><div className="suggestion-icon">{t.icon}</div><div className="suggestion-text">{t.text}</div></div>)}</div>;
        }

        function Activities({ activities, categories, statuses, onAdd, onEdit, onDelete, onBulkDelete, onBulkUpdate }) {
            const [selectedIds, setSelectedIds] = useState([]);
            const [showBulkEdit, setShowBulkEdit] = useState(false);
            const [filter, setFilter] = useState({ category: "", status: "", search: "" });
            const filtered = useMemo(() => {
                let r = [...activities];
                if (filter.category) r = r.filter((a) => a.category === filter.category);
                if (filter.status) r = r.filter((a) => a.status === filter.status);
                if (filter.search) {
                    const s = filter.search.toLowerCase();
                    r = r.filter((a) => a.item?.toLowerCase().includes(s) || a.notes?.toLowerCase().includes(s));
                }
                r.sort((a, b) => {
                    const dateCompare = b.date.localeCompare(a.date);
                    if (dateCompare !== 0) return dateCompare;
                    return (b.timeFrom || "00:00").localeCompare(a.timeFrom || "00:00");
                });
                return r;
            }, [activities, filter]);

            // Handle selection
            const toggleSelection = (id) => {
                if (selectedIds.includes(id)) setSelectedIds(selectedIds.filter(i => i !== id));
                else setSelectedIds([...selectedIds, id]);
            };

            const toggleAll = () => {
                if (selectedIds.length === filtered.length) setSelectedIds([]);
                else setSelectedIds(filtered.map(a => a.id));
            };

            const handleBulkDelete = () => {
                onBulkDelete(selectedIds, () => setSelectedIds([]));
            };

            const handleBulkEdit = (updates) => {
                onBulkUpdate(selectedIds, updates);
                setShowBulkEdit(false);
                setSelectedIds([]);
            };

            // Calculate total duration
            const totalDuration = useMemo(() => {
                return filtered.reduce((sum, a) => sum + calcDuration(a.timeFrom, a.timeTo), 0);
            }, [filtered]);

            return (
                <div>
                    <div className="page-header">
                        <div>
                            <h1 className="page-title">Activities</h1>
                            <p className="page-subtitle">{filtered.length} activities Â· Total: {formatDuration(totalDuration)}</p>
                        </div>
                        <div style={{ display: "flex", gap: "10px" }}>
                            {selectedIds.length > 0 && (
                                <>
                                    <button className="btn btn-secondary" onClick={() => setShowBulkEdit(true)}>âœï¸ Edit ({selectedIds.length})</button>
                                    <button className="btn btn-danger" onClick={handleBulkDelete}>ðŸ—‘ï¸ Delete ({selectedIds.length})</button>
                                </>
                            )}
                            <button className="btn btn-primary" onClick={onAdd}>âž• Add Activity</button>
                        </div>
                    </div>
                    <div className="card" style={{ marginBottom: "24px" }}>
                        <div style={{ display: "flex", gap: "16px", flexWrap: "wrap" }}>
                            <input type="text" placeholder="ðŸ” Search..." className="form-input" style={{ maxWidth: "250px" }} value={filter.search} onChange={(e) => setFilter({ ...filter, search: e.target.value })} />
                            <select className="form-select" style={{ maxWidth: "180px" }} value={filter.category} onChange={(e) => setFilter({ ...filter, category: e.target.value })}>
                                <option value="">All Categories</option>
                                {categories.map((c) => <option key={c.id} value={c.name}>{c.icon} {c.name}</option>)}
                            </select>
                            <select className="form-select" style={{ maxWidth: "180px" }} value={filter.status} onChange={(e) => setFilter({ ...filter, status: e.target.value })}>
                                <option value="">All Statuses</option>
                                {statuses.map((s) => <option key={s.id} value={s.name}>{s.name}</option>)}
                            </select>
                        </div>
                    </div>
                    <div className="card">
                        {filtered.length > 0 ? (
                            <table className="activity-table">
                                <thead>
                                    <tr>
                                        <th style={{ width: "40px", textAlign: "center" }}><input type="checkbox" checked={filtered.length > 0 && selectedIds.length === filtered.length} onChange={toggleAll} /></th>
                                        <th>Date</th>
                                        <th>Time</th>
                                        <th>Duration</th>
                                        <th>Activity</th>
                                        <th>Category</th>
                                        <th>Status</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filtered.map((a) => {
                                        const c = categories.find((x) => x.name === a.category);
                                        const dur = calcDuration(a.timeFrom, a.timeTo);
                                        return (
                                            <tr key={a.id} className={selectedIds.includes(a.id) ? "selected-row" : ""}>
                                                <td style={{ textAlign: "center" }} data-label="Select"><input type="checkbox" checked={selectedIds.includes(a.id)} onChange={() => toggleSelection(a.id)} /></td>
                                                <td data-label="Date">{formatDate(a.date)}</td>
                                                <td data-label="Time">{a.timeFrom}-{a.timeTo}</td>
                                                <td data-label="Duration"><span className="duration-badge">â±ï¸ {formatDuration(dur)}</span></td>
                                                <td style={{ fontWeight: 600 }} data-label="Activity">{a.item}</td>
                                                <td data-label="Category"><span className={`category-badge category-${a.category?.toLowerCase()}`}>{c?.icon} {a.category}</span></td>
                                                <td data-label="Status"><span className={`status-badge status-${a.status?.toLowerCase().replace(/\s+/g, "")}`}>{a.status}</span></td>
                                                <td style={{ maxWidth: "200px", overflow: "hidden", textOverflow: "ellipsis" }} data-label="Notes">{a.notes || "-"}</td>
                                                <td data-label="Actions">
                                                    <div className="action-buttons">
                                                        <button className="btn-icon" onClick={() => onEdit(a)}>âœï¸</button>
                                                        <button className="btn-icon delete" onClick={() => onDelete(a.id)}>ðŸ—‘ï¸</button>
                                                    </div>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        ) : (
                            <div className="empty-state">
                                <div className="empty-icon">ðŸ“</div>
                                <h3 className="empty-title">No activities found</h3>
                                <p>Adjust filters or add new</p>
                            </div>
                        )}
                    </div>
                    {showBulkEdit && <BulkEditModal count={selectedIds.length} categories={categories} statuses={statuses} onSave={handleBulkEdit} onClose={() => setShowBulkEdit(false)} />}
                </div>
            );
        }

        function Calendar({ activities, categories, statuses, selectedDate, setSelectedDate, view, setView, onAdd, onEdit, onDelete }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [expandedId, setExpandedId] = useState(null);
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

            const getDays = (d) => {
                const y = d.getFullYear(), m = d.getMonth(), first = new Date(y, m, 1), last = new Date(y, m + 1, 0), dim = last.getDate(), sd = first.getDay();
                const arr = [];
                const prev = new Date(y, m, 0);
                for (let i = sd - 1; i >= 0; i--) arr.push({ date: new Date(y, m - 1, prev.getDate() - i), cur: false });
                for (let i = 1; i <= dim; i++) arr.push({ date: new Date(y, m, i), cur: true });
                const rem = 42 - arr.length;
                for (let i = 1; i <= rem; i++) arr.push({ date: new Date(y, m + 1, i), cur: false });
                return arr;
            };

            const getHealth = (d) => {
                const ds = getLocalDateStr(d);
                const da = activities.filter((a) => a.date === ds);
                if (da.length === 0) return "none";
                const f = da.filter((a) => a.status === "Finished").length, r = f / da.length;
                if (r >= 0.8) return "excellent";
                if (r >= 0.6) return "good";
                if (r >= 0.4) return "fair";
                return "poor";
            };

            const navM = (dir) => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + dir, 1));
            const navY = (dir) => setCurrentDate(new Date(currentDate.getFullYear() + dir, currentDate.getMonth(), 1));
            const isToday = (d) => getLocalDateStr(d) === getLocalDateStr();
            const isSel = (d) => getLocalDateStr(d) === getLocalDateStr(selectedDate);
            const dayArr = getDays(currentDate);
            const selStr = getLocalDateStr(selectedDate);
            const selActs = activities.filter((a) => a.date === selStr).sort((a, b) => {
                const timeCompare = (b.timeFrom || "00:00").localeCompare(a.timeFrom || "00:00");
                return timeCompare;
            });

            return (
                <div>
                    <div className="page-header"><div><h1 className="page-title">Calendar</h1><p className="page-subtitle">Track progress</p></div><button className="btn btn-primary" onClick={onAdd}>âž• Add Activity</button></div>
                    <div className="calendar-page-grid">
                        <div className="calendar-container">
                            <div className="calendar-header">
                                <div className="calendar-nav"><button className="calendar-nav-btn" onClick={() => view === "year" ? navY(-1) : navM(-1)}>â†</button><h2 className="calendar-title">{view === "year" ? currentDate.getFullYear() : `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`}</h2><button className="calendar-nav-btn" onClick={() => view === "year" ? navY(1) : navM(1)}>â†’</button></div>
                                <div className="calendar-view-toggle"><button className={`view-toggle-btn ${view === "month" ? "active" : ""}`} onClick={() => setView("month")}>Month</button><button className={`view-toggle-btn ${view === "year" ? "active" : ""}`} onClick={() => setView("year")}>Year</button></div>
                            </div>
                            {view === "month" ? (
                                <div className="calendar-grid">
                                    {days.map((d) => <div key={d} className="calendar-weekday">{d}</div>)}
                                    {dayArr.map((d, i) => <div key={i} className={`calendar-day ${!d.cur ? "other-month" : ""} ${isToday(d.date) ? "today" : ""} ${isSel(d.date) ? "selected" : ""}`} onClick={() => setSelectedDate(d.date)}><span className="day-number">{d.date.getDate()}</span>{d.cur && <div className={`health-indicator health-${getHealth(d.date)}`}></div>}</div>)}
                                </div>
                            ) : (
                                <div className="year-grid">
                                    {months.map((m, i) => { const md = new Date(currentDate.getFullYear(), i, 1), mdays = getDays(md); return <div key={m} className="month-card" onClick={() => { setCurrentDate(md); setView("month"); }}><div className="month-name">{m}</div><div className="mini-calendar">{days.map((d) => <div key={d} className="mini-day" style={{ fontSize: "6px", color: "var(--text-muted)" }}>{d[0]}</div>)}{mdays.slice(0, 42).map((d, j) => { const h = getHealth(d.date), bg = !d.cur ? "transparent" : h === "excellent" ? "var(--accent-green)" : h === "good" ? "var(--accent-blue)" : h === "fair" ? "var(--accent-orange)" : h === "poor" ? "var(--accent-red)" : "#E8E8F0"; return <div key={j} className="mini-day" style={{ background: bg, opacity: d.cur ? h === "none" ? 0.3 : 0.7 : 0.1 }}></div>; })}</div></div>; })}
                                </div>
                            )}
                            <div style={{ display: "flex", gap: "20px", marginTop: "24px", justifyContent: "center", flexWrap: "wrap" }}>
                                <div style={{ display: "flex", alignItems: "center", gap: "6px", fontSize: "12px", color: "var(--text-secondary)" }}><div className="health-indicator health-excellent"></div>Excellent (80%+)</div>
                                <div style={{ display: "flex", alignItems: "center", gap: "6px", fontSize: "12px", color: "var(--text-secondary)" }}><div className="health-indicator health-good"></div>Good (60-80%)</div>
                                <div style={{ display: "flex", alignItems: "center", gap: "6px", fontSize: "12px", color: "var(--text-secondary)" }}><div className="health-indicator health-fair"></div>Fair (40-60%)</div>
                                <div style={{ display: "flex", alignItems: "center", gap: "6px", fontSize: "12px", color: "var(--text-secondary)" }}><div className="health-indicator health-poor"></div>Poor (&lt;40%)</div>
                            </div>
                        </div>
                        <div className="card">
                            <div className="card-header"><h3 className="card-title">{formatDate(selectedDate)}</h3><span style={{ fontSize: "12px", color: "var(--text-secondary)" }}>{selActs.length} items</span></div>
                            {selActs.length > 0 ? (
                                <div style={{ maxHeight: "450px", overflowY: "auto" }}>
                                    {selActs.map((a) => {
                                        const c = categories.find((x) => x.name === a.category);
                                        const isExpanded = expandedId === a.id;
                                        const dur = calcDuration(a.timeFrom, a.timeTo);
                                        return (
                                            <div key={a.id}>
                                                <div className="cal-activity" style={{ borderLeftColor: c?.color || "var(--primary)" }} onClick={() => setExpandedId(isExpanded ? null : a.id)}>
                                                    <div className="cal-activity-header">
                                                        <span className="cal-activity-icon">{c?.icon}</span>
                                                        <span className="cal-activity-title">{a.item}</span>
                                                        <span className={`status-badge status-${a.status?.toLowerCase().replace(/\s+/g, "")}`}>{a.status}</span>
                                                    </div>
                                                    <div className="cal-activity-time">{a.timeFrom} - {a.timeTo} ({formatDuration(dur)})</div>
                                                </div>
                                                {isExpanded && (
                                                    <div className="cal-detail">
                                                        <div className="cal-detail-title">{c?.icon} {a.item}</div>
                                                        <div className="cal-detail-row"><span className="cal-detail-label">Time:</span>{a.timeFrom} - {a.timeTo}</div>
                                                        <div className="cal-detail-row"><span className="cal-detail-label">Duration:</span><span className="duration-badge">â±ï¸ {formatDuration(dur)}</span></div>
                                                        <div className="cal-detail-row"><span className="cal-detail-label">Category:</span><span className={`category-badge category-${a.category?.toLowerCase()}`}>{c?.icon} {a.category}</span></div>
                                                        <div className="cal-detail-row"><span className="cal-detail-label">Status:</span><span className={`status-badge status-${a.status?.toLowerCase().replace(/\s+/g, "")}`}>{a.status}</span></div>
                                                        {a.notes && <div className="cal-detail-row"><span className="cal-detail-label">Notes:</span>{a.notes}</div>}
                                                        <div className="cal-detail-actions">
                                                            <button className="btn btn-secondary btn-sm" onClick={(e) => { e.stopPropagation(); onEdit(a); }}>âœï¸ Edit</button>
                                                            <button className="btn btn-danger btn-sm" onClick={(e) => { e.stopPropagation(); onDelete(a.id); setExpandedId(null); }}>ðŸ—‘ï¸ Delete</button>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            ) : <div className="empty-state" style={{ padding: "40px 20px" }}><div className="empty-icon">ðŸ“…</div><p>No activities</p></div>}
                        </div>
                    </div>
                </div>
            );
        }

        function Statistics({ activities, categories, statuses, period, setPeriod }) {
            const getRange = () => {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                if (period === "daily") return { start: getLocalDateStr(today), end: getLocalDateStr(today) };
                if (period === "weekly") {
                    const ws = new Date(today);
                    ws.setDate(today.getDate() - today.getDay());
                    const we = new Date(ws);
                    we.setDate(ws.getDate() + 6);
                    return { start: getLocalDateStr(ws), end: getLocalDateStr(we) };
                }
                const ms = new Date(today.getFullYear(), today.getMonth(), 1);
                const me = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                return { start: getLocalDateStr(ms), end: getLocalDateStr(me) };
            };
            const { start, end } = getRange();
            const filtered = useMemo(() => activities.filter((a) => a.date >= start && a.date <= end), [activities, start, end]);
            const catStats = useMemo(() => categories.map((c) => {
                const ca = filtered.filter((a) => a.category === c.name);
                const mins = ca.reduce((s, a) => s + calcDuration(a.timeFrom, a.timeTo), 0);
                return { name: c.name, icon: c.icon, color: c.color, value: mins, hours: (mins / 60).toFixed(1), count: ca.length };
            }).filter((c) => c.value > 0), [filtered, categories]);
            const statusStats = useMemo(() => statuses.map((s) => ({ name: s.name, value: filtered.filter((a) => a.status === s.name).length, color: s.color })).filter((s) => s.value > 0), [filtered, statuses]);
            const total = catStats.reduce((s, c) => s + c.value, 0);
            const rate = filtered.length > 0 ? Math.round((filtered.filter((a) => a.status === "Finished").length / filtered.length) * 100) : 0;
            return (
                <div>
                    <div className="page-header"><div><h1 className="page-title">Statistics</h1><p className="page-subtitle">Analyze patterns</p></div></div>
                    <div className="period-selector">{["daily", "weekly", "monthly"].map((p) => <button key={p} className={`period-btn ${period === p ? "active" : ""}`} onClick={() => setPeriod(p)}>{p.charAt(0).toUpperCase() + p.slice(1)}</button>)}</div>
                    <div className="dashboard-grid" style={{ marginBottom: "24px" }}>
                        <div className="stat-card"><div className="stat-icon" style={{ background: "rgba(108,92,231,0.1)" }}>ðŸ“Š</div><div className="stat-value">{filtered.length}</div><div className="stat-label">Total Activities</div></div>
                        <div className="stat-card"><div className="stat-icon" style={{ background: "rgba(0,206,201,0.1)" }}>â±ï¸</div><div className="stat-value">{(total / 60).toFixed(1)}h</div><div className="stat-label">Time Logged</div></div>
                        <div className="stat-card"><div className="stat-icon" style={{ background: "rgba(0,184,148,0.1)" }}>âœ…</div><div className="stat-value">{rate}%</div><div className="stat-label">Completion Rate</div></div>
                        <div className="stat-card"><div className="stat-icon" style={{ background: "rgba(253,203,110,0.1)" }}>ðŸ†</div><div className="stat-value">{catStats[0]?.name || "-"}</div><div className="stat-label">Top Category</div></div>
                    </div>
                    <div className="charts-grid">
                        <div className="chart-card"><div className="card-header"><h3 className="card-title">Time by Category</h3></div><PieChart data={catStats} totalLabel={period} /></div>
                        <div className="chart-card"><div className="card-header"><h3 className="card-title">Status Distribution</h3></div><BarChart data={statusStats} /></div>
                    </div>
                    <div className="suggestions-card"><h3 className="suggestions-title">ðŸ“ˆ Insights</h3><div className="suggestion-item"><div className="suggestion-icon">ðŸ“Š</div><div className="suggestion-text">{rate >= 70 ? `Excellent! ${rate}% completion rate. Keep it up!` : rate >= 50 ? `Good effort! ${rate}% completion. Try smaller tasks.` : `${rate}% completion. Set more realistic goals.`}</div></div>{catStats.find((c) => c.name === "Study") && <div className="suggestion-item"><div className="suggestion-icon">ðŸ“š</div><div className="suggestion-text">Logged {catStats.find((c) => c.name === "Study")?.hours || 0}h study time this {period.replace("ly", "")}.</div></div>}</div>
                </div>
            );
        }

        function Settings({ categories, setCategories, statuses, setStatuses }) {
            const [newCat, setNewCat] = useState({ name: "", color: "#6C5CE7", icon: "ðŸ“Œ" });
            const [newStat, setNewStat] = useState({ name: "", color: "#74B9FF" });
            const addCat = () => { if (newCat.name.trim()) { setCategories([...categories, { ...newCat, id: generateId() }]); setNewCat({ name: "", color: "#6C5CE7", icon: "ðŸ“Œ" }); } };
            const delCat = (id) => { if (categories.length > 1) setCategories(categories.filter((c) => c.id !== id)); };
            const addStat = () => { if (newStat.name.trim()) { setStatuses([...statuses, { ...newStat, id: generateId() }]); setNewStat({ name: "", color: "#74B9FF" }); } };
            const delStat = (id) => { if (statuses.length > 1) setStatuses(statuses.filter((s) => s.id !== id)); };
            return (
                <div>
                    <div className="page-header"><div><h1 className="page-title">Settings</h1><p className="page-subtitle">Customize categories and statuses</p></div></div>
                    <div className="settings-section"><h3 className="settings-title">ðŸ“ Categories</h3><div className="settings-list">{categories.map((c) => <div key={c.id} className="settings-item"><div className="settings-item-color" style={{ background: c.color }}></div><span>{c.icon} {c.name}</span><button onClick={() => delCat(c.id)}>Ã—</button></div>)}</div><div className="add-item-form"><input type="text" placeholder="Name" value={newCat.name} onChange={(e) => setNewCat({ ...newCat, name: e.target.value })} /><input type="text" placeholder="Icon" style={{ maxWidth: "80px" }} value={newCat.icon} onChange={(e) => setNewCat({ ...newCat, icon: e.target.value })} /><input type="color" style={{ width: "50px", padding: "4px" }} value={newCat.color} onChange={(e) => setNewCat({ ...newCat, color: e.target.value })} /><button className="btn btn-primary btn-sm" onClick={addCat}>Add</button></div></div>
                    <div className="settings-section"><h3 className="settings-title">ðŸ“‹ Statuses</h3><div className="settings-list">{statuses.map((s) => <div key={s.id} className="settings-item"><div className="settings-item-color" style={{ background: s.color }}></div><span>{s.name}</span><button onClick={() => delStat(s.id)}>Ã—</button></div>)}</div><div className="add-item-form"><input type="text" placeholder="Name" value={newStat.name} onChange={(e) => setNewStat({ ...newStat, name: e.target.value })} /><input type="color" style={{ width: "50px", padding: "4px" }} value={newStat.color} onChange={(e) => setNewStat({ ...newStat, color: e.target.value })} /><button className="btn btn-primary btn-sm" onClick={addStat}>Add</button></div></div>

                    <div className="settings-section">
                        <h3 className="settings-title">â„¹ï¸ About</h3>
                        <div style={{ display: "flex", justifyContent: "space-between", padding: "8px 0", borderBottom: "1px solid #eee", fontSize: "14px" }}>
                            <span style={{ color: "var(--text-secondary)" }}>Version</span>
                            <span style={{ fontWeight: "600" }}>{APP_VERSION}</span>
                        </div>
                        <div style={{ display: "flex", justifyContent: "space-between", padding: "8px 0", fontSize: "14px" }}>
                            <span style={{ color: "var(--text-secondary)" }}>Developer</span>
                            <span>Yang's Agent</span>
                        </div>
                    </div>

                    <div className="settings-section"><h3 className="settings-title">âš ï¸ Data Management</h3><p style={{ color: "var(--text-secondary)", marginBottom: "16px", fontSize: "14px" }}>Reset all data. Cannot be undone.</p><button className="btn btn-danger" onClick={() => { if (confirm("Reset all data?")) { localStorage.removeItem("yang_activities"); localStorage.removeItem("yang_categories"); localStorage.removeItem("yang_statuses"); window.location.reload(); } }}>ðŸ—‘ï¸ Reset All Data</button></div>
                </div>
            );
        }

        function Modal({ activity, categories, statuses, onSave, onClose }) {
            const today = getLocalDateStr();
            const getDefaultForm = (prevTimeTo) => ({ date: today, timeFrom: prevTimeTo || "09:00", timeTo: addOneHour(prevTimeTo || "09:00"), category: categories[0]?.name || "", item: "", notes: "", status: "Planning" });
            const addOneHour = (time) => { const [h, m] = time.split(":").map(Number); const newH = (h + 1) % 24; return `${String(newH).padStart(2, "0")}:${String(m).padStart(2, "0")}`; };
            const [form, setForm] = useState(activity || getDefaultForm());
            const [error, setError] = useState(null);
            const [addedCount, setAddedCount] = useState(0);
            const isEditMode = !!activity;
            const inputRef = React.useRef(null);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!form.item.trim()) return;

                // Validate time range: Time To must be later than Time From
                if (form.timeFrom && form.timeTo) {
                    const fromM = timeStrToMins(form.timeFrom);
                    const toM = timeStrToMins(form.timeTo);
                    if (toM <= fromM) {
                        setError("âŒ æ—¶é—´é”™è¯¯ï¼'Time To' å¿…é¡»æ™šäºŽ 'Time From'ã€‚");
                        return;
                    }
                }

                onSave(form, !isEditMode);
                if (!isEditMode) {
                    const nextTimeFrom = form.timeTo;
                    setForm({ ...getDefaultForm(nextTimeFrom), date: form.date, category: form.category });
                    setError(null);
                    setAddedCount(c => c + 1);
                    setTimeout(() => inputRef.current?.focus(), 50);
                }
            };

            // Calculate duration for display
            const duration = calcDuration(form.timeFrom, form.timeTo);

            return (
                <div className="modal-overlay" onClick={(e) => e.target === e.currentTarget && onClose()}>
                    <div className="modal">
                        <h2 className="modal-title">{isEditMode ? "âœï¸ Edit Activity" : "âž• New Activity"}{!isEditMode && addedCount > 0 && <span style={{ fontSize: "14px", fontWeight: "normal", color: "var(--accent-green)", marginLeft: "12px" }}>âœ“ {addedCount} added</span>}</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group"><label className="form-label">Activity Name *</label><input ref={inputRef} type="text" className="form-input" placeholder="What are you planning?" value={form.item} onChange={(e) => { setForm({ ...form, item: e.target.value }); setError(null); }} required autoFocus /></div>
                            <div className="form-row"><div className="form-group"><label className="form-label">Date *</label><input type="date" className="form-input" value={form.date} onChange={(e) => setForm({ ...form, date: e.target.value })} required /></div><div className="form-group"><label className="form-label">Category *</label><select className="form-select" value={form.category} onChange={(e) => setForm({ ...form, category: e.target.value })} required>{categories.map((c) => <option key={c.id} value={c.name}>{c.icon} {c.name}</option>)}</select></div></div>
                            <div className="form-row">
                                <div className="form-group"><label className="form-label">Time From</label><input type="time" className="form-input" value={form.timeFrom} onChange={(e) => {
                                    setError(null);
                                    const newTimeFrom = e.target.value;
                                    // Auto-adjust timeTo to 1 hour after timeFrom
                                    const newTimeTo = newTimeFrom ? addOneHour(newTimeFrom) : form.timeTo;
                                    setForm({ ...form, timeFrom: newTimeFrom, timeTo: newTimeTo });
                                }} /></div>
                                <div className="form-group"><label className="form-label">Time To</label><input type="time" className="form-input" value={form.timeTo} onChange={(e) => { setForm({ ...form, timeTo: e.target.value }); setError(null); }} /></div>
                            </div>
                            {duration > 0 && (
                                <div style={{ marginBottom: "20px", textAlign: "center" }}>
                                    <span className="duration-badge" style={{ fontSize: "14px", padding: "8px 16px" }}>â±ï¸ Duration: {formatDuration(duration)}</span>
                                </div>
                            )}
                            <div className="form-group"><label className="form-label">Status</label><select className="form-select" value={form.status} onChange={(e) => setForm({ ...form, status: e.target.value })}>{statuses.map((s) => <option key={s.id} value={s.name}>{s.name}</option>)}</select></div>
                            <div className="form-group"><label className="form-label">Notes</label><textarea className="form-textarea" placeholder="Additional notes..." value={form.notes} onChange={(e) => setForm({ ...form, notes: e.target.value })} /></div>
                            {error && <div style={{ color: "#E17055", fontSize: "13px", marginBottom: "16px", padding: "10px", backgroundColor: "rgba(225, 112, 85, 0.1)", borderRadius: "6px", border: "1px solid rgba(225, 112, 85, 0.2)" }}>{error}</div>}
                            <div className="modal-actions">
                                <button type="button" className="btn btn-secondary" onClick={onClose}>{isEditMode ? "Cancel" : (addedCount > 0 ? "âœ“ Done" : "Cancel")}</button>
                                <button type="submit" className="btn btn-primary">{isEditMode ? "Save Changes" : (addedCount > 0 ? "Add Next +" : "Add Activity")}</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function TokenModal({ onClose }) {
            const [token, setToken] = useState(localStorage.getItem("yang_github_token") || "");
            const [showToken, setShowToken] = useState(false);
            const handleSave = () => { if (token.trim()) { localStorage.setItem("yang_github_token", token.trim()); alert("âœ… GitHub token saved successfully!"); onClose(); } else { localStorage.removeItem("yang_github_token"); alert("Token removed"); onClose(); } };
            return (
                <div className="modal-overlay" onClick={(e) => e.target === e.currentTarget && onClose()}>
                    <div className="modal">
                        <h2 className="modal-title">ðŸ”‘ GitHub Token Settings</h2>
                        <p style={{ fontSize: "14px", color: "var(--text-secondary)", marginBottom: "16px" }}>To save data to GitHub, you need a Personal Access Token with <code>repo</code> permission.</p>
                        <div className="form-group"><label className="form-label">GitHub Personal Access Token</label><input type={showToken ? "text" : "password"} className="form-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" value={token} onChange={(e) => setToken(e.target.value)} autoFocus /><div style={{ marginTop: "8px" }}><label style={{ fontSize: "12px", color: "var(--text-secondary)", cursor: "pointer" }}><input type="checkbox" checked={showToken} onChange={(e) => setShowToken(e.target.checked)} style={{ marginRight: "6px" }} />Show token</label></div></div>
                        <div style={{ background: "#F8F9FE", padding: "12px", borderRadius: "8px", fontSize: "12px", marginBottom: "16px" }}><strong>How to create a token:</strong><ol style={{ marginTop: "8px", paddingLeft: "20px" }}><li>Go to <a href="https://github.com/settings/tokens/new?scopes=repo&description=Yang+Daily+Planner" target="_blank" rel="noopener" style={{ color: "var(--primary)" }}>GitHub Token Settings</a></li><li>Generate a new token (classic)</li><li>Select <code>repo</code> scope</li><li>Copy and paste the token here</li></ol></div>
                        <div className="modal-actions"><button type="button" className="btn btn-secondary" onClick={onClose}>Cancel</button><button type="button" className="btn btn-primary" onClick={handleSave}>Save Token</button></div>
                    </div>
                </div>
            );
        }

        function BulkEditModal({ count, categories, statuses, onSave, onClose }) {
            const [updates, setUpdates] = useState({ category: "", status: "" });
            const [enableCat, setEnableCat] = useState(false);
            const [enableStat, setEnableStat] = useState(false);

            const handleSave = () => {
                const finalUpdates = {};
                if (enableCat && updates.category) finalUpdates.category = updates.category;
                if (enableStat && updates.status) finalUpdates.status = updates.status;
                if (Object.keys(finalUpdates).length > 0) onSave(finalUpdates);
                else onClose(); // Close if no updates
            };

            return (
                <div className="modal-overlay" onClick={(e) => e.target === e.currentTarget && onClose()}>
                    <div className="modal">
                        <h2 className="modal-title">âœï¸ Bulk Edit ({count} items)</h2>
                        <div className="form-group">
                            <label className="form-label" style={{ display: "flex", alignItems: "center", gap: "8px", cursor: "pointer" }}>
                                <input type="checkbox" checked={enableCat} onChange={(e) => setEnableCat(e.target.checked)} />
                                Update Category
                            </label>
                            <select className="form-select" value={updates.category} onChange={(e) => setUpdates({ ...updates, category: e.target.value })} disabled={!enableCat}>
                                <option value="">Select Category...</option>
                                {categories.map((c) => <option key={c.id} value={c.name}>{c.icon} {c.name}</option>)}
                            </select>
                        </div>
                        <div className="form-group">
                            <label className="form-label" style={{ display: "flex", alignItems: "center", gap: "8px", cursor: "pointer" }}>
                                <input type="checkbox" checked={enableStat} onChange={(e) => setEnableStat(e.target.checked)} />
                                Update Status
                            </label>
                            <select className="form-select" value={updates.status} onChange={(e) => setUpdates({ ...updates, status: e.target.value })} disabled={!enableStat}>
                                <option value="">Select Status...</option>
                                {statuses.map((s) => <option key={s.id} value={s.name}>{s.name}</option>)}
                            </select>
                        </div>
                        <div className="modal-actions">
                            <button className="btn btn-secondary" onClick={onClose}>Cancel</button>
                            <button className="btn btn-primary" onClick={handleSave}>Apply to All</button>
                        </div>
                    </div>
                </div>
            );
        }

        function ConfirmModal({ title, message, onConfirm, onCancel }) {
            return (
                <div className="modal-overlay" onClick={(e) => e.target === e.currentTarget && onCancel()}>
                    <div className="modal" style={{ maxWidth: "400px" }}>
                        <h2 className="modal-title">{title}</h2>
                        <p style={{ marginBottom: "20px", color: "var(--text-secondary)" }}>{message}</p>
                        <div className="modal-actions">
                            <button className="btn btn-secondary" onClick={onCancel}>Cancel</button>
                            <button className="btn btn-danger" onClick={onConfirm}>Delete</button>
                        </div>
                    </div>
                </div>
            );
        }


        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>

</html>