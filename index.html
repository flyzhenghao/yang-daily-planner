<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Yang's Daily Planner</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet" />
        <style>
            *{margin:0;padding:0;box-sizing:border-box}
            :root{--primary:#6c5ce7;--primary-light:#a29bfe;--secondary:#00cec9;--accent-pink:#fd79a8;--accent-orange:#fdcb6e;--accent-green:#00b894;--accent-blue:#74b9ff;--accent-red:#e17055;--bg-main:#f8f9fe;--bg-card:#ffffff;--text-primary:#2d3436;--text-secondary:#636e72;--text-muted:#b2bec3;--shadow-sm:0 2px 8px rgba(108,92,231,0.08);--shadow-md:0 4px 20px rgba(108,92,231,0.12);--radius-sm:8px;--radius-md:12px;--radius-lg:20px;--radius-xl:28px}
            body{font-family:"Quicksand",sans-serif;background:var(--bg-main);color:var(--text-primary);min-height:100vh}
            .app-container{display:flex;min-height:100vh}
            .sidebar{width:280px;background:linear-gradient(180deg,var(--primary) 0%,#5b4cd4 100%);padding:24px;display:flex;flex-direction:column;position:fixed;height:100vh;z-index:100}
            .logo{display:flex;align-items:center;gap:12px;margin-bottom:40px;padding:8px}
            .logo-icon{width:48px;height:48px;background:rgba(255,255,255,0.2);border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;font-size:24px}
            .logo-text{color:white;font-family:"Nunito",sans-serif;font-weight:800;font-size:22px}
            .logo-sub{color:rgba(255,255,255,0.7);font-size:12px;font-weight:500}
            .nav-menu{display:flex;flex-direction:column;gap:8px;flex:1}
            .nav-item{display:flex;align-items:center;gap:14px;padding:14px 18px;border-radius:var(--radius-md);color:rgba(255,255,255,0.7);cursor:pointer;transition:all 0.3s ease;font-weight:600;font-size:15px}
            .nav-item:hover{background:rgba(255,255,255,0.1);color:white}
            .nav-item.active{background:rgba(255,255,255,0.2);color:white;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
            .nav-icon{font-size:20px;width:24px;text-align:center}
            .user-profile{display:flex;align-items:center;gap:12px;padding:16px;background:rgba(255,255,255,0.1);border-radius:var(--radius-md);margin-top:auto}
            .avatar{width:44px;height:44px;background:linear-gradient(135deg,var(--accent-pink),var(--accent-orange));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;color:white;font-weight:700}
            .user-info{color:white}
            .user-name{font-weight:700;font-size:15px}
            .user-role{font-size:12px;opacity:0.7}
            .main-content{flex:1;margin-left:280px;padding:32px;max-width:calc(100vw - 280px)}
            .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}
            .page-title{font-family:"Nunito",sans-serif;font-size:32px;font-weight:800;color:var(--text-primary)}
            .page-subtitle{color:var(--text-secondary);font-size:14px;margin-top:4px}
            .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 24px;border-radius:var(--radius-md);font-family:"Quicksand",sans-serif;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.3s ease;border:none;outline:none}
            .btn-primary{background:linear-gradient(135deg,var(--primary) 0%,#5b4cd4 100%);color:white;box-shadow:0 4px 15px rgba(108,92,231,0.4)}
            .btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(108,92,231,0.5)}
            .btn-secondary{background:white;color:var(--text-primary);border:2px solid #e8e8f0}
            .btn-secondary:hover{border-color:var(--primary);color:var(--primary)}
            .btn-danger{background:var(--accent-red);color:white}
            .btn-sm{padding:8px 16px;font-size:13px}
            .card{background:var(--bg-card);border-radius:var(--radius-lg);padding:24px;box-shadow:var(--shadow-sm);transition:all 0.3s ease}
            .card:hover{box-shadow:var(--shadow-md)}
            .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
            .card-title{font-family:"Nunito",sans-serif;font-size:18px;font-weight:700;color:var(--text-primary)}
            .dashboard-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:24px;margin-bottom:32px}
            .stat-card{background:var(--bg-card);border-radius:var(--radius-lg);padding:24px;box-shadow:var(--shadow-sm);position:relative;overflow:hidden}
            .stat-card::before{content:"";position:absolute;top:0;left:0;right:0;height:4px}
            .stat-card.study::before{background:var(--primary)}
            .stat-card.entertainment::before{background:var(--accent-pink)}
            .stat-card.exercise::before{background:var(--accent-green)}
            .stat-card.social::before{background:var(--accent-orange)}
            .stat-icon{width:48px;height:48px;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:16px}
            .stat-card.study .stat-icon{background:rgba(108,92,231,0.1)}
            .stat-card.entertainment .stat-icon{background:rgba(253,121,168,0.1)}
            .stat-card.exercise .stat-icon{background:rgba(0,184,148,0.1)}
            .stat-card.social .stat-icon{background:rgba(253,203,110,0.1)}
            .stat-value{font-family:"Nunito",sans-serif;font-size:28px;font-weight:800;color:var(--text-primary);margin-bottom:4px}
            .stat-label{font-size:14px;color:var(--text-secondary)}
            .activity-table{width:100%;border-collapse:separate;border-spacing:0 8px}
            .activity-table th{text-align:left;padding:12px 16px;font-size:12px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px}
            .activity-table td{padding:16px;background:#fafbff;font-size:14px}
            .activity-table tr td:first-child{border-radius:var(--radius-md) 0 0 var(--radius-md)}
            .activity-table tr td:last-child{border-radius:0 var(--radius-md) var(--radius-md) 0}
            .category-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600}
            .category-study{background:rgba(108,92,231,0.1);color:var(--primary)}
            .category-entertainment{background:rgba(253,121,168,0.1);color:var(--accent-pink)}
            .category-exercise{background:rgba(0,184,148,0.1);color:var(--accent-green)}
            .category-social{background:rgba(253,203,110,0.1);color:#e17055}
            .category-sleep{background:rgba(116,185,255,0.1);color:var(--accent-blue)}
            .category-other{background:rgba(99,110,114,0.1);color:var(--text-secondary)}
            .status-badge{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600;white-space:nowrap}
            .status-planning{background:rgba(116,185,255,0.15);color:#0984e3}
            .status-processing{background:rgba(253,203,110,0.15);color:#e17055}
            .status-finished{background:rgba(0,184,148,0.15);color:var(--accent-green)}
            .status-partialfinished{background:rgba(108,92,231,0.15);color:var(--primary)}
            .status-abandoned{background:rgba(178,190,195,0.15);color:var(--text-secondary)}
            .action-btns{display:flex;gap:8px}
            .action-btn{width:32px;height:32px;border-radius:var(--radius-sm);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;font-size:14px}
            .action-btn.edit{background:rgba(108,92,231,0.1);color:var(--primary)}
            .action-btn.delete{background:rgba(225,112,85,0.1);color:var(--accent-red)}
            .action-btn:hover{transform:scale(1.1)}
            .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(45,52,54,0.5);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000;animation:fadeIn 0.2s ease}
            @keyframes fadeIn{from{opacity:0}to{opacity:1}}
            .modal{background:white;border-radius:var(--radius-xl);padding:32px;width:100%;max-width:560px;max-height:90vh;overflow-y:auto;box-shadow:0 8px 40px rgba(108,92,231,0.16);animation:slideUp 0.3s ease}
            @keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
            .modal-title{font-family:"Nunito",sans-serif;font-size:24px;font-weight:800;margin-bottom:24px;color:var(--text-primary)}
            .form-group{margin-bottom:20px}
            .form-label{display:block;font-size:13px;font-weight:600;color:var(--text-secondary);margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px}
            .form-input,.form-select,.form-textarea{width:100%;padding:12px 16px;border:2px solid #e8e8f0;border-radius:var(--radius-md);font-family:"Quicksand",sans-serif;font-size:14px;transition:all 0.2s ease;outline:none}
            .form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--primary);box-shadow:0 0 0 4px rgba(108,92,231,0.1)}
            .form-textarea{resize:vertical;min-height:80px}
            .form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
            .modal-actions{display:flex;gap:12px;justify-content:flex-end;margin-top:28px;padding-top:20px;border-top:1px solid #e8e8f0}
            .calendar-container{background:var(--bg-card);border-radius:var(--radius-lg);padding:24px;box-shadow:var(--shadow-sm)}
            .calendar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
            .calendar-nav{display:flex;align-items:center;gap:16px}
            .calendar-nav-btn{width:40px;height:40px;border-radius:var(--radius-sm);border:2px solid #e8e8f0;background:white;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;transition:all 0.2s ease}
            .calendar-nav-btn:hover{border-color:var(--primary);color:var(--primary)}
            .calendar-title{font-family:"Nunito",sans-serif;font-size:20px;font-weight:700}
            .calendar-view-toggle{display:flex;background:#f5f5fa;border-radius:var(--radius-sm);padding:4px}
            .view-toggle-btn{padding:8px 16px;border:none;background:transparent;border-radius:6px;font-family:"Quicksand",sans-serif;font-weight:600;font-size:13px;cursor:pointer;transition:all 0.2s ease;color:var(--text-secondary)}
            .view-toggle-btn.active{background:white;color:var(--primary);box-shadow:var(--shadow-sm)}
            .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
            .calendar-weekday{text-align:center;font-size:12px;font-weight:600;color:var(--text-muted);padding:8px;text-transform:uppercase}
            .calendar-day{aspect-ratio:1;border-radius:var(--radius-md);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s ease;background:#fafbff;position:relative;min-height:60px}
            .calendar-day:hover{transform:scale(1.05);box-shadow:var(--shadow-md)}
            .calendar-day.other-month{opacity:0.3}
            .calendar-day.today{border:2px solid var(--primary)}
            .calendar-day.selected{background:var(--primary);color:white}
            .calendar-day .day-number{font-weight:600;font-size:14px}
            .calendar-day .health-indicator{width:8px;height:8px;border-radius:50%;margin-top:4px}
            .health-excellent{background:var(--accent-green)}
            .health-good{background:var(--accent-blue)}
            .health-fair{background:var(--accent-orange)}
            .health-poor{background:var(--accent-red)}
            .health-none{background:var(--text-muted)}
            .year-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:24px}
            .month-card{background:#fafbff;border-radius:var(--radius-md);padding:16px;cursor:pointer;transition:all 0.2s ease}
            .month-card:hover{background:white;box-shadow:var(--shadow-md)}
            .month-name{font-weight:700;font-size:14px;margin-bottom:12px;color:var(--text-primary)}
            .mini-calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:2px}
            .mini-day{aspect-ratio:1;border-radius:4px;font-size:8px;display:flex;align-items:center;justify-content:center}
            .charts-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:32px}
            .chart-card{background:var(--bg-card);border-radius:var(--radius-lg);padding:24px;box-shadow:var(--shadow-sm)}
            .pie-chart-container{display:flex;align-items:center;justify-content:center;gap:30px;padding:20px;flex-wrap:wrap}
            .pie-chart{width:180px;height:180px;border-radius:50%;position:relative}
            .pie-chart-inner{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100px;height:100px;background:white;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center}
            .pie-chart-total{font-family:"Nunito",sans-serif;font-size:24px;font-weight:800;color:var(--text-primary)}
            .pie-chart-label{font-size:11px;color:var(--text-secondary)}
            .pie-legend{display:flex;flex-direction:column;gap:10px}
            .legend-item{display:flex;align-items:center;gap:10px;font-size:13px}
            .legend-color{width:14px;height:14px;border-radius:4px}
            .legend-value{color:var(--text-secondary);margin-left:auto;font-weight:600}
            .bar-chart-container{padding:20px 10px}
            .bar-chart-item{display:flex;align-items:center;gap:12px;margin-bottom:16px}
            .bar-label{width:100px;font-size:13px;font-weight:500;color:var(--text-secondary)}
            .bar-track{flex:1;height:24px;background:#f5f5fa;border-radius:12px;overflow:hidden}
            .bar-fill{height:100%;border-radius:12px;transition:width 0.5s ease;display:flex;align-items:center;padding-left:10px}
            .bar-value{font-size:12px;font-weight:600;color:white}
            .suggestions-card{background:linear-gradient(135deg,var(--primary) 0%,#5b4cd4 100%);border-radius:var(--radius-lg);padding:28px;color:white;margin-top:24px}
            .suggestions-title{font-family:"Nunito",sans-serif;font-size:20px;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:10px}
            .suggestion-item{display:flex;align-items:flex-start;gap:12px;padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.1)}
            .suggestion-item:last-child{border-bottom:none}
            .suggestion-icon{width:32px;height:32px;background:rgba(255,255,255,0.2);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;flex-shrink:0}
            .suggestion-text{font-size:14px;line-height:1.5;opacity:0.9}
            .settings-section{background:var(--bg-card);border-radius:var(--radius-lg);padding:24px;margin-bottom:24px;box-shadow:var(--shadow-sm)}
            .settings-title{font-family:"Nunito",sans-serif;font-size:18px;font-weight:700;margin-bottom:20px;color:var(--text-primary)}
            .settings-list{display:flex;flex-wrap:wrap;gap:8px}
            .settings-item{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;background:#fafbff;border-radius:var(--radius-md);font-size:14px}
            .settings-item-color{width:12px;height:12px;border-radius:50%}
            .settings-item button{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:16px;padding:0 4px}
            .settings-item button:hover{color:var(--accent-red)}
            .add-item-form{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
            .add-item-form input{flex:1;min-width:120px;padding:10px 16px;border:2px solid #e8e8f0;border-radius:var(--radius-md);font-family:"Quicksand",sans-serif;outline:none}
            .add-item-form input:focus{border-color:var(--primary)}
            .period-selector{display:flex;background:#f5f5fa;border-radius:var(--radius-sm);padding:4px;margin-bottom:24px;width:fit-content}
            .period-btn{padding:10px 20px;border:none;background:transparent;border-radius:6px;font-family:"Quicksand",sans-serif;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.2s ease;color:var(--text-secondary)}
            .period-btn.active{background:white;color:var(--primary);box-shadow:var(--shadow-sm)}
            .empty-state{text-align:center;padding:60px 20px;color:var(--text-secondary)}
            .empty-icon{font-size:64px;margin-bottom:16px;opacity:0.5}
            .empty-title{font-family:"Nunito",sans-serif;font-size:20px;font-weight:700;margin-bottom:8px;color:var(--text-primary)}
            .health-score-container{display:flex;align-items:center;justify-content:center;padding:20px}
            .health-score-circle{width:160px;height:160px;border-radius:50%;display:flex;align-items:center;justify-content:center}
            .health-score-inner{width:120px;height:120px;border-radius:50%;background:white;display:flex;flex-direction:column;align-items:center;justify-content:center}
            .health-score-value{font-family:"Nunito",sans-serif;font-size:48px;font-weight:800;line-height:1}
            .health-score-label{font-size:14px;color:var(--text-secondary);margin-top:4px}
            /* Calendar activity compact style v1.1.0 */
            .cal-activity{padding:8px 10px;background:#FAFBFF;border-radius:var(--radius-sm);margin-bottom:4px;cursor:pointer;transition:all 0.15s ease;border-left:3px solid transparent}
            .cal-activity:hover{background:#F0F1FF;transform:translateX(2px)}
            .cal-activity-header{display:flex;align-items:center;gap:6px;flex-wrap:nowrap}
            .cal-activity-icon{font-size:14px;flex-shrink:0}
            .cal-activity-title{font-weight:600;font-size:13px;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0}
            .cal-activity-time{font-size:10px;color:var(--text-secondary);margin-top:2px}
            .cal-detail{background:white;border-radius:var(--radius-md);padding:16px;margin-bottom:8px;box-shadow:var(--shadow-md);animation:slideUp 0.2s ease}
            .cal-detail-title{font-family:"Nunito",sans-serif;font-size:16px;font-weight:700;margin-bottom:12px}
            .cal-detail-row{display:flex;align-items:center;gap:8px;font-size:13px;margin-bottom:8px}
            .cal-detail-label{color:var(--text-secondary);min-width:60px}
            .cal-detail-actions{display:flex;justify-content:flex-end;gap:8px;padding-top:12px;border-top:1px solid #e8e8f0;margin-top:8px}
            @media (max-width:1200px){.dashboard-grid{grid-template-columns:repeat(2,1fr)}.charts-grid{grid-template-columns:1fr}}
            @media (max-width:768px){.sidebar{width:80px;padding:16px}.logo-text,.logo-sub,.nav-item span,.user-info{display:none}.main-content{margin-left:80px;max-width:calc(100vw - 80px)}.dashboard-grid{grid-template-columns:1fr}.year-grid{grid-template-columns:repeat(2,1fr)}}
        </style>
    </head>
    <body>
        <div id="root"></div>
        <script type="text/babel">
const { useState, useEffect, useMemo } = React;
const APP_VERSION = "v1.1.0";
const GITHUB_OWNER = "flyzhenghao";
const GITHUB_REPO = "yang-daily-planner";
const GITHUB_FILE_PATH = "data.json";
const GITHUB_BRANCH = "main";

const defaultCategories = [
    { id: 1, name: "Study", color: "#6C5CE7", icon: "üìö" },
    { id: 2, name: "Entertainment", color: "#FD79A8", icon: "üéÆ" },
    { id: 3, name: "Social", color: "#FDCB6E", icon: "üë•" },
    { id: 4, name: "Exercise", color: "#00B894", icon: "üèÉ" },
    { id: 5, name: "Sleep", color: "#74B9FF", icon: "üò¥" },
    { id: 6, name: "Other", color: "#636E72", icon: "üìå" },
];
const defaultStatuses = [
    { id: 1, name: "Planning", color: "#74B9FF" },
    { id: 2, name: "Processing", color: "#FDCB6E" },
    { id: 3, name: "Finished", color: "#00B894" },
    { id: 4, name: "Partial Finished", color: "#6C5CE7" },
    { id: 5, name: "Abandoned", color: "#B2BEC3" },
];
const formatDate = (date) => new Date(date).toLocaleDateString("en-NZ", { year: "numeric", month: "short", day: "numeric" });
const generateId = () => Date.now() + Math.random().toString(36).substr(2, 9);
const getLS = (key, def) => { try { const s = localStorage.getItem(key); return s ? JSON.parse(s) : def; } catch { return def; } };
const setLS = (key, val) => { try { localStorage.setItem(key, JSON.stringify(val)); } catch (e) { console.error(e); } };

async function loadDataFromGitHub() {
    try {
        const response = await fetch(`data.json?t=${Date.now()}`, { cache: "no-cache" });
        if (response.ok) {
            const data = await response.json();
            if (data.activities) setLS("yang_activities", data.activities);
            if (data.categories) setLS("yang_categories", data.categories);
            if (data.statuses) setLS("yang_statuses", data.statuses);
            return data;
        }
    } catch (error) { console.log("Using localStorage fallback"); }
    return { activities: getLS("yang_activities", []), categories: getLS("yang_categories", defaultCategories), statuses: getLS("yang_statuses", defaultStatuses) };
}

async function saveDataToGitHub(activities, categories, statuses) {
    const token = localStorage.getItem("yang_github_token");
    if (!token) { alert("‚ö†Ô∏è GitHub token not configured. Please set it in Settings."); return false; }
    try {
        const dataObj = { version: APP_VERSION, lastUpdated: new Date().toISOString(), activities, categories, statuses };
        const content = JSON.stringify(dataObj, null, 2);
        const encodedContent = btoa(unescape(encodeURIComponent(content)));
        const getResponse = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_FILE_PATH}?ref=${GITHUB_BRANCH}&t=${Date.now()}`, { headers: { Authorization: `token ${token}`, Accept: "application/vnd.github.v3+json" }, cache: "no-cache" });
        if (!getResponse.ok) throw new Error(`Failed to get file info: ${getResponse.status}`);
        const fileData = await getResponse.json();
        const updateResponse = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_FILE_PATH}`, { method: "PUT", headers: { Authorization: `token ${token}`, Accept: "application/vnd.github.v3+json", "Content-Type": "application/json" }, body: JSON.stringify({ message: `Update data - ${new Date().toISOString()}`, content: encodedContent, sha: fileData.sha, branch: GITHUB_BRANCH }) });
        if (!updateResponse.ok) { const errorData = await updateResponse.json(); throw new Error(`Failed: ${errorData.message || "Unknown error"}`); }
        return true;
    } catch (error) { console.error("Error saving to GitHub:", error); alert(`‚ùå Failed to save to GitHub: ${error.message}`); return false; }
}

function PieChart({ data, totalLabel }) {
    const total = data.reduce((s, i) => s + i.value, 0);
    if (total === 0) return <div className="empty-state" style={{ padding: "40px 20px" }}><div className="empty-icon">üìä</div><p>No data</p></div>;
    let parts = [], angle = 0;
    data.forEach((i) => { const a = (i.value / total) * 360; parts.push(`${i.color} ${angle}deg ${angle + a}deg`); angle += a; });
    return (
        <div className="pie-chart-container">
            <div className="pie-chart" style={{ background: `conic-gradient(${parts.join(", ")})` }}>
                <div className="pie-chart-inner"><div className="pie-chart-total">{Math.round(total / 60)}h</div><div className="pie-chart-label">{totalLabel || "Total"}</div></div>
            </div>
            <div className="pie-legend">{data.map((i, idx) => <div key={idx} className="legend-item"><div className="legend-color" style={{ background: i.color }}></div><span>{i.icon} {i.name}</span><span className="legend-value">{Math.round(i.value)}m</span></div>)}</div>
        </div>
    );
}

function BarChart({ data }) {
    const max = Math.max(...data.map((d) => d.value), 1);
    if (data.length === 0) return <div className="empty-state" style={{ padding: "40px 20px" }}><div className="empty-icon">üìä</div><p>No data</p></div>;
    return <div className="bar-chart-container">{data.map((i, idx) => <div key={idx} className="bar-chart-item"><div className="bar-label">{i.name}</div><div className="bar-track"><div className="bar-fill" style={{ width: `${Math.max((i.value / max) * 100, i.value > 0 ? 10 : 0)}%`, background: i.color }}>{i.value > 0 && <span className="bar-value">{i.value}</span>}</div></div></div>)}</div>;
}

function App() {
    const [page, setPage] = useState("dashboard");
    const [activities, setActivities] = useState([]);
    const [categories, setCategories] = useState(defaultCategories);
    const [statuses, setStatuses] = useState(defaultStatuses);
    const [showModal, setShowModal] = useState(false);
    const [showTokenModal, setShowTokenModal] = useState(false);
    const [editingActivity, setEditingActivity] = useState(null);
    const [selectedDate, setSelectedDate] = useState(new Date());
    const [calendarView, setCalendarView] = useState("month");
    const [period, setPeriod] = useState("daily");
    const [isLoading, setIsLoading] = useState(true);
    const [isSaving, setIsSaving] = useState(false);

    useEffect(() => { loadDataFromGitHub().then((data) => { if (data.activities) setActivities(data.activities); if (data.categories) setCategories(data.categories); if (data.statuses) setStatuses(data.statuses); setIsLoading(false); }); }, []);
    useEffect(() => { if (!isLoading) setLS("yang_activities", activities); }, [activities, isLoading]);
    useEffect(() => { if (!isLoading) setLS("yang_categories", categories); }, [categories, isLoading]);
    useEffect(() => { if (!isLoading) setLS("yang_statuses", statuses); }, [statuses, isLoading]);

    const handleSaveToGitHub = async () => { setIsSaving(true); const success = await saveDataToGitHub(activities, categories, statuses); setIsSaving(false); if (success) alert("‚úÖ Data saved to GitHub successfully!"); };
    const addActivity = (a) => setActivities([...activities, { ...a, id: generateId() }]);
    const updateActivity = (a) => setActivities(activities.map((x) => (x.id === a.id ? a : x)));
    const deleteActivity = (id) => { if (confirm("Delete this activity?")) setActivities(activities.filter((a) => a.id !== id)); };
    const openEdit = (a) => { setEditingActivity(a); setShowModal(true); };
    const closeModal = () => { setShowModal(false); setEditingActivity(null); };

    const navItems = [{ id: "dashboard", icon: "üìä", label: "Dashboard" }, { id: "activities", icon: "üìù", label: "Activities" }, { id: "calendar", icon: "üìÖ", label: "Calendar" }, { id: "statistics", icon: "üìà", label: "Statistics" }, { id: "settings", icon: "‚öôÔ∏è", label: "Settings" }];

    return (
        <div className="app-container">
            <aside className="sidebar">
                <div className="logo"><div className="logo-icon">üåü</div><div><div className="logo-text">Yang's Planner</div><div className="logo-sub">Daily Management</div></div></div>
                <nav className="nav-menu">{navItems.map((i) => <div key={i.id} className={`nav-item ${page === i.id ? "active" : ""}`} onClick={() => setPage(i.id)}><span className="nav-icon">{i.icon}</span><span>{i.label}</span></div>)}</nav>
                <div style={{ padding: "16px 0", borderTop: "1px solid rgba(255,255,255,0.1)" }}>
                    <button className="btn btn-primary" onClick={handleSaveToGitHub} disabled={isSaving} style={{ width: "100%", fontSize: "13px", padding: "10px" }}>{isSaving ? "‚è≥ Saving..." : "üíæ Save to GitHub"}</button>
                    <button className="btn btn-secondary" onClick={() => setShowTokenModal(true)} style={{ width: "100%", fontSize: "13px", padding: "8px", marginTop: "8px" }}>üîë GitHub Token</button>
                    <div style={{ fontSize: "10px", color: "rgba(255,255,255,0.5)", textAlign: "center", marginTop: "8px" }}>{APP_VERSION}</div>
                </div>
                <div className="user-profile"><div className="avatar">Y</div><div className="user-info"><div className="user-name">Yang</div><div className="user-role">Year 9 Student</div></div></div>
            </aside>
            <main className="main-content">
                {page === "dashboard" && <Dashboard activities={activities} categories={categories} onAdd={() => setShowModal(true)} setPage={setPage} />}
                {page === "activities" && <Activities activities={activities} categories={categories} statuses={statuses} onAdd={() => setShowModal(true)} onEdit={openEdit} onDelete={deleteActivity} />}
                {page === "calendar" && <Calendar activities={activities} categories={categories} statuses={statuses} selectedDate={selectedDate} setSelectedDate={setSelectedDate} view={calendarView} setView={setCalendarView} onAdd={() => setShowModal(true)} onEdit={openEdit} onDelete={deleteActivity} />}
                {page === "statistics" && <Statistics activities={activities} categories={categories} statuses={statuses} period={period} setPeriod={setPeriod} />}
                {page === "settings" && <Settings categories={categories} setCategories={setCategories} statuses={statuses} setStatuses={setStatuses} />}
            </main>
            {showModal && <Modal activity={editingActivity} categories={categories} statuses={statuses} onSave={(a) => { editingActivity ? updateActivity(a) : addActivity(a); closeModal(); }} onClose={closeModal} />}
            {showTokenModal && <TokenModal onClose={() => setShowTokenModal(false)} />}
        </div>
    );
}

function Dashboard({ activities, categories, onAdd, setPage }) {
    const today = new Date().toISOString().split("T")[0];
    const todayActs = activities.filter((a) => a.date === today);
    const stats = useMemo(() => {
        const cs = categories.map((c) => { const ca = todayActs.filter((a) => a.category === c.name); const mins = ca.reduce((s, a) => { if (a.timeFrom && a.timeTo) { const f = new Date(`2000-01-01T${a.timeFrom}`), t = new Date(`2000-01-01T${a.timeTo}`); return s + Math.max(0, (t - f) / 60000); } return s; }, 0); return { ...c, minutes: mins, hours: (mins / 60).toFixed(1) }; });
        const tot = cs.reduce((s, c) => s + c.minutes, 0);
        return cs.map((c) => ({ ...c, percentage: tot > 0 ? Math.round((c.minutes / tot) * 100) : 0 }));
    }, [todayActs, categories]);
    const healthScore = useMemo(() => { const st = stats.find((s) => s.name === "Study")?.minutes || 0, ex = stats.find((s) => s.name === "Exercise")?.minutes || 0; const sl = stats.find((s) => s.name === "Sleep")?.minutes || 0, en = stats.find((s) => s.name === "Entertainment")?.minutes || 0; let score = 50; if (st >= 180 && st <= 300) score += 15; else if (st >= 120) score += 10; else if (st > 300) score += 5; if (ex >= 30 && ex <= 60) score += 15; else if (ex > 0) score += 8; if (sl >= 480 && sl <= 540) score += 15; else if (sl >= 420) score += 10; else if (sl > 0) score += 5; if (en > 0 && en <= 120) score += 5; else if (en > 120) score -= 5; return Math.min(100, Math.max(0, score)); }, [stats]);
    const getColor = (s) => s >= 80 ? "#00B894" : s >= 60 ? "#74B9FF" : s >= 40 ? "#FDCB6E" : "#E17055";
    const pieData = stats.filter((s) => s.minutes > 0).map((s) => ({ name: s.name, value: s.minutes, color: s.color, icon: s.icon }));

    return (
        <div>
            <div className="page-header"><div><h1 className="page-title">Good {new Date().getHours() < 12 ? "Morning" : new Date().getHours() < 18 ? "Afternoon" : "Evening"}, Yang! üëã</h1><p className="page-subtitle">Overview for {formatDate(new Date())}</p></div><button className="btn btn-primary" onClick={onAdd}>‚ûï Add Activity</button></div>
            <div className="dashboard-grid">{stats.slice(0, 4).map((s) => <div key={s.id} className={`stat-card ${s.name.toLowerCase()}`}><div className="stat-icon">{s.icon}</div><div className="stat-value">{s.hours}h</div><div className="stat-label">{s.name} ({s.percentage}%)</div></div>)}</div>
            <div className="charts-grid">
                <div className="chart-card"><div className="card-header"><h3 className="card-title">Time Distribution</h3></div><PieChart data={pieData} totalLabel="Today" /></div>
                <div className="chart-card"><div className="card-header"><h3 className="card-title">Health Score</h3></div><div className="health-score-container"><div className="health-score-circle" style={{ background: `conic-gradient(${getColor(healthScore)} ${healthScore * 3.6}deg, #F5F5FA ${healthScore * 3.6}deg)` }}><div className="health-score-inner"><div className="health-score-value" style={{ color: getColor(healthScore) }}>{healthScore}</div><div className="health-score-label">Health Score</div></div></div></div></div>
            </div>
            <div className="card">
                <div className="card-header"><h3 className="card-title">Today ({todayActs.length})</h3><button className="btn btn-secondary btn-sm" onClick={() => setPage("activities")}>View All ‚Üí</button></div>
                {todayActs.length > 0 ? <table className="activity-table"><thead><tr><th>Time</th><th>Activity</th><th>Category</th><th>Status</th></tr></thead><tbody>{todayActs.slice(0, 5).map((a) => { const c = categories.find((x) => x.name === a.category); return <tr key={a.id}><td>{a.timeFrom}-{a.timeTo}</td><td>{a.item}</td><td><span className={`category-badge category-${a.category?.toLowerCase()}`}>{c?.icon} {a.category}</span></td><td><span className={`status-badge status-${a.status?.toLowerCase().replace(/\s+/g, "")}`}>{a.status}</span></td></tr>; })}</tbody></table> : <div className="empty-state"><div className="empty-icon">üìù</div><h3 className="empty-title">No activities today</h3><p>Add your first activity!</p></div>}
            </div>
            <div className="suggestions-card"><h3 className="suggestions-title">üí° Smart Suggestions</h3><Suggestions stats={stats} healthScore={healthScore} /></div>
        </div>
    );
}

function Suggestions({ stats, healthScore }) {
    const tips = useMemo(() => { const t = [], st = stats.find((s) => s.name === "Study")?.minutes || 0, ex = stats.find((s) => s.name === "Exercise")?.minutes || 0; const sl = stats.find((s) => s.name === "Sleep")?.minutes || 0, en = stats.find((s) => s.name === "Entertainment")?.minutes || 0; if (st < 120) t.push({ icon: "üìö", text: "Add more study time. Aim for 3-5 hours for Y9." }); else if (st > 360) t.push({ icon: "‚ö†Ô∏è", text: "Studying a lot! Take breaks to avoid burnout." }); if (ex < 30) t.push({ icon: "üèÉ", text: "Try to get 30-60 minutes of exercise daily." }); if (sl > 0 && sl < 480) t.push({ icon: "üò¥", text: "Teens need 8-10 hours sleep. Try to sleep earlier!" }); if (en > 180) t.push({ icon: "üéÆ", text: "Screen time is high. Balance with other activities." }); if (healthScore >= 80) t.push({ icon: "üåü", text: "Great job maintaining healthy balance!" }); if (t.length === 0) t.push({ icon: "‚ú®", text: "Start logging activities for personalized tips!" }); return t; }, [stats, healthScore]);
    return <div>{tips.map((t, i) => <div key={i} className="suggestion-item"><div className="suggestion-icon">{t.icon}</div><div className="suggestion-text">{t.text}</div></div>)}</div>;
}

function Activities({ activities, categories, statuses, onAdd, onEdit, onDelete }) {
    const [filter, setFilter] = useState({ category: "", status: "", search: "" });
    const filtered = useMemo(() => { let r = [...activities]; if (filter.category) r = r.filter((a) => a.category === filter.category); if (filter.status) r = r.filter((a) => a.status === filter.status); if (filter.search) { const s = filter.search.toLowerCase(); r = r.filter((a) => a.item?.toLowerCase().includes(s) || a.notes?.toLowerCase().includes(s)); } r.sort((a, b) => new Date(b.date + "T" + (b.timeFrom || "00:00")) - new Date(a.date + "T" + (a.timeFrom || "00:00"))); return r; }, [activities, filter]);
    return (
        <div>
            <div className="page-header"><div><h1 className="page-title">Activities</h1><p className="page-subtitle">Manage all activities</p></div><button className="btn btn-primary" onClick={onAdd}>‚ûï Add Activity</button></div>
            <div className="card" style={{ marginBottom: "24px" }}><div style={{ display: "flex", gap: "16px", flexWrap: "wrap" }}><input type="text" placeholder="üîç Search..." className="form-input" style={{ maxWidth: "250px" }} value={filter.search} onChange={(e) => setFilter({ ...filter, search: e.target.value })} /><select className="form-select" style={{ maxWidth: "180px" }} value={filter.category} onChange={(e) => setFilter({ ...filter, category: e.target.value })}><option value="">All Categories</option>{categories.map((c) => <option key={c.id} value={c.name}>{c.icon} {c.name}</option>)}</select><select className="form-select" style={{ maxWidth: "180px" }} value={filter.status} onChange={(e) => setFilter({ ...filter, status: e.target.value })}><option value="">All Statuses</option>{statuses.map((s) => <option key={s.id} value={s.name}>{s.name}</option>)}</select></div></div>
            <div className="card">{filtered.length > 0 ? <table className="activity-table"><thead><tr><th>Date</th><th>Time</th><th>Activity</th><th>Category</th><th>Status</th><th>Notes</th><th>Actions</th></tr></thead><tbody>{filtered.map((a) => { const c = categories.find((x) => x.name === a.category); return <tr key={a.id}><td>{formatDate(a.date)}</td><td>{a.timeFrom}-{a.timeTo}</td><td style={{ fontWeight: 600 }}>{a.item}</td><td><span className={`category-badge category-${a.category?.toLowerCase()}`}>{c?.icon} {a.category}</span></td><td><span className={`status-badge status-${a.status?.toLowerCase().replace(/\s+/g, "")}`}>{a.status}</span></td><td style={{ maxWidth: "200px", overflow: "hidden", textOverflow: "ellipsis" }}>{a.notes || "-"}</td><td><div className="action-btns"><button className="action-btn edit" onClick={() => onEdit(a)}>‚úèÔ∏è</button><button className="action-btn delete" onClick={() => onDelete(a.id)}>üóëÔ∏è</button></div></td></tr>; })}</tbody></table> : <div className="empty-state"><div className="empty-icon">üìù</div><h3 className="empty-title">No activities found</h3><p>Adjust filters or add new</p></div>}</div>
        </div>
    );
}

function Calendar({ activities, categories, statuses, selectedDate, setSelectedDate, view, setView, onAdd, onEdit, onDelete }) {
    const [currentDate, setCurrentDate] = useState(new Date());
    const [expandedId, setExpandedId] = useState(null);
    const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
    const getDays = (d) => { const y = d.getFullYear(), m = d.getMonth(), first = new Date(y, m, 1), last = new Date(y, m + 1, 0), dim = last.getDate(), sd = first.getDay(); const arr = []; const prev = new Date(y, m, 0); for (let i = sd - 1; i >= 0; i--) arr.push({ date: new Date(y, m - 1, prev.getDate() - i), cur: false }); for (let i = 1; i <= dim; i++) arr.push({ date: new Date(y, m, i), cur: true }); const rem = 42 - arr.length; for (let i = 1; i <= rem; i++) arr.push({ date: new Date(y, m + 1, i), cur: false }); return arr; };
    const getHealth = (d) => { const ds = d.toISOString().split("T")[0], da = activities.filter((a) => a.date === ds); if (da.length === 0) return "none"; const f = da.filter((a) => a.status === "Finished").length, r = f / da.length; if (r >= 0.8) return "excellent"; if (r >= 0.6) return "good"; if (r >= 0.4) return "fair"; return "poor"; };
    const navM = (dir) => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + dir, 1));
    const navY = (dir) => setCurrentDate(new Date(currentDate.getFullYear() + dir, currentDate.getMonth(), 1));
    const isToday = (d) => d.toDateString() === new Date().toDateString();
    const isSel = (d) => d.toDateString() === selectedDate.toDateString();
    const dayArr = getDays(currentDate);
    const selStr = selectedDate.toISOString().split("T")[0], selActs = activities.filter((a) => a.date === selStr);

    return (
        <div>
            <div className="page-header"><div><h1 className="page-title">Calendar</h1><p className="page-subtitle">Track progress</p></div><button className="btn btn-primary" onClick={onAdd}>‚ûï Add Activity</button></div>
            <div style={{ display: "grid", gridTemplateColumns: "2fr 1fr", gap: "24px" }}>
                <div className="calendar-container">
                    <div className="calendar-header">
                        <div className="calendar-nav"><button className="calendar-nav-btn" onClick={() => view === "year" ? navY(-1) : navM(-1)}>‚Üê</button><h2 className="calendar-title">{view === "year" ? currentDate.getFullYear() : `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`}</h2><button className="calendar-nav-btn" onClick={() => view === "year" ? navY(1) : navM(1)}>‚Üí</button></div>
                        <div className="calendar-view-toggle"><button className={`view-toggle-btn ${view === "month" ? "active" : ""}`} onClick={() => setView("month")}>Month</button><button className={`view-toggle-btn ${view === "year" ? "active" : ""}`} onClick={() => setView("year")}>Year</button></div>
                    </div>
                    {view === "month" ? (
                        <div className="calendar-grid">
                            {days.map((d) => <div key={d} className="calendar-weekday">{d}</div>)}
                            {dayArr.map((d, i) => <div key={i} className={`calendar-day ${!d.cur ? "other-month" : ""} ${isToday(d.date) ? "today" : ""} ${isSel(d.date) ? "selected" : ""}`} onClick={() => setSelectedDate(d.date)}><span className="day-number">{d.date.getDate()}</span>{d.cur && <div className={`health-indicator health-${getHealth(d.date)}`}></div>}</div>)}
                        </div>
                    ) : (
                        <div className="year-grid">
                            {months.map((m, i) => { const md = new Date(currentDate.getFullYear(), i, 1), mdays = getDays(md); return <div key={m} className="month-card" onClick={() => { setCurrentDate(md); setView("month"); }}><div className="month-name">{m}</div><div className="mini-calendar">{days.map((d) => <div key={d} className="mini-day" style={{ fontSize: "6px", color: "var(--text-muted)" }}>{d[0]}</div>)}{mdays.slice(0, 42).map((d, j) => { const h = getHealth(d.date), bg = !d.cur ? "transparent" : h === "excellent" ? "var(--accent-green)" : h === "good" ? "var(--accent-blue)" : h === "fair" ? "var(--accent-orange)" : h === "poor" ? "var(--accent-red)" : "#E8E8F0"; return <div key={j} className="mini-day" style={{ background: bg, opacity: d.cur ? h === "none" ? 0.3 : 0.7 : 0.1 }}></div>; })}</div></div>; })}
                        </div>
                    )}
                    <div style={{ display: "flex", gap: "20px", marginTop: "24px", justifyContent: "center", flexWrap: "wrap" }}>
                        <div style={{ display: "flex", alignItems: "center", gap: "6px", fontSize: "12px", color: "var(--text-secondary)" }}><div className="health-indicator health-excellent"></div>Excellent (80%+)</div>
                        <div style={{ display: "flex", alignItems: "center", gap: "6px", fontSize: "12px", color: "var(--text-secondary)" }}><div className="health-indicator health-good"></div>Good (60-80%)</div>
                        <div style={{ display: "flex", alignItems: "center", gap: "6px", fontSize: "12px", color: "var(--text-secondary)" }}><div className="health-indicator health-fair"></div>Fair (40-60%)</div>
                        <div style={{ display: "flex", alignItems: "center", gap: "6px", fontSize: "12px", color: "var(--text-secondary)" }}><div className="health-indicator health-poor"></div>Poor (&lt;40%)</div>
                    </div>
                </div>
                <div className="card">
                    <div className="card-header"><h3 className="card-title">{formatDate(selectedDate)}</h3><span style={{ fontSize: "12px", color: "var(--text-secondary)" }}>{selActs.length} items</span></div>
                    {selActs.length > 0 ? (
                        <div style={{ maxHeight: "450px", overflowY: "auto" }}>
                            {selActs.map((a) => {
                                const c = categories.find((x) => x.name === a.category);
                                const isExpanded = expandedId === a.id;
                                return (
                                    <div key={a.id}>
                                        <div className="cal-activity" style={{ borderLeftColor: c?.color || "var(--primary)" }} onClick={() => setExpandedId(isExpanded ? null : a.id)}>
                                            <div className="cal-activity-header">
                                                <span className="cal-activity-icon">{c?.icon}</span>
                                                <span className="cal-activity-title">{a.item}</span>
                                                <span className={`status-badge status-${a.status?.toLowerCase().replace(/\s+/g, "")}`}>{a.status}</span>
                                            </div>
                                            <div className="cal-activity-time">{a.timeFrom} - {a.timeTo}</div>
                                        </div>
                                        {isExpanded && (
                                            <div className="cal-detail">
                                                <div className="cal-detail-title">{c?.icon} {a.item}</div>
                                                <div className="cal-detail-row"><span className="cal-detail-label">Time:</span>{a.timeFrom} - {a.timeTo}</div>
                                                <div className="cal-detail-row"><span className="cal-detail-label">Category:</span><span className={`category-badge category-${a.category?.toLowerCase()}`}>{c?.icon} {a.category}</span></div>
                                                <div className="cal-detail-row"><span className="cal-detail-label">Status:</span><span className={`status-badge status-${a.status?.toLowerCase().replace(/\s+/g, "")}`}>{a.status}</span></div>
                                                {a.notes && <div className="cal-detail-row"><span className="cal-detail-label">Notes:</span>{a.notes}</div>}
                                                <div className="cal-detail-actions">
                                                    <button className="btn btn-secondary btn-sm" onClick={(e) => { e.stopPropagation(); onEdit(a); }}>‚úèÔ∏è Edit</button>
                                                    <button className="btn btn-danger btn-sm" onClick={(e) => { e.stopPropagation(); onDelete(a.id); setExpandedId(null); }}>üóëÔ∏è Delete</button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    ) : <div className="empty-state" style={{ padding: "40px 20px" }}><div className="empty-icon">üìÖ</div><p>No activities</p></div>}
                </div>
            </div>
        </div>
    );
}

function Statistics({ activities, categories, statuses, period, setPeriod }) {
    const getRange = () => { const now = new Date(), today = new Date(now.getFullYear(), now.getMonth(), now.getDate()); if (period === "daily") return { start: today, end: today }; if (period === "weekly") { const ws = new Date(today); ws.setDate(today.getDate() - today.getDay()); const we = new Date(ws); we.setDate(ws.getDate() + 6); return { start: ws, end: we }; } const ms = new Date(today.getFullYear(), today.getMonth(), 1), me = new Date(today.getFullYear(), today.getMonth() + 1, 0); return { start: ms, end: me }; };
    const { start, end } = getRange();
    const filtered = useMemo(() => activities.filter((a) => { const d = new Date(a.date); return d >= start && d <= end; }), [activities, start, end]);
    const catStats = useMemo(() => categories.map((c) => { const ca = filtered.filter((a) => a.category === c.name), mins = ca.reduce((s, a) => { if (a.timeFrom && a.timeTo) { const f = new Date(`2000-01-01T${a.timeFrom}`), t = new Date(`2000-01-01T${a.timeTo}`); return s + Math.max(0, (t - f) / 60000); } return s; }, 0); return { name: c.name, icon: c.icon, color: c.color, value: mins, hours: (mins / 60).toFixed(1), count: ca.length }; }).filter((c) => c.value > 0), [filtered, categories]);
    const statusStats = useMemo(() => statuses.map((s) => ({ name: s.name, value: filtered.filter((a) => a.status === s.name).length, color: s.color })).filter((s) => s.value > 0), [filtered, statuses]);
    const total = catStats.reduce((s, c) => s + c.value, 0);
    const rate = filtered.length > 0 ? Math.round((filtered.filter((a) => a.status === "Finished").length / filtered.length) * 100) : 0;
    return (
        <div>
            <div className="page-header"><div><h1 className="page-title">Statistics</h1><p className="page-subtitle">Analyze patterns</p></div></div>
            <div className="period-selector">{["daily", "weekly", "monthly"].map((p) => <button key={p} className={`period-btn ${period === p ? "active" : ""}`} onClick={() => setPeriod(p)}>{p.charAt(0).toUpperCase() + p.slice(1)}</button>)}</div>
            <div className="dashboard-grid" style={{ marginBottom: "24px" }}>
                <div className="stat-card"><div className="stat-icon" style={{ background: "rgba(108,92,231,0.1)" }}>üìä</div><div className="stat-value">{filtered.length}</div><div className="stat-label">Total Activities</div></div>
                <div className="stat-card"><div className="stat-icon" style={{ background: "rgba(0,206,201,0.1)" }}>‚è±Ô∏è</div><div className="stat-value">{(total / 60).toFixed(1)}h</div><div className="stat-label">Time Logged</div></div>
                <div className="stat-card"><div className="stat-icon" style={{ background: "rgba(0,184,148,0.1)" }}>‚úÖ</div><div className="stat-value">{rate}%</div><div className="stat-label">Completion Rate</div></div>
                <div className="stat-card"><div className="stat-icon" style={{ background: "rgba(253,203,110,0.1)" }}>üèÜ</div><div className="stat-value">{catStats[0]?.name || "-"}</div><div className="stat-label">Top Category</div></div>
            </div>
            <div className="charts-grid">
                <div className="chart-card"><div className="card-header"><h3 className="card-title">Time by Category</h3></div><PieChart data={catStats} totalLabel={period} /></div>
                <div className="chart-card"><div className="card-header"><h3 className="card-title">Status Distribution</h3></div><BarChart data={statusStats} /></div>
            </div>
            <div className="suggestions-card"><h3 className="suggestions-title">üìà Insights</h3><div className="suggestion-item"><div className="suggestion-icon">üìä</div><div className="suggestion-text">{rate >= 70 ? `Excellent! ${rate}% completion rate. Keep it up!` : rate >= 50 ? `Good effort! ${rate}% completion. Try smaller tasks.` : `${rate}% completion. Set more realistic goals.`}</div></div>{catStats.find((c) => c.name === "Study") && <div className="suggestion-item"><div className="suggestion-icon">üìö</div><div className="suggestion-text">Logged {catStats.find((c) => c.name === "Study")?.hours || 0}h study time this {period.replace("ly", "")}.</div></div>}</div>
        </div>
    );
}

function Settings({ categories, setCategories, statuses, setStatuses }) {
    const [newCat, setNewCat] = useState({ name: "", color: "#6C5CE7", icon: "üìå" });
    const [newStat, setNewStat] = useState({ name: "", color: "#74B9FF" });
    const addCat = () => { if (newCat.name.trim()) { setCategories([...categories, { ...newCat, id: generateId() }]); setNewCat({ name: "", color: "#6C5CE7", icon: "üìå" }); } };
    const delCat = (id) => { if (categories.length > 1) setCategories(categories.filter((c) => c.id !== id)); };
    const addStat = () => { if (newStat.name.trim()) { setStatuses([...statuses, { ...newStat, id: generateId() }]); setNewStat({ name: "", color: "#74B9FF" }); } };
    const delStat = (id) => { if (statuses.length > 1) setStatuses(statuses.filter((s) => s.id !== id)); };
    return (
        <div>
            <div className="page-header"><div><h1 className="page-title">Settings</h1><p className="page-subtitle">Customize categories and statuses</p></div></div>
            <div className="settings-section"><h3 className="settings-title">üìÅ Categories</h3><div className="settings-list">{categories.map((c) => <div key={c.id} className="settings-item"><div className="settings-item-color" style={{ background: c.color }}></div><span>{c.icon} {c.name}</span><button onClick={() => delCat(c.id)}>√ó</button></div>)}</div><div className="add-item-form"><input type="text" placeholder="Name" value={newCat.name} onChange={(e) => setNewCat({ ...newCat, name: e.target.value })} /><input type="text" placeholder="Icon" style={{ maxWidth: "80px" }} value={newCat.icon} onChange={(e) => setNewCat({ ...newCat, icon: e.target.value })} /><input type="color" style={{ width: "50px", padding: "4px" }} value={newCat.color} onChange={(e) => setNewCat({ ...newCat, color: e.target.value })} /><button className="btn btn-primary btn-sm" onClick={addCat}>Add</button></div></div>
            <div className="settings-section"><h3 className="settings-title">üìã Statuses</h3><div className="settings-list">{statuses.map((s) => <div key={s.id} className="settings-item"><div className="settings-item-color" style={{ background: s.color }}></div><span>{s.name}</span><button onClick={() => delStat(s.id)}>√ó</button></div>)}</div><div className="add-item-form"><input type="text" placeholder="Name" value={newStat.name} onChange={(e) => setNewStat({ ...newStat, name: e.target.value })} /><input type="color" style={{ width: "50px", padding: "4px" }} value={newStat.color} onChange={(e) => setNewStat({ ...newStat, color: e.target.value })} /><button className="btn btn-primary btn-sm" onClick={addStat}>Add</button></div></div>
            <div className="settings-section"><h3 className="settings-title">‚ö†Ô∏è Data Management</h3><p style={{ color: "var(--text-secondary)", marginBottom: "16px", fontSize: "14px" }}>Reset all data. Cannot be undone.</p><button className="btn btn-danger" onClick={() => { if (confirm("Reset all data?")) { localStorage.removeItem("yang_activities"); localStorage.removeItem("yang_categories"); localStorage.removeItem("yang_statuses"); window.location.reload(); } }}>üóëÔ∏è Reset All Data</button></div>
        </div>
    );
}

function Modal({ activity, categories, statuses, onSave, onClose }) {
    const today = new Date().toISOString().split("T")[0];
    const [form, setForm] = useState(activity || { date: today, timeFrom: "09:00", timeTo: "10:00", category: categories[0]?.name || "", item: "", notes: "", status: "Planning" });
    const submit = (e) => { e.preventDefault(); if (form.item.trim()) onSave(form); };
    return (
        <div className="modal-overlay" onClick={(e) => e.target === e.currentTarget && onClose()}>
            <div className="modal">
                <h2 className="modal-title">{activity ? "‚úèÔ∏è Edit Activity" : "‚ûï New Activity"}</h2>
                <form onSubmit={submit}>
                    <div className="form-group"><label className="form-label">Activity Name *</label><input type="text" className="form-input" placeholder="What are you planning?" value={form.item} onChange={(e) => setForm({ ...form, item: e.target.value })} required autoFocus /></div>
                    <div className="form-row"><div className="form-group"><label className="form-label">Date *</label><input type="date" className="form-input" value={form.date} onChange={(e) => setForm({ ...form, date: e.target.value })} required /></div><div className="form-group"><label className="form-label">Category *</label><select className="form-select" value={form.category} onChange={(e) => setForm({ ...form, category: e.target.value })} required>{categories.map((c) => <option key={c.id} value={c.name}>{c.icon} {c.name}</option>)}</select></div></div>
                    <div className="form-row"><div className="form-group"><label className="form-label">Time From</label><input type="time" className="form-input" value={form.timeFrom} onChange={(e) => setForm({ ...form, timeFrom: e.target.value })} /></div><div className="form-group"><label className="form-label">Time To</label><input type="time" className="form-input" value={form.timeTo} onChange={(e) => setForm({ ...form, timeTo: e.target.value })} /></div></div>
                    <div className="form-group"><label className="form-label">Status</label><select className="form-select" value={form.status} onChange={(e) => setForm({ ...form, status: e.target.value })}>{statuses.map((s) => <option key={s.id} value={s.name}>{s.name}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Notes</label><textarea className="form-textarea" placeholder="Additional notes..." value={form.notes} onChange={(e) => setForm({ ...form, notes: e.target.value })} /></div>
                    <div className="modal-actions"><button type="button" className="btn btn-secondary" onClick={onClose}>Cancel</button><button type="submit" className="btn btn-primary">{activity ? "Save Changes" : "Add Activity"}</button></div>
                </form>
            </div>
        </div>
    );
}

function TokenModal({ onClose }) {
    const [token, setToken] = useState(localStorage.getItem("yang_github_token") || "");
    const [showToken, setShowToken] = useState(false);
    const handleSave = () => { if (token.trim()) { localStorage.setItem("yang_github_token", token.trim()); alert("‚úÖ GitHub token saved successfully!"); onClose(); } else { localStorage.removeItem("yang_github_token"); alert("Token removed"); onClose(); } };
    return (
        <div className="modal-overlay" onClick={(e) => e.target === e.currentTarget && onClose()}>
            <div className="modal">
                <h2 className="modal-title">üîë GitHub Token Settings</h2>
                <p style={{ fontSize: "14px", color: "var(--text-secondary)", marginBottom: "16px" }}>To save data to GitHub, you need a Personal Access Token with <code>repo</code> permission.</p>
                <div className="form-group"><label className="form-label">GitHub Personal Access Token</label><input type={showToken ? "text" : "password"} className="form-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" value={token} onChange={(e) => setToken(e.target.value)} autoFocus /><div style={{ marginTop: "8px" }}><label style={{ fontSize: "12px", color: "var(--text-secondary)", cursor: "pointer" }}><input type="checkbox" checked={showToken} onChange={(e) => setShowToken(e.target.checked)} style={{ marginRight: "6px" }} />Show token</label></div></div>
                <div style={{ background: "#F8F9FE", padding: "12px", borderRadius: "8px", fontSize: "12px", marginBottom: "16px" }}><strong>How to create a token:</strong><ol style={{ marginTop: "8px", paddingLeft: "20px" }}><li>Go to <a href="https://github.com/settings/tokens/new?scopes=repo&description=Yang+Daily+Planner" target="_blank" rel="noopener" style={{ color: "var(--primary)" }}>GitHub Token Settings</a></li><li>Generate a new token (classic)</li><li>Select <code>repo</code> scope</li><li>Copy and paste the token here</li></ol></div>
                <div className="modal-actions"><button type="button" className="btn btn-secondary" onClick={onClose}>Cancel</button><button type="button" className="btn btn-primary" onClick={handleSave}>Save Token</button></div>
            </div>
        </div>
    );
}

ReactDOM.render(<App />, document.getElementById("root"));
        </script>
    </body>
</html>
