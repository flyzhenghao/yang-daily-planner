<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Yang's Daily Planner</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
        <!-- TweakCN ÂÆûÊó∂È¢ÑËßàÂäüËÉΩ -->
        <script>
            // TweakCN ÂÆûÊó∂È¢ÑËßàÈÖçÁΩÆ
            window.TweakCN = window.TweakCN || {
                enable: true,
                hotReload: true,
                autoRefresh: true,
                logLevel: "info",
            };

            // Âä®ÊÄÅÂä†ËΩΩ TweakCN ËÑöÊú¨
            (function () {
                var script = document.createElement("script");
                script.src =
                    "https://cdn.jsdelivr.net/npm/@tweakcn/core@latest/dist/tweakcn.min.js";
                script.async = true;
                script.onload = function () {
                    console.log("‚úÖ TweakCN ÂÆûÊó∂È¢ÑËßàÂ∑≤ÂêØÁî®");
                    if (window.TweakCN && window.TweakCN.init) {
                        window.TweakCN.init();
                    }
                };
                script.onerror = function () {
                    console.warn("‚ö†Ô∏è TweakCN Âä†ËΩΩÂ§±Ë¥•Ôºå‰ΩÜÂ∫îÁî®‰ªçÂèØÊ≠£Â∏∏‰ΩøÁî®");
                };
                document.head.appendChild(script);
            })();
        </script>
        <link
            href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            :root {
                --primary: #6c5ce7;
                --primary-light: #a29bfe;
                --secondary: #00cec9;
                --accent-pink: #fd79a8;
                --accent-orange: #fdcb6e;
                --accent-green: #00b894;
                --accent-blue: #74b9ff;
                --accent-red: #e17055;
                --bg-main: #f8f9fe;
                --bg-card: #fff;
                --text-primary: #2d3436;
                --text-secondary: #636e72;
                --text-muted: #b2bec3;
                --shadow-sm: 0 2px 8px rgba(108, 92, 231, 0.08);
                --shadow-md: 0 4px 20px rgba(108, 92, 231, 0.12);
                --radius-sm: 8px;
                --radius-md: 12px;
                --radius-lg: 20px;
                --radius-xl: 28px;
            }

            body {
                font-family: "Quicksand", sans-serif;
                background: var(--bg-main);
                color: var(--text-primary);
                min-height: 100vh;
                margin: 0;
                padding: 0;
                overflow-x: hidden;
            }

            .app-container {
                display: flex;
                min-height: 100vh;
                width: 100%;
            }

            .sidebar {
                width: 280px;
                background: linear-gradient(
                    180deg,
                    var(--primary) 0%,
                    #5b4cd4 100%
                );
                padding: 24px;
                display: flex;
                flex-direction: column;
                position: fixed;
                height: 100vh;
                z-index: 100;
            }

            .logo {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 40px;
                padding: 8px;
            }

            .logo-icon {
                width: 48px;
                height: 48px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: var(--radius-md);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
            }

            .logo-text {
                color: #fff;
                font-family: "Nunito", sans-serif;
                font-weight: 800;
                font-size: 22px;
            }

            .logo-sub {
                color: rgba(255, 255, 255, 0.7);
                font-size: 12px;
                font-weight: 500;
            }

            .nav-menu {
                display: flex;
                flex-direction: column;
                gap: 8px;
                flex: 1;
            }

            .nav-item {
                display: flex;
                align-items: center;
                gap: 14px;
                padding: 14px 18px;
                border-radius: var(--radius-md);
                color: rgba(255, 255, 255, 0.7);
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: 600;
                font-size: 15px;
            }

            .nav-item:hover {
                background: rgba(255, 255, 255, 0.1);
                color: #fff;
            }

            .nav-item.active {
                background: rgba(255, 255, 255, 0.2);
                color: #fff;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }

            .nav-icon {
                font-size: 20px;
                width: 24px;
                text-align: center;
            }

            .user-profile {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 16px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: var(--radius-md);
                margin-top: auto;
            }

            .avatar {
                width: 44px;
                height: 44px;
                background: linear-gradient(
                    135deg,
                    var(--accent-pink),
                    var(--accent-orange)
                );
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #fff;
                font-weight: 700;
            }

            .user-info {
                color: #fff;
            }

            .user-name {
                font-weight: 700;
                font-size: 15px;
            }

            .user-role {
                font-size: 12px;
                opacity: 0.7;
            }

            .main-content {
                flex: 1;
                margin-left: 280px;
                padding: 32px;
                max-width: calc(100vw - 280px);
            }

            .page-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 32px;
                flex-wrap: wrap;
                gap: 16px;
            }

            .page-title {
                font-family: "Nunito", sans-serif;
                font-size: 32px;
                font-weight: 800;
                color: var(--text-primary);
            }

            .page-subtitle {
                color: var(--text-secondary);
                font-size: 14px;
                margin-top: 4px;
            }

            .btn {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 12px 24px;
                border-radius: var(--radius-md);
                font-family: "Quicksand", sans-serif;
                font-weight: 600;
                font-size: 14px;
                cursor: pointer;
                transition: all 0.3s ease;
                border: none;
                outline: none;
            }

            .btn-primary {
                background: linear-gradient(
                    135deg,
                    var(--primary) 0%,
                    #5b4cd4 100%
                );
                color: #fff;
                box-shadow: 0 4px 15px rgba(108, 92, 231, 0.4);
            }

            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(108, 92, 231, 0.5);
            }

            .btn-secondary {
                background: #fff;
                color: var(--text-primary);
                border: 2px solid #e8e8f0;
            }

            .btn-secondary:hover {
                border-color: var(--primary);
                color: var(--primary);
            }

            .btn-danger {
                background: var(--accent-red);
                color: #fff;
            }

            .btn-warning {
                background: var(--accent-orange);
                color: #fff;
            }

            .btn-sm {
                padding: 8px 16px;
                font-size: 13px;
            }

            .btn-icon {
                background: none;
                border: none;
                cursor: pointer;
                font-size: 16px;
                padding: 8px;
                border-radius: 50%;
                transition: background 0.2s;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .btn-icon:hover {
                background: rgba(0, 0, 0, 0.05);
            }

            .btn-icon.delete:hover {
                background: rgba(225, 112, 85, 0.1);
            }

            .card {
                background: var(--bg-card);
                border-radius: var(--radius-lg);
                padding: 24px;
                box-shadow: var(--shadow-sm);
                transition: all 0.3s ease;
            }

            .card:hover {
                box-shadow: var(--shadow-md);
            }

            .card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }

            .card-title {
                font-family: "Nunito", sans-serif;
                font-size: 18px;
                font-weight: 700;
                color: var(--text-primary);
            }

            .dashboard-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 24px;
                margin-bottom: 32px;
            }

            .stat-card {
                background: var(--bg-card);
                border-radius: var(--radius-lg);
                padding: 24px;
                box-shadow: var(--shadow-sm);
                position: relative;
                overflow: hidden;
            }

            .stat-card::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
            }

            .stat-card.study::before {
                background: var(--primary);
            }

            .stat-card.entertainment::before {
                background: var(--accent-pink);
            }

            .stat-card.exercise::before {
                background: var(--accent-green);
            }

            .stat-card.social::before {
                background: var(--accent-orange);
            }

            .stat-icon {
                width: 48px;
                height: 48px;
                border-radius: var(--radius-md);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                margin-bottom: 16px;
            }

            .stat-card.study .stat-icon {
                background: rgba(108, 92, 231, 0.1);
            }

            .stat-card.entertainment .stat-icon {
                background: rgba(253, 121, 168, 0.1);
            }

            .stat-card.exercise .stat-icon {
                background: rgba(0, 184, 148, 0.1);
            }

            .stat-card.social .stat-icon {
                background: rgba(253, 203, 110, 0.1);
            }

            .stat-value {
                font-family: "Nunito", sans-serif;
                font-size: 28px;
                font-weight: 800;
                color: var(--text-primary);
                margin-bottom: 4px;
            }

            .stat-label {
                font-size: 14px;
                color: var(--text-secondary);
            }

            .activity-table {
                width: 100%;
                border-collapse: separate;
                border-spacing: 0 8px;
            }

            .activity-table th {
                text-align: left;
                padding: 12px 16px;
                font-size: 12px;
                font-weight: 600;
                color: var(--text-muted);
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .activity-table td {
                padding: 16px;
                background: #fafbff;
                font-size: 14px;
            }

            .activity-table tr td:first-child {
                border-radius: var(--radius-md) 0 0 var(--radius-md);
            }

            .activity-table tr td:last-child {
                border-radius: 0 var(--radius-md) var(--radius-md) 0;
            }

            .activity-table input[type="checkbox"] {
                width: 18px;
                height: 18px;
                cursor: pointer;
                accent-color: var(--primary);
                vertical-align: middle;
            }

            .category-badge {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
            }

            .category-study {
                background: rgba(108, 92, 231, 0.1);
                color: var(--primary);
            }

            .category-entertainment {
                background: rgba(253, 121, 168, 0.1);
                color: var(--accent-pink);
            }

            .category-exercise {
                background: rgba(0, 184, 148, 0.1);
                color: var(--accent-green);
            }

            .category-social {
                background: rgba(253, 203, 110, 0.1);
                color: #e17055;
            }

            .category-sleep {
                background: rgba(116, 185, 255, 0.1);
                color: var(--accent-blue);
            }

            .category-other {
                background: rgba(99, 110, 114, 0.1);
                color: var(--text-secondary);
            }

            .status-badge {
                display: inline-flex;
                align-items: center;
                gap: 4px;
                padding: 4px 10px;
                border-radius: 20px;
                font-size: 11px;
                font-weight: 600;
                white-space: nowrap;
            }

            .status-planning {
                background: rgba(116, 185, 255, 0.15);
                color: #0984e3;
            }

            .status-processing {
                background: rgba(253, 203, 110, 0.15);
                color: #e17055;
            }

            .status-finished {
                background: rgba(0, 184, 148, 0.15);
                color: var(--accent-green);
            }

            .status-partialfinished {
                background: rgba(108, 92, 231, 0.15);
                color: var(--primary);
            }

            .status-abandoned {
                background: rgba(178, 190, 195, 0.15);
                color: var(--text-secondary);
            }

            .mobile-nav {
                display: none;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: #fff;
                padding: 12px;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
                z-index: 1000;
                justify-content: space-around;
                align-items: center;
            }

            .mobile-nav-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 4px;
                color: var(--text-secondary);
                font-size: 10px;
                font-weight: 600;
                text-decoration: none;
                cursor: pointer;
            }

            .mobile-nav-item.active {
                color: var(--primary);
            }

            .mobile-nav-icon {
                font-size: 20px;
            }

            @media (max-width: 768px) {
                .sidebar {
                    display: none;
                }

                .main-content {
                    margin-left: 0 !important;
                    width: 100% !important;
                    max-width: 100% !important;
                    padding: 12px !important;
                    padding-bottom: 90px !important;
                    overflow-x: hidden;
                }

                .app-container {
                    flex-direction: column;
                }

                .dashboard-grid {
                    grid-template-columns: 1fr;
                    gap: 12px;
                }

                .page-header {
                    margin-bottom: 20px;
                    padding: 0 4px;
                }

                .page-title {
                    font-size: 24px;
                }

                .activity-table {
                    display: block;
                }

                .activity-table thead {
                    display: none;
                }

                .activity-table tbody {
                    display: block;
                }

                .activity-table tr {
                    display: flex;
                    flex-wrap: wrap;
                    align-items: center;
                    background: #fff;
                    border: 1px solid #eee;
                    border-radius: var(--radius-md);
                    margin-bottom: 8px;
                    padding: 10px;
                    box-shadow: var(--shadow-sm);
                    gap: 4px;
                    position: relative;
                }

                .activity-table td {
                    display: block;
                    padding: 0;
                    border: none;
                    width: auto;
                }

                .activity-table td[data-label="Select"] {
                    order: 1;
                    margin-right: 8px;
                }

                .activity-table td[data-label="Time"] {
                    order: 2;
                    font-size: 13px;
                    font-weight: 600;
                    color: var(--text-secondary);
                }

                .activity-table td[data-label="Duration"] {
                    order: 3;
                    font-size: 12px;
                    opacity: 0.7;
                    margin-left: 6px;
                }

                .activity-table td[data-label="Date"] {
                    order: 4;
                    margin-left: auto;
                    font-size: 12px;
                    color: #aaa;
                }

                .activity-table td[data-label="Activity"] {
                    order: 10;
                    width: 100%;
                    font-size: 16px;
                    font-weight: 700;
                    color: var(--text-primary);
                    margin: 4px 0 8px;
                }

                .activity-table td[data-label="Category"] {
                    order: 20;
                }

                .activity-table td[data-label="Status"] {
                    order: 21;
                    margin-left: 8px;
                }

                .activity-table td[data-label="Actions"] {
                    order: 30;
                    margin-left: auto;
                }

                .activity-table td::before {
                    display: none !important;
                }

                .activity-table td[data-label="Notes"] {
                    display: none;
                }

                .activity-table .category-badge,
                .activity-table .status-badge {
                    padding: 4px 8px;
                    font-size: 11px;
                }

                .calendar-page-grid {
                    grid-template-columns: 1fr !important;
                    gap: 24px;
                }

                .mobile-nav {
                    display: flex;
                }

                .modal {
                    width: 90vw;
                    max-width: 90vw;
                    padding: 20px;
                    max-height: 90vh;
                    overflow-y: auto;
                }
            }

            .action-btns {
                display: flex;
                gap: 8px;
            }

            .action-btn {
                width: 32px;
                height: 32px;
                border-radius: var(--radius-sm);
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                font-size: 14px;
            }

            .action-btn.edit {
                background: rgba(108, 92, 231, 0.1);
                color: var(--primary);
            }

            .action-btn.delete {
                background: rgba(255, 118, 117, 0.1);
                color: var(--accent-red);
            }

            .action-btn:hover {
                transform: scale(1.1);
            }

            .calendar-page-grid {
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: 24px;
            }

            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(45, 52, 54, 0.5);
                backdrop-filter: blur(4px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                animation: fadeIn 0.2s ease;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }

                to {
                    opacity: 1;
                }
            }

            .modal {
                background: #fff;
                border-radius: var(--radius-xl);
                padding: 32px;
                width: 100%;
                max-width: 560px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 8px 40px rgba(108, 92, 231, 0.16);
                animation: slideUp 0.3s ease;
            }

            @keyframes slideUp {
                from {
                    transform: translateY(20px);
                    opacity: 0;
                }

                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            .modal-title {
                font-family: "Nunito", sans-serif;
                font-size: 24px;
                font-weight: 800;
                margin-bottom: 24px;
                color: var(--text-primary);
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-label {
                display: block;
                font-size: 13px;
                font-weight: 600;
                color: var(--text-secondary);
                margin-bottom: 8px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .form-input,
            .form-select,
            .form-textarea {
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e8e8f0;
                border-radius: var(--radius-md);
                font-family: "Quicksand", sans-serif;
                font-size: 14px;
                transition: all 0.2s ease;
                outline: none;
            }

            .form-input:focus,
            .form-select:focus,
            .form-textarea:focus {
                border-color: var(--primary);
                box-shadow: 0 0 0 4px rgba(108, 92, 231, 0.1);
            }

            .form-textarea {
                resize: vertical;
                min-height: 80px;
            }

            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px;
            }

            .modal-actions {
                display: flex;
                gap: 12px;
                justify-content: flex-end;
                margin-top: 28px;
                padding-top: 20px;
                border-top: 1px solid #e8e8f0;
            }

            .calendar-container {
                background: var(--bg-card);
                border-radius: var(--radius-lg);
                padding: 24px;
                box-shadow: var(--shadow-sm);
            }

            .calendar-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 24px;
            }

            .calendar-nav {
                display: flex;
                align-items: center;
                gap: 16px;
            }

            .calendar-nav-btn {
                width: 40px;
                height: 40px;
                border-radius: var(--radius-sm);
                border: 2px solid #e8e8f0;
                background: #fff;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
                transition: all 0.2s ease;
            }

            .calendar-nav-btn:hover {
                border-color: var(--primary);
                color: var(--primary);
            }

            .calendar-title {
                font-family: "Nunito", sans-serif;
                font-size: 20px;
                font-weight: 700;
            }

            .calendar-view-toggle {
                display: flex;
                background: #f5f5fa;
                border-radius: var(--radius-sm);
                padding: 4px;
            }

            .view-toggle-btn {
                padding: 8px 16px;
                border: none;
                background: transparent;
                border-radius: 6px;
                font-family: "Quicksand", sans-serif;
                font-weight: 600;
                font-size: 13px;
                cursor: pointer;
                transition: all 0.2s ease;
                color: var(--text-secondary);
            }

            .view-toggle-btn.active {
                background: #fff;
                color: var(--primary);
                box-shadow: var(--shadow-sm);
            }

            .calendar-grid {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 8px;
            }

            .calendar-weekday {
                text-align: center;
                font-size: 12px;
                font-weight: 600;
                color: var(--text-muted);
                padding: 8px;
                text-transform: uppercase;
            }

            .calendar-day {
                aspect-ratio: 1;
                border-radius: var(--radius-md);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.2s ease;
                background: #fafbff;
                position: relative;
                min-height: 60px;
            }

            .calendar-day:hover {
                transform: scale(1.05);
                box-shadow: var(--shadow-md);
            }

            .calendar-day.other-month {
                opacity: 0.3;
            }

            .calendar-day.today {
                border: 2px solid var(--primary);
            }

            .calendar-day.selected {
                background: var(--primary);
                color: #fff;
            }

            .calendar-day .day-number {
                font-weight: 600;
                font-size: 14px;
            }

            .calendar-day .health-indicator {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                margin-top: 4px;
            }

            .health-excellent {
                background: var(--accent-green);
            }

            .health-good {
                background: var(--accent-blue);
            }

            .health-fair {
                background: var(--accent-orange);
            }

            .health-poor {
                background: var(--accent-red);
            }

            .health-none {
                background: var(--text-muted);
            }

            .year-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 24px;
            }

            .month-card {
                background: #fafbff;
                border-radius: var(--radius-md);
                padding: 16px;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .month-card:hover {
                background: #fff;
                box-shadow: var(--shadow-md);
            }

            .month-name {
                font-weight: 700;
                font-size: 14px;
                margin-bottom: 12px;
                color: var(--text-primary);
            }

            .mini-calendar {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 2px;
            }

            .mini-day {
                aspect-ratio: 1;
                border-radius: 4px;
                font-size: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .charts-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 24px;
                margin-bottom: 32px;
            }

            .chart-card {
                background: var(--bg-card);
                border-radius: var(--radius-lg);
                padding: 24px;
                box-shadow: var(--shadow-sm);
            }

            .pie-chart-container {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 20px;
                padding: 10px;
                flex-wrap: wrap;
                flex-direction: column;
            }

            .pie-chart {
                width: 140px;
                height: 140px;
                border-radius: 50%;
                position: relative;
                flex-shrink: 0;
            }

            .pie-chart-inner {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 100px;
                height: 100px;
                background: #fff;
                border-radius: 50%;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .pie-chart-total {
                font-family: "Nunito", sans-serif;
                font-size: 24px;
                font-weight: 800;
                color: var(--text-primary);
            }

            .pie-chart-label {
                font-size: 11px;
                color: var(--text-secondary);
            }

            .pie-legend {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .legend-item {
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 13px;
            }

            .legend-color {
                width: 14px;
                height: 14px;
                border-radius: 4px;
            }

            .legend-value {
                color: var(--text-secondary);
                margin-left: auto;
                font-weight: 600;
            }

            .tooltip {
                position: absolute;
                background-color: #fff;
                border: 1px solid #ccc;
                border-radius: 8px;
                padding: 12px;
                z-index: 1000;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                width: 400px;
            }

            .tooltip h4 {
                margin-top: 0;
                margin-bottom: 8px;
            }

            .tooltip table {
                width: 100%;
                border-collapse: collapse;
            }

            .tooltip th,
            .tooltip td {
                padding: 4px 8px;
                text-align: left;
            }

            .tooltip th {
                font-size: 12px;
                font-weight: 600;
                color: var(--text-muted);
            }

            .tooltip td {
                font-size: 13px;
            }

            .bar-chart-container {
                padding: 20px 10px;
            }

            .bar-chart-item {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 16px;
            }

            .bar-label {
                width: 100px;
                font-size: 13px;
                font-weight: 500;
                color: var(--text-secondary);
            }

            .bar-track {
                flex: 1;
                height: 24px;
                background: #f5f5fa;
                border-radius: 12px;
                overflow: hidden;
            }

            .bar-fill {
                height: 100%;
                border-radius: 12px;
                transition: width 0.5s ease;
                display: flex;
                align-items: center;
                padding-left: 10px;
            }

            .bar-value {
                font-size: 12px;
                font-weight: 600;
                color: #fff;
            }

            .suggestions-card {
                background: linear-gradient(
                    135deg,
                    var(--primary) 0%,
                    #5b4cd4 100%
                );
                border-radius: var(--radius-lg);
                padding: 28px;
                color: #fff;
                margin-top: 24px;
            }

            .suggestions-title {
                font-family: "Nunito", sans-serif;
                font-size: 20px;
                font-weight: 700;
                margin-bottom: 16px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .suggestion-item {
                display: flex;
                align-items: flex-start;
                gap: 12px;
                padding: 12px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .suggestion-item:last-child {
                border-bottom: none;
            }

            .suggestion-icon {
                width: 32px;
                height: 32px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: var(--radius-sm);
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }

            .suggestion-text {
                font-size: 14px;
                line-height: 1.5;
                opacity: 0.9;
            }

            .settings-section {
                background: var(--bg-card);
                border-radius: var(--radius-lg);
                padding: 24px;
                margin-bottom: 24px;
                box-shadow: var(--shadow-sm);
            }

            .settings-title {
                font-family: "Nunito", sans-serif;
                font-size: 18px;
                font-weight: 700;
                margin-bottom: 20px;
                color: var(--text-primary);
            }

            .settings-list {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }

            .settings-item {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 10px 16px;
                background: #fafbff;
                border-radius: var(--radius-md);
                font-size: 14px;
            }

            .settings-item-color {
                width: 12px;
                height: 12px;
                border-radius: 50%;
            }

            .settings-item button {
                background: none;
                border: none;
                cursor: pointer;
                color: var(--text-muted);
                font-size: 16px;
                padding: 0 4px;
            }

            .settings-item button:hover {
                color: var(--accent-red);
            }

            .add-item-form {
                display: flex;
                gap: 12px;
                margin-top: 16px;
                flex-wrap: wrap;
            }

            .add-item-form input {
                flex: 1;
                min-width: 120px;
                padding: 10px 16px;
                border: 2px solid #e8e8f0;
                border-radius: var(--radius-md);
                font-family: "Quicksand", sans-serif;
                outline: none;
            }

            .add-item-form input:focus {
                border-color: var(--primary);
            }

            .period-selector {
                display: flex;
                background: #f5f5fa;
                border-radius: var(--radius-sm);
                padding: 4px;
                margin-bottom: 24px;
                width: fit-content;
            }

            .period-btn {
                padding: 10px 20px;
                border: none;
                background: transparent;
                border-radius: 6px;
                font-family: "Quicksand", sans-serif;
                font-weight: 600;
                font-size: 14px;
                cursor: pointer;
                transition: all 0.2s ease;
                color: var(--text-secondary);
            }

            .period-btn.active {
                background: #fff;
                color: var(--primary);
                box-shadow: var(--shadow-sm);
            }

            .empty-state {
                text-align: center;
                padding: 60px 20px;
                color: var(--text-secondary);
            }

            .empty-icon {
                font-size: 64px;
                margin-bottom: 16px;
                opacity: 0.5;
            }

            .empty-title {
                font-family: "Nunito", sans-serif;
                font-size: 20px;
                font-weight: 700;
                margin-bottom: 8px;
                color: var(--text-primary);
            }

            .health-score-container {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .health-score-circle {
                width: 160px;
                height: 160px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .health-score-inner {
                width: 120px;
                height: 120px;
                border-radius: 50%;
                background: #fff;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .health-score-value {
                font-family: "Nunito", sans-serif;
                font-size: 48px;
                font-weight: 800;
                line-height: 1;
            }

            .health-score-label {
                font-size: 14px;
                color: var(--text-secondary);
                margin-top: 4px;
            }

            .cal-activity {
                padding: 8px 10px;
                background: #fafbff;
                border-radius: var(--radius-sm);
                margin-bottom: 4px;
                cursor: pointer;
                transition: all 0.15s ease;
                border-left: 3px solid transparent;
            }

            .cal-activity:hover {
                background: #f0f1ff;
                transform: translateX(2px);
            }

            .cal-activity-header {
                display: flex;
                align-items: center;
                gap: 6px;
                flex-wrap: nowrap;
            }

            .cal-activity-icon {
                font-size: 14px;
                flex-shrink: 0;
            }

            .cal-activity-title {
                font-weight: 600;
                font-size: 13px;
                flex: 1;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                min-width: 0;
            }

            .cal-activity-time {
                font-size: 10px;
                color: var(--text-secondary);
                margin-top: 2px;
            }

            .cal-detail {
                background: #fff;
                border-radius: var(--radius-md);
                padding: 16px;
                margin-bottom: 8px;
                box-shadow: var(--shadow-md);
                animation: slideUp 0.2s ease;
            }

            .cal-detail-title {
                font-family: "Nunito", sans-serif;
                font-size: 16px;
                font-weight: 700;
                margin-bottom: 12px;
            }

            .cal-detail-row {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 13px;
                margin-bottom: 8px;
            }

            .cal-detail-label {
                color: var(--text-secondary);
                min-width: 60px;
            }

            .cal-detail-actions {
                display: flex;
                justify-content: flex-end;
                gap: 8px;
                padding-top: 12px;
                border-top: 1px solid #e8e8f0;
                margin-top: 8px;
            }

            .date-picker-row {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 24px;
                flex-wrap: wrap;
            }

            .date-picker-row input[type="date"] {
                padding: 10px 16px;
                border: 2px solid #e8e8f0;
                border-radius: var(--radius-md);
                font-family: "Quicksand", sans-serif;
                font-size: 14px;
                outline: none;
                cursor: pointer;
            }

            .date-picker-row input[type="date"]:focus {
                border-color: var(--primary);
            }

            .duration-badge {
                display: inline-flex;
                align-items: center;
                gap: 4px;
                padding: 4px 10px;
                border-radius: 20px;
                font-size: 11px;
                font-weight: 600;
                background: rgba(0, 206, 201, 0.15);
                color: #00b894;
            }

            @media (max-width: 1200px) {
                .dashboard-grid {
                    grid-template-columns: repeat(2, 1fr);
                }

                .charts-grid {
                    grid-template-columns: 1fr;
                }
            }

            @media (max-width: 768px) {
                .sidebar {
                    width: 80px;
                    padding: 16px;
                }

                .logo-text,
                .logo-sub,
                .nav-item span,
                .user-info {
                    display: none;
                }

                .main-content {
                    margin-left: 80px;
                    max-width: calc(100vw - 80px);
                }

                .dashboard-grid {
                    grid-template-columns: 1fr;
                }

                .year-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
            }
        </style>
    </head>

    <body>
        <div id="root"></div>
        <script type="text/babel">
            const { useState, useEffect, useMemo } = React;
            const APP_VERSION = "v1.5.2";
            const GITHUB_OWNER = "flyzhenghao";
            const GITHUB_REPO = "yang-daily-planner";
            const GITHUB_FILE_PATH = "data.json";
            const GITHUB_BRANCH = "main";

            const defaultCategories = [
                { id: 1, name: "Study", color: "#6C5CE7", icon: "üìö" },
                { id: 2, name: "Entertainment", color: "#FD79A8", icon: "üéÆ" },
                { id: 3, name: "Social", color: "#FDCB6E", icon: "üë•" },
                { id: 4, name: "Exercise", color: "#00B894", icon: "üèÉ" },
                { id: 5, name: "Sleep", color: "#74B9FF", icon: "üò¥" },
                { id: 6, name: "Other", color: "#636E72", icon: "üìå" },
            ];
            const defaultStatuses = [
                { id: 1, name: "Planning", color: "#74B9FF" },
                { id: 2, name: "Processing", color: "#FDCB6E" },
                { id: 3, name: "Finished", color: "#00B894" },
                { id: 4, name: "Partial Finished", color: "#6C5CE7" },
                { id: 5, name: "Abandoned", color: "#B2BEC3" },
            ];

            const getLocalDateStr = (date = new Date()) => {
                const d = new Date(date);
                return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
            };

            const calcDuration = (timeFrom, timeTo) => {
                if (!timeFrom || !timeTo) return 0;
                const [h1, m1] = timeFrom.split(":").map(Number);
                const [h2, m2] = timeTo.split(":").map(Number);
                let mins = h2 * 60 + m2 - (h1 * 60 + m1);
                if (mins < 0) mins += 24 * 60;
                return mins;
            };

            const timeStrToMins = (time) => {
                if (!time) return null;
                const [h, m] = time.split(":").map(Number);
                return h * 60 + m;
            };

            const formatDuration = (mins) => {
                if (mins <= 0) return "-";
                const h = Math.floor(mins / 60);
                const m = mins % 60;
                if (h > 0 && m > 0) return `${h}h ${m}m`;
                if (h > 0) return `${h}h`;
                return `${m}m`;
            };

            const formatDate = (date) =>
                new Date(date).toLocaleDateString("en-NZ", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                });
            const generateId = () =>
                Date.now() + Math.random().toString(36).substr(2, 9);
            const getLS = (key, def) => {
                try {
                    const s = localStorage.getItem(key);
                    return s ? JSON.parse(s) : def;
                } catch {
                    return def;
                }
            };
            const setLS = (key, val) => {
                try {
                    localStorage.setItem(key, JSON.stringify(val));
                } catch (e) {
                    console.error(e);
                }
            };

            async function loadDataFromGitHub(forceRemote = false) {
                try {
                    const response = await fetch(`data.json?t=${Date.now()}`, {
                        cache: "no-cache",
                    });
                    if (response.ok) {
                        const data = await response.json();
                        const remoteUpdated = data.lastUpdated
                            ? Date.parse(data.lastUpdated)
                            : 0;
                        const localUpdated = getLS("yang_last_updated", 0) || 0;

                        // If forceRemote is true, always use remote data
                        if (
                            !forceRemote &&
                            localUpdated &&
                            localUpdated > remoteUpdated
                        ) {
                            console.log(
                                "üì± Using local data (newer than remote)",
                            );
                            return {
                                activities: getLS("yang_activities", []),
                                categories: getLS(
                                    "yang_categories",
                                    defaultCategories,
                                ),
                                statuses: getLS(
                                    "yang_statuses",
                                    defaultStatuses,
                                ),
                            };
                        }

                        console.log("‚òÅÔ∏è Using remote data from GitHub");
                        if (data.activities)
                            setLS("yang_activities", data.activities);
                        if (data.categories)
                            setLS("yang_categories", data.categories);
                        if (data.statuses)
                            setLS("yang_statuses", data.statuses);
                        setLS("yang_last_updated", remoteUpdated || Date.now());
                        return data;
                    }
                } catch (error) {
                    console.log("Using localStorage fallback");
                }
                return {
                    activities: getLS("yang_activities", []),
                    categories: getLS("yang_categories", defaultCategories),
                    statuses: getLS("yang_statuses", defaultStatuses),
                };
            }

            async function saveDataToGitHub(activities, categories, statuses) {
                const token = localStorage.getItem("yang_github_token");
                if (!token) {
                    console.warn("‚ö†Ô∏è GitHub token not configured");
                    return false;
                }
                try {
                    const dataObj = {
                        version: APP_VERSION,
                        lastUpdated: new Date().toISOString(),
                        activities,
                        categories,
                        statuses,
                    };
                    const content = JSON.stringify(dataObj, null, 2);
                    const encodedContent = btoa(
                        unescape(encodeURIComponent(content)),
                    );
                    const getResponse = await fetch(
                        `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_FILE_PATH}?ref=${GITHUB_BRANCH}&t=${Date.now()}`,
                        {
                            headers: {
                                Authorization: `token ${token}`,
                                Accept: "application/vnd.github.v3+json",
                            },
                            cache: "no-cache",
                        },
                    );
                    if (!getResponse.ok)
                        throw new Error(
                            `Failed to get file info: ${getResponse.status}`,
                        );
                    const fileData = await getResponse.json();
                    const updateResponse = await fetch(
                        `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_FILE_PATH}`,
                        {
                            method: "PUT",
                            headers: {
                                Authorization: `token ${token}`,
                                Accept: "application/vnd.github.v3+json",
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                message: `Update data - ${new Date().toISOString()}`,
                                content: encodedContent,
                                sha: fileData.sha,
                                branch: GITHUB_BRANCH,
                            }),
                        },
                    );
                    if (!updateResponse.ok) throw new Error("Failed to save");
                    console.log("‚úÖ Successfully saved to GitHub");
                    return true;
                } catch (error) {
                    console.error("Error saving to GitHub:", error);
                    return false;
                }
            }

            function PieChart({ data, totalLabel, onHover, hoveredCategory }) {
                const total = data.reduce((s, i) => s + i.value, 0);
                if (total === 0)
                    return (
                        <div
                            className="empty-state"
                            style={{ padding: "40px 20px" }}
                        >
                            <div className="empty-icon">üìä</div>
                            <p>No data</p>
                        </div>
                    );
                let parts = [],
                    angle = 0;
                data.forEach((i) => {
                    const a = (i.value / total) * 360;
                    parts.push(`${i.color} ${angle}deg ${angle + a}deg`);
                    angle += a;
                });
                return (
                    <div className="pie-chart-container">
                        <div
                            className="pie-chart"
                            style={{
                                background: `conic-gradient(${parts.join(", ")})`,
                            }}
                        >
                            <div className="pie-chart-inner">
                                <div className="pie-chart-total">
                                    {Math.round(total / 60)}h
                                </div>
                                <div className="pie-chart-label">
                                    {totalLabel || "Total"}
                                </div>
                            </div>
                        </div>
                        <div className="pie-legend">
                            {data.map((i, idx) => (
                                <div
                                    key={idx}
                                    className={`legend-item ${hoveredCategory === i.name ? "hovered" : ""}`}
                                    onMouseEnter={(e) => onHover(i.name, e)}
                                    onMouseLeave={() => onHover(null)}
                                >
                                    <div
                                        className="legend-color"
                                        style={{ background: i.color }}
                                    ></div>
                                    <span>
                                        {i.icon} {i.name}
                                    </span>
                                    <span className="legend-value">
                                        {Math.round(i.value)}m
                                    </span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            function BarChart({ data }) {
                const max = Math.max(...data.map((d) => d.value), 1);
                if (data.length === 0)
                    return (
                        <div
                            className="empty-state"
                            style={{ padding: "40px 20px" }}
                        >
                            <div className="empty-icon">üìä</div>
                            <p>No data</p>
                        </div>
                    );
                return (
                    <div className="bar-chart-container">
                        {data.map((i, idx) => (
                            <div key={idx} className="bar-chart-item">
                                <div className="bar-label">{i.name}</div>
                                <div className="bar-track">
                                    <div
                                        className="bar-fill"
                                        style={{
                                            width: `${Math.max((i.value / max) * 100, i.value > 0 ? 10 : 0)}%`,
                                            background: i.color,
                                        }}
                                    >
                                        {i.value > 0 && (
                                            <span className="bar-value">
                                                {i.value}
                                            </span>
                                        )}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            }

            function Tooltip({ activities, category, position }) {
                if (!activities || activities.length === 0) return null;

                const sortedActivities = [...activities].sort((a, b) => {
                    return (
                        calcDuration(b.timeFrom, b.timeTo) -
                        calcDuration(a.timeFrom, a.timeTo)
                    );
                });

                return (
                    <div
                        className="tooltip"
                        style={{
                            left: position.x,
                            top: position.y,
                        }}
                    >
                        <h4>{category}</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Duration</th>
                                    <th>Activity</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody>
                                {sortedActivities.map((a) => (
                                    <tr key={a.id}>
                                        <td>
                                            {formatDuration(
                                                calcDuration(
                                                    a.timeFrom,
                                                    a.timeTo,
                                                ),
                                            )}
                                        </td>
                                        <td>{a.item}</td>
                                        <td>{a.date}</td>
                                        <td>
                                            {a.timeFrom} - {a.timeTo}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                );
            }

            function App() {
                const [page, setPage] = useState("dashboard");
                const [activities, setActivities] = useState([]);
                const [categories, setCategories] = useState(defaultCategories);
                const [statuses, setStatuses] = useState(defaultStatuses);
                const [showModal, setShowModal] = useState(false);
                const [showTokenModal, setShowTokenModal] = useState(false);
                const [editingActivity, setEditingActivity] = useState(null);
                const [selectedDate, setSelectedDate] = useState(new Date());
                const [calendarView, setCalendarView] = useState("month");
                const [period, setPeriod] = useState("daily");
                const [isLoading, setIsLoading] = useState(true);
                const [isSaving, setIsSaving] = useState(false);
                const [isSyncing, setIsSyncing] = useState(false);
                const [confirmConfig, setConfirmConfig] = useState(null);
                const [reportPhoneNumber, setReportPhoneNumber] = useState("");
                const [showReportModal, setShowReportModal] = useState(false);
                const [reportDate, setReportDate] = useState(getLocalDateStr());

                useEffect(() => {
                    setReportPhoneNumber(getLS("yang_report_phone", ""));
                }, []);
                useEffect(() => {
                    setLS("yang_report_phone", reportPhoneNumber);
                }, [reportPhoneNumber]);

                useEffect(() => {
                    loadDataFromGitHub().then((data) => {
                        if (data.activities) setActivities(data.activities);
                        if (data.categories) setCategories(data.categories);
                        if (data.statuses) setStatuses(data.statuses);
                        setIsLoading(false);
                    });
                }, []);
                useEffect(() => {
                    if (!isLoading) {
                        setLS("yang_activities", activities);
                        setLS("yang_last_updated", Date.now());
                    }
                }, [activities, isLoading]);
                useEffect(() => {
                    if (!isLoading) setLS("yang_categories", categories);
                }, [categories, isLoading]);
                useEffect(() => {
                    if (!isLoading) setLS("yang_statuses", statuses);
                }, [statuses, isLoading]);

                const handleSaveToGitHub = async () => {
                    setIsSaving(true);
                    const success = await saveDataToGitHub(
                        activities,
                        categories,
                        statuses,
                    );
                    setIsSaving(false);
                    if (success) alert("‚úÖ Data saved to GitHub successfully!");
                    else {
                        const token = localStorage.getItem("yang_github_token");
                        alert(
                            token
                                ? "‚ùå Failed to save to GitHub."
                                : "‚ö†Ô∏è GitHub token not configured.",
                        );
                    }
                };

                const handleForceSync = async () => {
                    setIsSyncing(true);
                    try {
                        localStorage.removeItem("yang_last_updated");
                        const data = await loadDataFromGitHub(true);
                        if (data.activities) setActivities(data.activities);
                        if (data.categories) setCategories(data.categories);
                        if (data.statuses) setStatuses(data.statuses);
                        alert(
                            `‚úÖ ÂêåÊ≠•ÊàêÂäüÔºÅÂ∑≤‰ªé‰∫ëÁ´ØÂä†ËΩΩ ${data.activities?.length || 0} Êù°Ê¥ªÂä®ËÆ∞ÂΩï„ÄÇ`,
                        );
                    } catch (error) {
                        alert("‚ùå ÂêåÊ≠•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•„ÄÇ");
                    }
                    setIsSyncing(false);
                };

                const addActivity = (a) =>
                    setActivities([...activities, { ...a, id: generateId() }]);
                const updateActivity = (a) =>
                    setActivities(
                        activities.map((x) => (x.id === a.id ? a : x)),
                    );
                const deleteActivity = (id) => {
                    setConfirmConfig({
                        title: "Delete Activity",
                        message:
                            "Are you sure you want to delete this activity?",
                        onConfirm: () => {
                            setActivities((prev) =>
                                prev.filter((a) => a.id !== id),
                            );
                            setConfirmConfig(null);
                            handleSaveToGitHub();
                        },
                    });
                };
                const bulkDeleteActivities = (ids, onSuccess) => {
                    if (!ids || ids.length === 0) return;
                    setConfirmConfig({
                        title: "Bulk Delete",
                        message: `Are you sure you want to delete ${ids.length} activities?`,
                        onConfirm: () => {
                            setActivities((prev) =>
                                prev.filter((a) => !ids.includes(a.id)),
                            );
                            if (onSuccess) onSuccess();
                            setConfirmConfig(null);
                            handleSaveToGitHub();
                        },
                    });
                };
                const bulkUpdateActivities = (ids, updates) => {
                    setActivities((prev) =>
                        prev.map((a) =>
                            ids.includes(a.id) ? { ...a, ...updates } : a,
                        ),
                    );
                    handleSaveToGitHub();
                };
                const openEdit = (a) => {
                    setEditingActivity(a);
                    setShowModal(true);
                };

                const closeModal = () => {
                    setShowModal(false);
                    setEditingActivity(null);
                };

                const generateDailySummary = (date) => {
                    const today = date;
                    const todayActs = activities.filter(
                        (a) => a.date === today,
                    );
                    if (todayActs.length === 0)
                        return `üìÖ Daily Report [${today}]: No activities logged.`;

                    const finished = todayActs.filter(
                        (a) => a.status === "Finished",
                    );
                    const totalMins = todayActs.reduce(
                        (s, a) => s + calcDuration(a.timeFrom, a.timeTo),
                        0,
                    );
                    const studyMins = todayActs
                        .filter((a) => a.category === "Study")
                        .reduce(
                            (s, a) => s + calcDuration(a.timeFrom, a.timeTo),
                            0,
                        );

                    let text = `üåü *Daily Report - ${formatDate(today)}*\n\n`;
                    text += `üìä *Summary*\n`;
                    text += `‚Ä¢ Total Time: ${formatDuration(totalMins)}\n`;
                    text += `‚Ä¢ Study Time: ${formatDuration(studyMins)}\n`;
                    text += `‚Ä¢ Tasks Completed: ${finished.length}/${todayActs.length}\n\n`;

                    if (finished.length > 0) {
                        text += `‚úÖ *Completed*\n`;
                        finished.forEach((a) => (text += `‚Ä¢ ${a.item}\n`));
                        text += `\n`;
                    }

                    const others = todayActs.filter(
                        (a) => a.status !== "Finished",
                    );
                    if (others.length > 0) {
                        text += `üöß *In Progress / Other*\n`;
                        others.forEach(
                            (a) => (text += `‚Ä¢ ${a.item} (${a.status})\n`),
                        );
                    }

                    return text;
                };

                const handleSendReport = () => {
                    if (!reportPhoneNumber) {
                        alert(
                            "‚ö†Ô∏è Please set a Phone Number in Settings first.",
                        );
                        setPage("settings");
                        return;
                    }
                    setShowReportModal(true);
                };

                const handleConfirmSendReport = (date) => {
                    const text = generateDailySummary(date);
                    const url = `https://wa.me/${reportPhoneNumber.replace(/[^0-9]/g, "")}
?text=${encodeURIComponent(text)}`;
                    window.open(url, "_blank");
                    setShowReportModal(false);
                };

                const navItems = [
                    { id: "dashboard", icon: "üìä", label: "Dashboard" },
                    { id: "activities", icon: "üìù", label: "Activities" },
                    { id: "calendar", icon: "üìÖ", label: "Calendar" },
                    { id: "settings", icon: "‚öôÔ∏è", label: "Settings" },
                ];

                return (
                    <div className="app-container">
                        <aside className="sidebar">
                            <div className="logo">
                                <div className="logo-icon">üåü</div>
                                <div>
                                    <div className="logo-text">
                                        Yang's Planner
                                    </div>
                                    <div className="logo-sub">
                                        Daily Management
                                    </div>
                                </div>
                            </div>
                            <nav className="nav-menu">
                                {navItems.map((i) => (
                                    <div
                                        key={i.id}
                                        className={`nav-item ${page === i.id ? "active" : ""}`}
                                        onClick={() => setPage(i.id)}
                                    >
                                        <span className="nav-icon">
                                            {i.icon}
                                        </span>
                                        <span>{i.label}</span>
                                    </div>
                                ))}
                            </nav>
                            <div
                                style={{
                                    padding: "16px 0",
                                    borderTop:
                                        "1px solid rgba(255,255,255,0.1)",
                                }}
                            >
                                <button
                                    className="btn btn-primary"
                                    onClick={handleSaveToGitHub}
                                    disabled={isSaving}
                                    style={{
                                        width: "100%",
                                        fontSize: "13px",
                                        padding: "10px",
                                    }}
                                >
                                    {isSaving
                                        ? "‚è≥ Saving..."
                                        : "üíæ Save to GitHub"}
                                </button>
                                <button
                                    className="btn btn-secondary"
                                    onClick={handleSendReport}
                                    style={{
                                        width: "100%",
                                        fontSize: "13px",
                                        padding: "10px",
                                        marginTop: "8px",
                                        background: "#25D366",
                                        color: "#fff",
                                        border: "none",
                                    }}
                                >
                                    üì± Send Report
                                </button>
                                <button
                                    className="btn btn-secondary"
                                    onClick={() => setShowTokenModal(true)}
                                    style={{
                                        width: "100%",
                                        fontSize: "13px",
                                        padding: "8px",
                                        marginTop: "8px",
                                    }}
                                >
                                    üîë GitHub Token
                                </button>
                                <div
                                    style={{
                                        fontSize: "10px",
                                        color: "rgba(255,255,255,0.5)",
                                        textAlign: "center",
                                        marginTop: "8px",
                                    }}
                                >
                                    {APP_VERSION}
                                </div>
                            </div>
                            <div className="user-profile">
                                <div className="avatar">Y</div>
                                <div className="user-info">
                                    <div className="user-name">Yang</div>
                                    <div className="user-role">
                                        Year 9 Student
                                    </div>
                                </div>
                            </div>
                        </aside>
                        <main className="main-content">
                            {page === "dashboard" && (
                                <Dashboard
                                    activities={activities}
                                    categories={categories}
                                    statuses={statuses}
                                    onAdd={() => setShowModal(true)}
                                    setPage={setPage}
                                />
                            )}
                            {page === "activities" && (
                                <Activities
                                    activities={activities}
                                    categories={categories}
                                    statuses={statuses}
                                    onAdd={() => setShowModal(true)}
                                    onEdit={openEdit}
                                    onDelete={deleteActivity}
                                    onBulkDelete={bulkDeleteActivities}
                                    onBulkUpdate={bulkUpdateActivities}
                                />
                            )}
                            {page === "calendar" && (
                                <Calendar
                                    activities={activities}
                                    categories={categories}
                                    statuses={statuses}
                                    selectedDate={selectedDate}
                                    setSelectedDate={setSelectedDate}
                                    view={calendarView}
                                    setView={setCalendarView}
                                    onAdd={() => setShowModal(true)}
                                    onEdit={openEdit}
                                    onDelete={deleteActivity}
                                />
                            )}
                            {page === "settings" && (
                                <Settings
                                    categories={categories}
                                    setCategories={setCategories}
                                    statuses={statuses}
                                    setStatuses={setStatuses}
                                    onForceSync={handleForceSync}
                                    isSyncing={isSyncing}
                                    reportPhoneNumber={reportPhoneNumber}
                                    setReportPhoneNumber={setReportPhoneNumber}
                                />
                            )}
                        </main>
                        {showModal && (
                            <Modal
                                activity={editingActivity}
                                activities={activities}
                                categories={categories}
                                statuses={statuses}
                                onSave={(a, keepOpen) => {
                                    if (editingActivity) {
                                        updateActivity(a);
                                    } else {
                                        addActivity(a);
                                    }
                                    if (!keepOpen) {
                                        closeModal();
                                    }
                                    handleSaveToGitHub();
                                }}
                                onClose={closeModal}
                            />
                        )}
                        {showTokenModal && (
                            <TokenModal
                                onClose={() => setShowTokenModal(false)}
                            />
                        )}
                        {confirmConfig && (
                            <ConfirmModal
                                title={confirmConfig.title}
                                message={confirmConfig.message}
                                onConfirm={confirmConfig.onConfirm}
                                onCancel={() => setConfirmConfig(null)}
                            />
                        )}
                        {showReportModal && (
                            <ReportModal
                                onConfirm={handleConfirmSendReport}
                                onCancel={() => setShowReportModal(false)}
                            />
                        )}
                        <div className="mobile-nav">
                            {navItems.map((item) => (
                                <div
                                    key={item.id}
                                    className={`mobile-nav-item ${page === item.id ? "active" : ""}`}
                                    onClick={() => setPage(item.id)}
                                >
                                    <div className="mobile-nav-icon">
                                        {item.icon}
                                    </div>
                                    <span>{item.label}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            function Dashboard({
                activities,
                categories,
                statuses,
                onAdd,
                setPage,
            }) {
                const [viewDate, setViewDate] = useState(getLocalDateStr());
                const [viewMode, setViewMode] = useState("daily");
                const [hoveredCategory, setHoveredCategory] = useState(null);
                const [tooltipPosition, setTooltipPosition] = useState({
                    x: 0,
                    y: 0,
                });
                const getDateRange = useMemo(() => {
                    const baseDate = new Date(viewDate + "T00:00:00");
                    if (viewMode === "daily")
                        return {
                            start: viewDate,
                            end: viewDate,
                            label: formatDate(viewDate),
                        };
                    if (viewMode === "weekly") {
                        const day = baseDate.getDay();
                        const startD = new Date(baseDate);
                        startD.setDate(baseDate.getDate() - day);
                        const endD = new Date(startD);
                        endD.setDate(startD.getDate() + 6);
                        return {
                            start: getLocalDateStr(startD),
                            end: getLocalDateStr(endD),
                            label: `${formatDate(startD)} - ${formatDate(endD)}`,
                        };
                    }
                    if (viewMode === "monthly") {
                        const startD = new Date(
                            baseDate.getFullYear(),
                            baseDate.getMonth(),
                            1,
                        );
                        const endD = new Date(
                            baseDate.getFullYear(),
                            baseDate.getMonth() + 1,
                            0,
                        );
                        return {
                            start: getLocalDateStr(startD),
                            end: getLocalDateStr(endD),
                            label: `${startD.toLocaleDateString("en-NZ", { month: "long", year: "numeric" })}`,
                        };
                    }
                    const startD = new Date(baseDate.getFullYear(), 0, 1);
                    const endD = new Date(baseDate.getFullYear(), 11, 31);
                    return {
                        start: getLocalDateStr(startD),
                        end: getLocalDateStr(endD),
                        label: `Year ${baseDate.getFullYear()}`,
                    };
                }, [viewDate, viewMode]);
                const filteredActs = useMemo(
                    () =>
                        activities
                            .filter(
                                (a) =>
                                    a.date >= getDateRange.start &&
                                    a.date <= getDateRange.end,
                            )
                            .sort((a, b) => {
                                const dc = b.date.localeCompare(a.date);
                                return dc !== 0
                                    ? dc
                                    : (b.timeFrom || "00:00").localeCompare(
                                          a.timeFrom || "00:00",
                                      );
                            }),
                    [activities, getDateRange],
                );

                const handlePieChartHover = (category, event) => {
                    setHoveredCategory(category);
                    if (event) {
                        setTooltipPosition({
                            x: event.clientX,
                            y: event.clientY,
                        });
                    }
                };

                const stats = useMemo(() => {
                    const cs = categories.map((c) => {
                        const ca = filteredActs.filter(
                            (a) => a.category === c.name,
                        );
                        const mins = ca.reduce(
                            (s, a) => s + calcDuration(a.timeFrom, a.timeTo),
                            0,
                        );
                        return {
                            ...c,
                            activities: ca,
                            minutes: mins,
                            hours: (mins / 60).toFixed(1),
                        };
                    });
                    const totalMins = cs.reduce((s, c) => s + c.minutes, 0);
                    return cs
                        .map((c) => ({
                            ...c,
                            percentage:
                                totalMins > 0
                                    ? ((c.minutes / totalMins) * 100).toFixed(0)
                                    : 0,
                        }))
                        .sort((a, b) => b.minutes - a.minutes);
                }, [filteredActs, categories]);

                const pieData = useMemo(
                    () =>
                        stats
                            .filter((s) => s.minutes > 0)
                            .map((s) => ({
                                name: s.name,
                                value: s.minutes,
                                color: s.color,
                                icon: s.icon,
                            })),
                    [stats],
                );

                const statusStats = useMemo(() => {
                    const ss = statuses.map((s) => ({
                        name: s.name,
                        value: filteredActs.filter((a) => a.status === s.name)
                            .length,
                        color: s.color,
                    }));
                    return ss.filter((s) => s.value > 0);
                }, [filteredActs, statuses]);

                const healthScore = useMemo(() => {
                    const sleep =
                        stats.find((s) => s.name === "Sleep")?.minutes || 0;
                    const exercise =
                        stats.find((s) => s.name === "Exercise")?.minutes || 0;
                    let score = 50;
                    if (sleep >= 420) score += 25;
                    if (exercise >= 30) score += 25;
                    return Math.min(100, score);
                }, [stats]);

                const getColor = (score) => {
                    if (score > 80) return "var(--accent-green)";
                    if (score > 60) return "var(--accent-blue)";
                    if (score > 40) return "var(--accent-orange)";
                    return "var(--accent-red)";
                };

                const getGreeting = () => {
                    const h = new Date().getHours();
                    return h < 12
                        ? "Morning"
                        : h < 18
                          ? "Afternoon"
                          : "Evening";
                };
                return (
                    <div>
                        <div className="page-header">
                            <div>
                                <h1 className="page-title">
                                    Good {getGreeting()}, Yang! üëã
                                </h1>
                                <p className="page-subtitle">
                                    {getDateRange.label}
                                </p>
                            </div>
                            <button className="btn btn-primary" onClick={onAdd}>
                                ‚ûï Add Activity
                            </button>
                        </div>
                        <div className="date-picker-row">
                            <input
                                type="date"
                                value={viewDate}
                                onChange={(e) => setViewDate(e.target.value)}
                            />
                            <button
                                className="btn btn-secondary btn-sm"
                                onClick={() => setViewDate(getLocalDateStr())}
                            >
                                Today
                            </button>
                            <div
                                className="period-selector"
                                style={{ marginBottom: 0 }}
                            >
                                {["daily", "weekly", "monthly", "yearly"].map(
                                    (m) => (
                                        <button
                                            key={m}
                                            className={`period-btn ${viewMode === m ? "active" : ""}`}
                                            onClick={() => setViewMode(m)}
                                        >
                                            {m.charAt(0).toUpperCase() +
                                                m.slice(1)}
                                        </button>
                                    ),
                                )}
                            </div>
                        </div>
                        <div className="dashboard-grid">
                            {stats.slice(0, 4).map((s) => (
                                <div
                                    key={s.id}
                                    className={`stat-card ${s.name.toLowerCase()}`}
                                >
                                    <div className="stat-icon">{s.icon}</div>
                                    <div className="stat-value">{s.hours}h</div>
                                    <div className="stat-label">
                                        {s.name} ({s.percentage}%)
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="charts-grid">
                            <div className="chart-card">
                                <div className="card-header">
                                    <h3 className="card-title">
                                        Time by Category
                                    </h3>
                                </div>
                                <PieChart
                                    data={pieData}
                                    totalLabel={viewMode}
                                    onHover={handlePieChartHover}
                                    hoveredCategory={hoveredCategory}
                                />
                            </div>
                            <div className="chart-card">
                                <div className="card-header">
                                    <h3 className="card-title">
                                        Status Distribution
                                    </h3>
                                </div>
                                <BarChart data={statusStats} />
                            </div>
                            <div className="chart-card">
                                <div className="card-header">
                                    <h3 className="card-title">Health Score</h3>
                                </div>
                                <div className="health-score-container">
                                    <div
                                        className="health-score-circle"
                                        style={{
                                            background: `conic-gradient(${getColor(healthScore)} ${healthScore * 3.6}deg, #F5F5FA ${healthScore * 3.6}deg)`,
                                        }}
                                    >
                                        <div className="health-score-inner">
                                            <div
                                                className="health-score-value"
                                                style={{
                                                    color: getColor(
                                                        healthScore,
                                                    ),
                                                }}
                                            >
                                                {healthScore}
                                            </div>
                                            <div className="health-score-label">
                                                / 100
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {hoveredCategory && (
                            <Tooltip
                                activities={
                                    stats.find(
                                        (s) => s.name === hoveredCategory,
                                    )?.activities
                                }
                                category={hoveredCategory}
                                position={tooltipPosition}
                            />
                        )}
                        <div className="card">
                            <div className="card-header">
                                <h2 className="card-title">
                                    Recent Activities
                                </h2>
                                <button
                                    className="btn btn-secondary btn-sm"
                                    onClick={() => setPage("activities")}
                                >
                                    View All
                                </button>
                            </div>
                            <Activities
                                activities={activities
                                    .sort(
                                        (a, b) =>
                                            new Date(b.date) -
                                                new Date(a.date) ||
                                            (b.timeFrom || "").localeCompare(
                                                a.timeFrom || "",
                                            ),
                                    )
                                    .slice(0, 5)}
                                categories={categories}
                                statuses={statuses}
                                condensed
                            />
                        </div>
                    </div>
                );
            }

            function Activities({
                activities,
                categories,
                statuses,
                onAdd,
                onEdit,
                onDelete,
                onBulkDelete,
                onBulkUpdate,
                condensed,
            }) {
                const [filter, setFilter] = useState({
                    text: "",
                    category: "all",
                    status: "all",
                    startDate: "",
                    endDate: "",
                });
                const [sort, setSort] = useState({
                    by: "date",
                    asc: false,
                });
                const [selectedIds, setSelectedIds] = useState([]);

                const handleFilterChange = (field, value) => {
                    setFilter({ ...filter, [field]: value });
                };

                const filteredActivities = useMemo(() => {
                    return [...activities]
                        .filter((a) => {
                            const txt = filter.text.toLowerCase();
                            const matchesText =
                                !txt ||
                                a.item.toLowerCase().includes(txt) ||
                                (a.notes &&
                                    a.notes.toLowerCase().includes(txt));
                            const matchesCategory =
                                filter.category === "all" ||
                                a.category === filter.category;
                            const matchesStatus =
                                filter.status === "all" ||
                                a.status === filter.status;
                            const matchesStartDate =
                                !filter.startDate || a.date >= filter.startDate;
                            const matchesEndDate =
                                !filter.endDate || a.date <= filter.endDate;
                            return (
                                matchesText &&
                                matchesCategory &&
                                matchesStatus &&
                                matchesStartDate &&
                                matchesEndDate
                            );
                        })
                        .sort((a, b) => {
                            let res;
                            if (sort.by === "date") {
                                res = new Date(b.date) - new Date(a.date);
                                if (res === 0)
                                    res = (b.timeFrom || "").localeCompare(
                                        a.timeFrom || "",
                                    );
                            } else {
                                res = (a[sort.by] || "").localeCompare(
                                    b[sort.by] || "",
                                );
                            }
                            return sort.asc ? res : -res;
                        });
                }, [activities, filter, sort]);

                const handleSelect = (id) => {
                    if (Array.isArray(id)) {
                        setSelectedIds(id);
                    } else {
                        setSelectedIds((prev) =>
                            prev.includes(id)
                                ? prev.filter((i) => i !== id)
                                : [...prev, id],
                        );
                    }
                };

                if (condensed) {
                    return (
                        <ActivityList
                            activities={activities}
                            categories={categories}
                            statuses={statuses}
                            onEdit={onEdit}
                            condensed
                        />
                    );
                }

                return (
                    <div className="animate-fade-in">
                        {!condensed && (
                            <div className="page-header">
                                <div>
                                    <h1 className="page-title">Activities</h1>
                                    <p className="page-subtitle">
                                        You have {activities.length} logged
                                        activities in total.
                                    </p>
                                </div>
                                <button
                                    className="btn btn-primary"
                                    onClick={onAdd}
                                >
                                    ‚ú® Add Activity
                                </button>
                            </div>
                        )}
                        <div className="card">
                            <div className="filter-bar">
                                <input
                                    type="text"
                                    placeholder="Search..."
                                    value={filter.text}
                                    onChange={(e) =>
                                        handleFilterChange(
                                            "text",
                                            e.target.value,
                                        )
                                    }
                                />
                                <select
                                    value={filter.category}
                                    onChange={(e) =>
                                        handleFilterChange(
                                            "category",
                                            e.target.value,
                                        )
                                    }
                                >
                                    <option value="all">All Categories</option>
                                    {categories.map((c) => (
                                        <option key={c.id} value={c.name}>
                                            {c.icon} {c.name}
                                        </option>
                                    ))}
                                </select>
                                <select
                                    value={filter.status}
                                    onChange={(e) =>
                                        handleFilterChange(
                                            "status",
                                            e.target.value,
                                        )
                                    }
                                >
                                    <option value="all">All Statuses</option>
                                    {statuses.map((s) => (
                                        <option key={s.id} value={s.name}>
                                            {s.name}
                                        </option>
                                    ))}
                                </select>
                                <input
                                    type="date"
                                    value={filter.startDate}
                                    onChange={(e) =>
                                        handleFilterChange(
                                            "startDate",
                                            e.target.value,
                                        )
                                    }
                                />
                                <input
                                    type="date"
                                    value={filter.endDate}
                                    onChange={(e) =>
                                        handleFilterChange(
                                            "endDate",
                                            e.target.value,
                                        )
                                    }
                                />
                            </div>

                            {selectedIds.length > 0 && (
                                <div className="bulk-actions">
                                    <span>
                                        <b>{selectedIds.length}</b> selected
                                    </span>
                                    <button
                                        className="btn btn-sm btn-danger"
                                        onClick={() => {
                                            onBulkDelete(selectedIds, () =>
                                                setSelectedIds([]),
                                            );
                                        }}
                                    >
                                        Delete
                                    </button>
                                    <select
                                        className="form-select"
                                        style={{ width: "auto" }}
                                        onChange={(e) => {
                                            if (e.target.value) {
                                                onBulkUpdate(selectedIds, {
                                                    status: e.target.value,
                                                });
                                                setSelectedIds([]);
                                            }
                                        }}
                                    >
                                        <option value="">Update Status</option>
                                        {statuses.map((s) => (
                                            <option key={s.id} value={s.name}>
                                                {s.name}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                            )}

                            <ActivityList
                                activities={filteredActivities}
                                onEdit={onEdit}
                                onDelete={onDelete}
                                categories={categories}
                                statuses={statuses}
                                onSelect={handleSelect}
                                selectedIds={selectedIds}
                            />
                        </div>
                    </div>
                );
            }

            function ActivityList({
                activities,
                onEdit,
                onDelete,
                categories,
                statuses,
                condensed = false,
                onSelect,
                selectedIds = [],
            }) {
                const allSelected =
                    !condensed &&
                    selectedIds.length === activities.length &&
                    activities.length > 0;

                const handleSelectAll = (e) => {
                    if (e.target.checked) {
                        onSelect(activities.map((a) => a.id));
                    } else {
                        onSelect([]);
                    }
                };

                if (activities.length === 0 && !condensed) {
                    return (
                        <div className="empty-state">
                            <div className="empty-icon">ü§∑</div>
                            <h3 className="empty-title">
                                No activities found.
                            </h3>
                            <p>Try adjusting your filters.</p>
                        </div>
                    );
                }

                return (
                    <table className="activity-table">
                        {!condensed && (
                            <thead>
                                <tr>
                                    <th style={{ width: "40px" }}>
                                        <input
                                            type="checkbox"
                                            checked={allSelected}
                                            onChange={handleSelectAll}
                                        />
                                    </th>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Activity</th>
                                    <th>Category</th>
                                    <th>Status</th>
                                    <th>Duration</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                        )}
                        <tbody>
                            {activities.map((a) => (
                                <ActivityRow
                                    key={a.id}
                                    activity={a}
                                    onEdit={onEdit}
                                    onDelete={onDelete}
                                    categories={categories}
                                    statuses={statuses}
                                    condensed={condensed}
                                    onSelect={onSelect}
                                    isSelected={
                                        !condensed && selectedIds.includes(a.id)
                                    }
                                />
                            ))}
                        </tbody>
                    </table>
                );
            }

            function ActivityRow({
                activity: a,
                onEdit,
                onDelete,
                categories,
                statuses,
                condensed,
                onSelect,
                isSelected,
            }) {
                const category = categories.find((c) => c.name === a.category);
                const status = statuses.find((s) => s.name === a.status);
                return (
                    <tr onClick={() => onEdit && onEdit(a)}>
                        {!condensed && (
                            <td
                                data-label="Select"
                                onClick={(e) => e.stopPropagation()}
                            >
                                <input
                                    type="checkbox"
                                    checked={isSelected}
                                    onChange={() => onSelect && onSelect(a.id)}
                                />
                            </td>
                        )}
                        {!condensed && (
                            <td data-label="Date">{formatDate(a.date)}</td>
                        )}
                        <td data-label="Time">
                            {a.timeFrom} - {a.timeTo}
                        </td>
                        <td data-label="Activity">{a.item}</td>
                        <td data-label="Category">
                            <span
                                className={`category-badge category-${a.category?.toLowerCase()}`}
                            >
                                {category?.icon} {a.category}
                            </span>
                        </td>
                        {!condensed && (
                            <td data-label="Status">
                                <span
                                    className={`status-badge status-${a.status?.replace(/ /g, "").toLowerCase()}`}
                                >
                                    {a.status}
                                </span>
                            </td>
                        )}
                        <td data-label="Duration">
                            <span className="duration-badge">
                                {formatDuration(
                                    calcDuration(a.timeFrom, a.timeTo),
                                )}
                            </span>
                        </td>
                        {!condensed && (
                            <td
                                data-label="Actions"
                                onClick={(e) => e.stopPropagation()}
                            >
                                <div className="action-btns">
                                    <button
                                        className="action-btn edit"
                                        onClick={() => onEdit(a)}
                                    >
                                        ‚úèÔ∏è
                                    </button>
                                    <button
                                        className="action-btn delete"
                                        onClick={() => onDelete(a.id)}
                                    >
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </td>
                        )}
                    </tr>
                );
            }

            function Calendar({
                activities,
                categories,
                statuses,
                selectedDate,
                setSelectedDate,
                view,
                setView,
                onAdd,
                onEdit,
                onDelete,
            }) {
                const [currentDate, setCurrentDate] = useState(new Date());

                return (
                    <div className="animate-fade-in">
                        <div className="page-header">
                            <div>
                                <h1 className="page-title">Calendar</h1>
                            </div>
                        </div>
                        <div className="calendar-page-grid">
                            <div className="calendar-container">
                                <CalendarHeader
                                    date={currentDate}
                                    setDate={setCurrentDate}
                                    view={view}
                                    setView={setView}
                                />
                                {view === "month" ? (
                                    <CalendarMonthView
                                        date={currentDate}
                                        activities={activities}
                                        onDayClick={setCurrentDate}
                                    />
                                ) : (
                                    <CalendarYearView
                                        date={currentDate}
                                        activities={activities}
                                        onMonthClick={(month) => {
                                            const newDate = new Date(
                                                currentDate,
                                            );
                                            newDate.setMonth(month);
                                            setCurrentDate(newDate);
                                            setView("month");
                                        }}
                                    />
                                )}
                            </div>
                            <ActivityDetailPanel
                                date={currentDate}
                                activities={activities}
                                categories={categories}
                                onEdit={onEdit}
                            />
                        </div>
                    </div>
                );
            }

            function CalendarHeader({ date, setDate, view, setView }) {
                const changeMonth = (offset) => {
                    const newDate = new Date(date);
                    newDate.setMonth(newDate.getMonth() + offset);
                    setDate(newDate);
                };

                const changeYear = (offset) => {
                    const newDate = new Date(date);
                    newDate.setFullYear(newDate.getFullYear() + offset);
                    setDate(newDate);
                };

                const title =
                    view === "month"
                        ? date.toLocaleDateString("en-US", {
                              year: "numeric",
                              month: "long",
                          })
                        : date.getFullYear();

                return (
                    <div className="calendar-header">
                        <div className="calendar-nav">
                            <button
                                className="calendar-nav-btn"
                                onClick={() =>
                                    view === "month"
                                        ? changeMonth(-1)
                                        : changeYear(-1)
                                }
                            >
                                &lt;
                            </button>
                            <h2 className="calendar-title">{title}</h2>
                            <button
                                className="calendar-nav-btn"
                                onClick={() =>
                                    view === "month"
                                        ? changeMonth(1)
                                        : changeYear(1)
                                }
                            >
                                &gt;
                            </button>
                        </div>
                        <div className="calendar-view-toggle">
                            <button
                                className={`view-toggle-btn ${view === "month" ? "active" : ""}`}
                                onClick={() => setView("month")}
                            >
                                Month
                            </button>
                            <button
                                className={`view-toggle-btn ${view === "year" ? "active" : ""}`}
                                onClick={() => setView("year")}
                            >
                                Year
                            </button>
                        </div>
                    </div>
                );
            }

            function CalendarMonthView({ date, activities, onDayClick }) {
                const monthStart = new Date(
                    date.getFullYear(),
                    date.getMonth(),
                    1,
                );
                const monthEnd = new Date(
                    date.getFullYear(),
                    date.getMonth() + 1,
                    0,
                );
                const startDate = new Date(monthStart);
                startDate.setDate(startDate.getDate() - monthStart.getDay());
                const endDate = new Date(monthEnd);
                endDate.setDate(endDate.getDate() + (6 - monthEnd.getDay()));

                const days = [];
                let d = new Date(startDate);
                while (d <= endDate) {
                    days.push(new Date(d));
                    d.setDate(d.getDate() + 1);
                }

                return (
                    <div className="calendar-grid">
                        {["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"].map(
                            (day) => (
                                <div key={day} className="calendar-weekday">
                                    {day}
                                </div>
                            ),
                        )}
                        {days.map((day) => {
                            const dayStr = getLocalDateStr(day);
                            const isToday =
                                getLocalDateStr(new Date()) === dayStr;
                            const isSelected = getLocalDateStr(date) === dayStr;
                            const isCurrentMonth =
                                day.getMonth() === date.getMonth();

                            const dayActs = activities.filter(
                                (a) => a.date === dayStr,
                            );

                            let health = "none";
                            if (dayActs.length > 0) {
                                const sleep = dayActs
                                    .filter((a) => a.category === "Sleep")
                                    .reduce(
                                        (s, a) =>
                                            s +
                                            calcDuration(a.timeFrom, a.timeTo),
                                        0,
                                    );
                                if (sleep >= 420) health = "good";
                                else health = "poor";
                            }

                            return (
                                <div
                                    key={dayStr}
                                    className={`calendar-day ${isSelected ? "selected" : ""} ${isToday ? "today" : ""} ${!isCurrentMonth ? "other-month" : ""}`}
                                    onClick={() => onDayClick(day)}
                                >
                                    <span className="day-number">
                                        {day.getDate()}
                                    </span>
                                    <div
                                        className={`health-indicator health-${health}`}
                                    ></div>
                                </div>
                            );
                        })}
                    </div>
                );
            }

            function CalendarYearView({ date, activities, onMonthClick }) {
                return (
                    <div className="year-grid">
                        {Array.from({ length: 12 }).map((_, i) => {
                            const monthDate = new Date(
                                date.getFullYear(),
                                i,
                                1,
                            );
                            const monthActivities = activities.filter((a) =>
                                a.date.startsWith(
                                    `${date.getFullYear()}-${String(i + 1).padStart(2, "0")}`,
                                ),
                            );

                            return (
                                <div
                                    key={i}
                                    className="month-card"
                                    onClick={() => onMonthClick(i)}
                                >
                                    <h4 className="month-name">
                                        {monthDate.toLocaleDateString("en-US", {
                                            month: "long",
                                        })}
                                    </h4>
                                    <MiniCalendar
                                        year={date.getFullYear()}
                                        month={i}
                                        activities={monthActivities}
                                    />
                                </div>
                            );
                        })}
                    </div>
                );
            }

            function MiniCalendar({ year, month, activities }) {
                const monthStart = new Date(year, month, 1);
                const startDate = new Date(monthStart);
                startDate.setDate(startDate.getDate() - startDate.getDay());

                const days = [];
                for (let i = 0; i < 42; i++) {
                    const d = new Date(startDate);
                    d.setDate(d.getDate() + i);
                    days.push(d);
                }

                return (
                    <div className="mini-calendar">
                        {days.map((d, i) => {
                            const dayStr = getLocalDateStr(d);
                            const hasActivity = activities.some(
                                (a) => a.date === dayStr,
                            );
                            let color = "transparent";
                            if (d.getMonth() === month) {
                                color = "#f0f0f0";
                                if (hasActivity) color = "var(--primary-light)";
                            }
                            return (
                                <div
                                    key={i}
                                    className="mini-day"
                                    style={{ backgroundColor: color }}
                                />
                            );
                        })}
                    </div>
                );
            }

            function ActivityDetailPanel({
                date,
                activities,
                categories,
                onEdit,
            }) {
                const [activeId, setActiveId] = useState(null);
                const dayActs = activities.filter(
                    (a) => a.date === getLocalDateStr(date),
                );

                return (
                    <div className="card" style={{ height: "fit-content" }}>
                        <h3 className="card-title">
                            {formatDate(date)} ({dayActs.length})
                        </h3>
                        {dayActs.length === 0 ? (
                            <p>No activities.</p>
                        ) : (
                            dayActs.map((a) => {
                                const category = categories.find(
                                    (c) => c.name === a.category,
                                );
                                return (
                                    <div key={a.id}>
                                        <div
                                            className="cal-activity"
                                            onClick={() =>
                                                setActiveId(
                                                    activeId === a.id
                                                        ? null
                                                        : a.id,
                                                )
                                            }
                                        >
                                            <div className="cal-activity-header">
                                                <span
                                                    className="cal-activity-icon"
                                                    style={{
                                                        color: category?.color,
                                                    }}
                                                >
                                                    {category?.icon}
                                                </span>
                                                <span className="cal-activity-title">
                                                    {a.item}
                                                </span>
                                            </div>
                                            <div className="cal-activity-time">
                                                {a.timeFrom} - {a.timeTo} (
                                                {formatDuration(
                                                    calcDuration(
                                                        a.timeFrom,
                                                        a.timeTo,
                                                    ),
                                                )}
                                                )
                                            </div>
                                        </div>
                                        {activeId === a.id && (
                                            <div className="cal-detail">
                                                <div className="cal-detail-row">
                                                    <span>Status:</span>
                                                    <b>{a.status}</b>
                                                </div>
                                                {a.notes && (
                                                    <div className="cal-detail-row">
                                                        <span>Notes:</span>
                                                        <b>{a.notes}</b>
                                                    </div>
                                                )}
                                                <div className="cal-detail-actions">
                                                    <button
                                                        className="btn btn-sm btn-secondary"
                                                        onClick={() =>
                                                            onEdit(a)
                                                        }
                                                    >
                                                        Edit
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                );
                            })
                        )}
                    </div>
                );
            }

            function Settings({
                categories,
                setCategories,
                statuses,
                setStatuses,
                onForceSync,
                isSyncing,
                reportPhoneNumber,
                setReportPhoneNumber,
            }) {
                const [newCat, setNewCat] = useState({ name: "", icon: "üè∑Ô∏è" });

                const handleAddCategory = () => {
                    if (
                        newCat.name &&
                        !categories.some((c) => c.name === newCat.name)
                    ) {
                        setCategories([
                            ...categories,
                            {
                                ...newCat,
                                id: generateId(),
                                color: `#${Math.floor(Math.random() * 16777215).toString(16)}`,
                            },
                        ]);
                        setNewCat({ name: "", icon: "üè∑Ô∏è" });
                    }
                };

                return (
                    <div className="animate-fade-in">
                        <div className="page-header">
                            <h1 className="page-title">Settings</h1>
                        </div>
                        <div className="settings-section">
                            <h2 className="settings-title">Data Management</h2>
                            <p
                                style={{
                                    color: "var(--text-secondary)",
                                    marginBottom: "12px",
                                }}
                            >
                                Manually trigger data sync. Use with caution.
                            </p>
                            <button
                                className="btn btn-secondary"
                                onClick={onForceSync}
                                disabled={isSyncing}
                            >
                                {isSyncing ? "‚è≥ Syncing..." : "üîÑ Force Sync"}
                            </button>
                        </div>
                        <div className="settings-section">
                            <h2 className="settings-title">
                                WhatsApp Reporting
                            </h2>
                            <div className="form-group">
                                <label className="form-label">
                                    Phone Number
                                </label>
                                <input
                                    className="form-input"
                                    type="tel"
                                    value={reportPhoneNumber}
                                    onChange={(e) =>
                                        setReportPhoneNumber(e.target.value)
                                    }
                                    placeholder="+1234567890"
                                />
                            </div>
                        </div>
                        <div className="settings-section">
                            <h2 className="settings-title">Categories</h2>
                            <div className="settings-list">
                                {categories.map((c) => (
                                    <div key={c.id} className="settings-item">
                                        {c.icon} {c.name}
                                    </div>
                                ))}
                            </div>
                            <div className="add-item-form">
                                <input
                                    type="text"
                                    value={newCat.name}
                                    onChange={(e) =>
                                        setNewCat({
                                            ...newCat,
                                            name: e.target.value,
                                        })
                                    }
                                    placeholder="New Category Name"
                                />
                                <button
                                    className="btn btn-secondary"
                                    onClick={handleAddCategory}
                                >
                                    Add
                                </button>
                            </div>
                        </div>
                        <div className="settings-section">
                            <h2 className="settings-title">About</h2>
                            <p>Version: {APP_VERSION}</p>
                        </div>
                    </div>
                );
            }

            function Modal({
                activity,
                activities,
                categories,
                statuses,
                onSave,
                onClose,
            }) {
                const [form, setForm] = useState(
                    activity || {
                        date: getLocalDateStr(),
                        timeFrom: "",
                        timeTo: "",
                        item: "",
                        category: categories[0]?.name || "",
                        status: statuses[0]?.name || "",
                        notes: "",
                    },
                );
                const [suggestions, setSuggestions] = useState([]);
                const [keepOpen, setKeepOpen] = useState(false);

                const handleChange = (field, value) => {
                    setForm({ ...form, [field]: value });
                    if (field === "item" && value.length > 2) {
                        const uniqueItems = [
                            ...new Set(
                                activities.map((a) => a.item.toLowerCase()),
                            ),
                        ];
                        setSuggestions(
                            uniqueItems.filter((i) =>
                                i.includes(value.toLowerCase()),
                            ),
                        );
                    } else {
                        setSuggestions([]);
                    }
                };

                const handleSuggestionClick = (suggestion) => {
                    const existing = activities.find(
                        (a) => a.item.toLowerCase() === suggestion,
                    );
                    setForm({
                        ...form,
                        item: existing.item,
                        category: existing.category,
                    });
                    setSuggestions([]);
                };

                const handleSave = () => {
                    if (form.item.trim()) {
                        onSave(form, keepOpen);
                        if (keepOpen) {
                            const newTime = form.timeTo;
                            setForm({
                                date: form.date,
                                timeFrom: newTime,
                                timeTo: "",
                                item: "",
                                category: form.category,
                                status: form.status,
                                notes: "",
                            });
                        }
                    }
                };

                return (
                    <div className="modal-overlay" onClick={onClose}>
                        <div
                            className="modal"
                            onClick={(e) => e.stopPropagation()}
                        >
                            <h2 className="modal-title">
                                {activity ? "Edit" : "Add"} Activity
                            </h2>
                            <div className="form-group">
                                <label className="form-label">Activity</label>
                                <input
                                    type="text"
                                    className="form-input"
                                    value={form.item}
                                    onChange={(e) =>
                                        handleChange("item", e.target.value)
                                    }
                                    placeholder="What did you do?"
                                    autoFocus
                                />
                                {suggestions.length > 0 && (
                                    <ul className="suggestions-list">
                                        {suggestions.map((s) => (
                                            <li
                                                key={s}
                                                onClick={() =>
                                                    handleSuggestionClick(s)
                                                }
                                            >
                                                {s}
                                            </li>
                                        ))}
                                    </ul>
                                )}
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label className="form-label">Date</label>
                                    <input
                                        type="date"
                                        className="form-input"
                                        value={form.date}
                                        onChange={(e) =>
                                            handleChange("date", e.target.value)
                                        }
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">
                                        Category
                                    </label>
                                    <select
                                        className="form-select"
                                        value={form.category}
                                        onChange={(e) =>
                                            handleChange(
                                                "category",
                                                e.target.value,
                                            )
                                        }
                                    >
                                        {categories.map((c) => (
                                            <option key={c.id} value={c.name}>
                                                {c.icon} {c.name}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            <div className="form-row">
                                <div className="form-group">
                                    <label className="form-label">From</label>
                                    <input
                                        type="time"
                                        className="form-input"
                                        value={form.timeFrom}
                                        onChange={(e) =>
                                            handleChange(
                                                "timeFrom",
                                                e.target.value,
                                            )
                                        }
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">To</label>
                                    <input
                                        type="time"
                                        className="form-input"
                                        value={form.timeTo}
                                        onChange={(e) =>
                                            handleChange(
                                                "timeTo",
                                                e.target.value,
                                            )
                                        }
                                    />
                                </div>
                            </div>
                            <div className="form-group">
                                <label className="form-label">Status</label>
                                <select
                                    className="form-select"
                                    value={form.status}
                                    onChange={(e) =>
                                        handleChange("status", e.target.value)
                                    }
                                >
                                    {statuses.map((s) => (
                                        <option key={s.id} value={s.name}>
                                            {s.name}
                                        </option>
                                    ))}
                                </select>
                            </div>
                            <div className="form-group">
                                <label className="form-label">Notes</label>
                                <textarea
                                    className="form-textarea"
                                    value={form.notes}
                                    onChange={(e) =>
                                        handleChange("notes", e.target.value)
                                    }
                                ></textarea>
                            </div>
                            <div className="modal-actions">
                                <label style={{ marginRight: "auto" }}>
                                    <input
                                        type="checkbox"
                                        checked={keepOpen}
                                        onChange={(e) =>
                                            setKeepOpen(e.target.checked)
                                        }
                                    />
                                    Continue adding
                                </label>
                                <button
                                    className="btn btn-secondary"
                                    onClick={onClose}
                                >
                                    Cancel
                                </button>
                                <button
                                    className="btn btn-primary"
                                    onClick={handleSave}
                                >
                                    Save
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            function TokenModal({ onClose }) {
                const [token, setToken] = useState(
                    getLS("yang_github_token", ""),
                );
                return (
                    <div className="modal-overlay" onClick={onClose}>
                        <div
                            className="modal"
                            onClick={(e) => e.stopPropagation()}
                        >
                            <h2 className="modal-title">GitHub Token</h2>
                            <p>
                                A personal access token with 'repo' scope is
                                required for data sync.{" "}
                                <a
                                    href="https://github.com/settings/tokens/new"
                                    target="_blank"
                                >
                                    Create one here
                                </a>
                                .
                            </p>
                            <input
                                type="password"
                                className="form-input"
                                value={token}
                                onChange={(e) => setToken(e.target.value)}
                            />
                            <div className="modal-actions">
                                <button
                                    className="btn btn-secondary"
                                    onClick={onClose}
                                >
                                    Cancel
                                </button>
                                <button
                                    className="btn btn-primary"
                                    onClick={() => {
                                        setLS("yang_github_token", token);
                                        onClose();
                                    }}
                                >
                                    Save
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            function ConfirmModal({ title, message, onConfirm, onCancel }) {
                return (
                    <div className="modal-overlay">
                        <div className="modal" style={{ maxWidth: "400px" }}>
                            <h2 className="modal-title">{title}</h2>
                            <p>{message}</p>
                            <div className="modal-actions">
                                <button
                                    className="btn btn-secondary"
                                    onClick={onCancel}
                                >
                                    Cancel
                                </button>
                                <button
                                    className="btn btn-danger"
                                    onClick={onConfirm}
                                >
                                    Confirm
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            function ReportModal({ onConfirm, onCancel }) {
                const [date, setDate] = useState(getLocalDateStr());

                const handleConfirm = () => {
                    onConfirm(date);
                };

                return (
                    <div className="modal-overlay">
                        <div className="modal" style={{ maxWidth: "400px" }}>
                            <h2 className="modal-title">Select Report Date</h2>
                            <div className="form-group">
                                <input
                                    type="date"
                                    className="form-input"
                                    value={date}
                                    onChange={(e) => setDate(e.target.value)}
                                />
                            </div>
                            <div className="modal-actions">
                                <button
                                    className="btn btn-secondary"
                                    onClick={onCancel}
                                >
                                    Cancel
                                </button>
                                <button
                                    className="btn btn-primary"
                                    onClick={handleConfirm}
                                >
                                    Confirm
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            ReactDOM.render(<App />, document.getElementById("root"));
        </script>
    </body>
</html>
